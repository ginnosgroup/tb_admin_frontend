<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<link rel="shortcut icon" href="img/favicon.ico">
		<title>我的佣金报表</title>
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet">
		<link href="assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-datepicker/css/datepicker.css"><!-- BOOTSTRAP DATEPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-timepicker/compiled/timepicker.css"><!-- BOOTSTRAP TIMEPICKER PLUGIN CSS -->		
		<link rel="stylesheet" type="text/css" href="css/jquery.autocompleter.css">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link href="css/index.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body id="taxinvoice-list" v-cloak>
<section id="container">
			<header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-placement="right" class="fa fa-bars tooltips">
					</div>
				</div>
				<a href="main.html" class="logo">
					佣金系统
					<span v-if="ap_list==='KJ'">
           	 会计
          </span>
          <span v-if="ap_list==='GW'">
           	 顾问
          </span>
          <span v-if="ap_list==='WA'">
           	 文案
          </span>
          <span v-if="ap_list==='MA'">
           	 Mara
          </span>
          <span v-if="ap_list==='SUPERAD'">
           	 超级管理员
          </span>
				</a>
				<div class="top-nav ">
					<ul class="nav pull-right top-menu">
						<li style="padding-right:15px;"><a href="knowledge-detail.html?id=1000164" style="color:#ff6c60;">帮助中心</a></li>
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="username">
                  {{admin}}
                </span>
								<b class="caret">
                </b>
							</a>
							<ul class="dropdown-menu extended logout">
								<li class="log-arrow-up">
								</li>
								<li>
									<a href="password.html">
										<i class="fa fa-key">
                    </i> 修改密码
									</a>
								</li>
								<li><a href="javascript:tb.out();">
										<i class="fa fa-user">
                    </i> Log Out
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</header>
			<aside>
				<div id="sidebar" class="nav-collapse">
					<ul class="sidebar-menu" id="nav-accordion">
						<li >
              <a href="main.html">
                <i class="fa fa-dashboard">
                </i>
                <span>
                  Dashboard
                </span>
              </a>
            </li>
            <dli v-if="ap_list==='SUPERAD'">            
            <li>
              <a href="adviser.html">
                <i class="fa fa-book">
                </i>
                <span>
                  顾问管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 文案管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="official.html">
										文案管理
									</a>
								</li>
								<li>
									<a href="official-tag.html">
										订单标签管理
									</a>
								</li>								
							</ul>
						</li>
            <li>
              <a href="mara.html">
                <i class="fa fa-book">
                </i>
                <span>
                  MARA管理
                </span>
              </a>
            </li>
            <li>
              <a href="accounting.html">
                <i class="fa fa-book">
                </i>
                <span>
                  会计管理
                </span>
              </a>
            </li>
            </dli>
          	<dli v-if="ap_list==='SUPERAD' || (ap_list==='GW' && gw_regionid !== 'null') || ap_list==='KJ'">
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 学校管理
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="school.html">
										学校管理
									</a>
								</li>
								<li>
									<a href="school-setting.html">
										佣金设置
									</a>
								</li>								
							</ul>
						</li>
						</dli>
						<dli v-if="ap_list==='SUPERAD'">
            <li>
              <a href="receive-type.html">
                <i class="fa fa-book">
                </i>
                <span>
                  收款方式管理
                </span>
              </a>
            </li>
            <li>
              <a href="subagency.html">
                <i class="fa fa-book">
                </i>
                <span>
                  Subagency管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
            	<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 服务管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="service.html">
										服务项目管理
									</a>
								</li>
								<li>
									<a href="service-package.html">
										服务包管理
									</a>
								</li>
								<li>
									<a href="visa-ca.html">
										签证职业评估管理
									</a>
								</li>							
							</ul>              
            </li>
          	</dli>
          	<li v-if="ap_list!=='KJ' && ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 客户管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="users.html">
										客户管理
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="user-tags.html">
										标签管理
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='KJ'" class="sub-menu">
							<a href="serviceorder-list.html">
                <i class="fa fa-book">
                </i>
                <span>
                  服务订单管理
                </span>
              </a>
						</li>
            <li v-if="ap_list==='SUPERAD'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 渠道管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="source.html">
										渠道列表
									</a>
								</li>
								<li>
									<a href="source-type.html">
										来源分类
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 佣金表
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" id="apply_state_">
									<a href="mycommission.html">
										我的佣金报表
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_PENDING">
									<a href="mycommission.html?applyState=PENDING">
										未申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_COMPLETE">
									<a href="mycommission.html?applyState=COMPLETE">
										已申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_DJY">
									<a href="mycommission-accounting.html?commission_state=DJY">
										待结佣订单
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_YJY">
									<a href="mycommission-accounting.html?commission_state=YJY">
										已结佣订单
									</a>									
								</li>								
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="mycommission-check-accounting.html">
										自动对账
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="create-visa-commission.html">
										重建签证佣金表订单
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="table-export.html">
										导出数据
									</a>
								</li>
							</ul>
						</li>
						<li v-if="ap_list==='KJ' || ap_list==='SUPERAD'" class="sub-menu">
							<a href="javascript:;" class="active">
								<i class="fa fa-book">
                </i>
								<span>
                 	 Tax Invoice管理
                </span>
							</a>
							<ul class="sub">
								<li class="active" id="invoice_">
									<a href="taxinvoice-list.html?state=&type={{invoiceType}}">
										Tax Invoice列表
									</a>									
								</li>
								<li id="invoice_canceled">
									<a href="taxinvoice-list.html?state=canceled&type={{invoiceType}}">
										已Cancel列表
									</a>									
								</li>															
							</ul>
						</li>
						<li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 知识库
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="knowledge-menu.html">
										菜单管理
									</a>
								</li>
								<li>
									<a href="knowledge.html">
										知识库菜单
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</aside>
			<section id="main-content" class="content">
				<section class="wrapper site-min-height">
					<div class="row">
						<div class="col-lg-12">
							<section class="panel">
								<header class="panel-heading">
									全部列表
								</header>
								<div class="panel-body">
									<div class="adv-table editable-table">
										<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
									      <button data-dismiss="alert" class="close close-sm" type="button">
									      </button>
									      <strong>Success!</strong> You  just achieved success.
									  </div>
									  <div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
                      <button data-dismiss="alert" class="close close-sm" type="button">                      
                      </button>
                      <strong id="error_info"></strong>
                    </div>
                    <div class="clearfix">
                       <div class="btn-group">
                          <button id="editable-sample_new" class="btn btn-success green" onclick="addovst()">
                          Add 留学 Tax Invoice <i class="fa fa-plus"></i>
                          </button>
                       </div>
                       <div class="btn-group">
                          <button id="editable-sample_new" class="btn btn-success green" onclick="addservicefee()">
                          Add Service Fee Tax Invoice <i class="fa fa-plus"></i>
                          </button>
                       </div>
                    </div>
									  <form class="form-inline" style="margin-top:10px;">
									  	<input v-model.trim="userId" type="hidden" name="userId" id="userId" value="0" />											
											<div class="form-group">
													<label>按Invoice No.</label>
													<input v-model.trim="invoice_no" type="text" autocomplete="off" class="form-control" style="width:90px;" placeholder="请输入No.">
													<label>按佣金ID</label>
													<input v-model.trim="order_no" type="text"  autocomplete="off" class="form-control" style="width:90px;" placeholder="请输入ID">
													<input v-model.trim="create_start" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:120px;" placeholder="创建时间(开始)">
													<input v-model.trim="create_end" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:120px;" placeholder="创建时间(结束)">
													<label>类型</label>		
													<select v-model.trim="kind" id="kind" class="form-control" style="width:120px;" onchange="window.location.href='taxinvoice-list.html?state={{applyState}}&type='+this.value"></select>
													<label>请选择地区</label>		
													<select v-model.trim="branch" id="branch" class="form-control" style="width:120px;"></select>
											</div>											
											<div class="form-group">
												<button @click="getSearch" type="button" class="btn btn-info">查询</button>
											</div>
										</form>
										<div class="responsive-table margin-top">
											<input type="hidden" name="id" id="id" value="0" />											
											<table class="display table table-bordered table-striped" id="list_visa" style="">
												<thead>
													<tr>
														<th>发票ID</th>
														<th>佣金订单ID</th>
														<th>创建时间</th>
														<th>Tax Invoice No.</th>
														<th>地区</th>
														<th>状态</th>														
														<th>操作</th>
														<th>备注</th>
													</tr>
												</thead>
												<tbody>
													<tr v-for="item in subject" class="gradeX">
														<td v-html="item.ids"></td>
														<td v-html="item.order_id"></td>
														<td v-html="item.create_start"></td>
														<td v-html="item.invoice_no"></td>
														<td v-html="item.branch"></td>
														<td v-html="item.strState"></td>
														<td style="font-weight:normal;">
																<dle v-if="item.id">
																		<label><a href="javascript:invoice_view('{{item.invoice_no}}','{{item.ids}}');"><span style="color:#72d0eb;">查看</span></a></label>
																		<dle v-if="item.state==='NORMAL'">
																		<label style="margin-left:15px;"><a href="javascript:invoice_edit('{{item.invoice_no}}','{{item.ids}}');"><span style="color:#72d0eb;">修改</span></a></label>
																		<label style="margin-left:15px;"><a href="javascript:show_confirmbox('{{item.invoice_no}}','{{item.ids}}');"><span style="color:#72d0eb;">Cancel</span></a></label>
																		</dle>
																		<label style="margin-left:15px;"><a href="javascript:taxinvoice_download('{{item.invoice_no}}','{{item.ids}}');"><span style="color:#72d0eb;">下载</span></a>
																</dle>
														</td>
														<td></td>														
													</tr>													
												</tbody>
											</table>
										</div>
										<div class="row-fluid" style="display:;">
											<div class="span6">
												<div class="dataTables_info" id="hidden-table-info_info">共{{count}}条</div>
											</div>
											<div class="span6">
												<div class="dataTables_paginate paging_bootstrap pagination">
													<ul>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="firstPage" href="javascript:;">首页</a>
														</li>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="prevPage" href="javascript:;">← Pre</a>
														</li>
														<li class="nowPage" style="padding: 0px 0px;margin: 0 1px;">
															第{{pageNum+1}}页/共{{allPage}}页&nbsp;
															跳到 <input type="text" v-model.trim="pnumber" @keyup.enter="submit" style="width:50px;color:#c7c7c7;border: 1px solid #ddd;border-radius: 3px;-webkit-border-radius: 3px;padding: 5px 10px;display: inline-block;" id="b100" placeholder="" value=""> 页
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="nextPage" href="javascript:;">Next → </a>
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="lastPage" href="javascript:;">末页</a>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
							</section>
						</div>
					</div>
				</section>
			</section>
			<footer class="site-footer">
				<div class="text-center">
					2018 &copy; 佣金系统 by <span style="color:#2a8ba7;">GIG</span>.
					<a href="#" class="go-top">
						<i class="fa fa-angle-up">
            </i>
					</a>
				</div>
			</footer>
		</section>
		<div class="modal fade" id="showconfirmbox_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="z-index:9999;">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">操作提示</h4>
					</div>
					<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
			      <button data-dismiss="alert" class="close close-sm" type="button">
			      <i class="fa fa-times"></i>
			      </button>
			      <strong>Success!</strong> You  just achieved success.
			  	</div>
			  	<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
		        <button data-dismiss="alert" class="close close-sm" type="button">
		        <i class="fa fa-times"></i>
		        </button>
		        <strong id="error_info"></strong>
		      </div>
					<div class="modal-body">
						您确认执行此操作吗？
					</div>
					<div class="modal-footer">						
						<button onclick="invoice_cancel('{{invoiceNo}}','{{invoiceIds}}');" type="button" class="btn btn-primary">确认</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="loading_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static' style="z-index:99999;">
			<div class="modal-dialog" role="document" style="width:350px;">
				<div class="modal-content">
					<div class="modal-header">
					</div>
					<div class="modal-body">
							<div style="text-align:center;color:#0066CC;"><img src="img/input-spinner.gif" /> 正在执行，请稍后...</div>
					</div>
					
				</div>
			</div>
		</div>		
		<div id="load-taxinvoice-common-page"></div>
		<div id="load-taxinvoice-view-page"></div>
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.dcjqaccordion.2.7.js"></script>
		<script src="js/jquery.scrollTo.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>
		<script src="assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script><!-- BOOTSTRAP DATEPICKER JS  -->
    <script src="assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script><!-- BOOTSTRAP DATETIMEPICKER JS  -->
    <script src="js/jquery.autocompleter.js"></script>
    <script src="js/jquery.validate.min.js"></script><!-- VALIDATE JS  -->
		<script src="js/common-scripts.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/common.js?verson=1"></script>
		<script>
			$("#load-taxinvoice-common-page").load("taxinvoice-common.html?random="+Math.random());
			$("#load-taxinvoice-view-page").load("taxinvoice-common-view.html?random="+Math.random());
			tb.isLogin("taxinvoice-list.html");
			$("td,th").addClass("text-center");
			var v = new Vue({
				el: '#taxinvoice-list',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),
					gw_regionid: sessionStorage.getItem("gw_regionid"),
					adviser_id: sessionStorage.getItem("adviser_id"),
					official_id: sessionStorage.getItem("official_id"),
					mara_id: sessionStorage.getItem("mara_id"),
					kj_id: sessionStorage.getItem("kj_id"),
					applyState : getRequest('state'),
					invoiceType : getRequest('type'),	
					subject: [],
					invoiceNo: '',
					invoiceIds: '',
					count: 0,				
					name: '',
					state: '',					
					pageNum: 0,
					pageSize: 20,
					allPage: 0
				},
				created: function() {
					$('.default-date-picker1').datepicker({   				
				        format: 'yyyy-mm-dd',
				        endDate: new Date()
				  });
					this.getDatalist();
					document.onkeydown = function(e) {
						var key = window.event.keyCode;
						if (key == 13) v.gotoPage();
					};
				},
				methods: {					
					getSearch: function() {
						var that = this;
						that.pageNum = 0;
						that.pnumber = null;					
						that.getDatalist();
					},
					getDatalist: function() {
						var that = this;
						var json = {};
						show_loading();						
						if (that.invoice_no != '') json['invoice_no'] = that.invoice_no;
						if (that.order_no != '') json['order_no'] = that.order_no;
						if (that.create_start != '') json['create_start'] = that.create_start;
						if (that.create_end != '') json['create_end'] = that.create_end;
						if (that.invoiceType != '') json['kind'] = that.invoiceType;
						if (that.branch != '') json['branch'] = that.branch;				
						if (that.applyState != '') json['state'] = that.applyState;
						
						$.get(url + "invoice/count", json, function(result) {
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
						});
						json['pageNum'] = that.pageNum;
						json['pageSize'] = that.pageSize;
						console.log(json);
						$.get(url + "invoice/selectInvoice", json, function(result) {
							result.data = return_result(result);
							that.subject = result.data;
							that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
							$('#loading_id').modal('hide');
						});
					},				
					getTime: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y;
						return date2;
					},
					getTime1: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y+' '+h+':'+m2+':'+s;
						return date2;
					},
					getTime2: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = y+"-"+m+"-"+d;
						return date2;
					},
					addZero: function(obj) {
						if(obj < 10) {
							obj = '0' + obj;
						};
						return obj;
					},
					firstPage: function() {
						var that = this;
						var json = {};
						if (that.invoice_no != '') json['invoice_no'] = that.invoice_no;
						if (that.order_no != '') json['order_no'] = that.order_no;
						if (that.create_start != '') json['create_start'] = that.create_start;
						if (that.create_end != '') json['create_end'] = that.create_end;
						if (that.invoiceType != '') json['kind'] = that.invoiceType;
						if (that.branch != '') json['branch'] = that.branch;
						if (that.applyState != '') json['state'] = that.applyState;
						
						if(that.pageNum > 0) {
							show_loading();
							json['pageNum'] = 0;
							json['pageSize'] = that.pageSize;
							$.get(url + "invoice/selectInvoice", json, function(result) {
								console.log(result)
								that.pageNum = 0;
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					prevPage: function() {
						var that = this;
						var json = {};
						if (that.invoice_no != '') json['invoice_no'] = that.invoice_no;
						if (that.order_no != '') json['order_no'] = that.order_no;
						if (that.create_start != '') json['create_start'] = that.create_start;
						if (that.create_end != '') json['create_end'] = that.create_end;
						if (that.invoiceType != '') json['kind'] = that.invoiceType;
						if (that.branch != '') json['branch'] = that.branch;
						if (that.applyState != '') json['state'] = that.applyState;
						
						if(that.pageNum > 0) {
							show_loading();
							that.pageNum--;
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;
							$.get(url + "invoice/selectInvoice", json, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					nextPage: function() {
						var that = this;
						var json = {};
						if (that.invoice_no != '') json['invoice_no'] = that.invoice_no;
						if (that.order_no != '') json['order_no'] = that.order_no;
						if (that.create_start != '') json['create_start'] = that.create_start;
						if (that.create_end != '') json['create_end'] = that.create_end;
						if (that.invoiceType != '') json['kind'] = that.invoiceType;
						if (that.branch != '') json['branch'] = that.branch;
						if (that.applyState != '') json['state'] = that.applyState;
						
						if(that.pageNum < that.allPage - 1) {
							show_loading();
							that.pageNum++;
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;
							$.get(url + "invoice/selectInvoice", json, function(result) {
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					lastPage: function() {
						var that = this;
						var json = {};
						if (that.invoice_no != '') json['invoice_no'] = that.invoice_no;
						if (that.order_no != '') json['order_no'] = that.order_no;
						if (that.create_start != '') json['create_start'] = that.create_start;
						if (that.create_end != '') json['create_end'] = that.create_end;
						if (that.invoiceType != '') json['kind'] = that.invoiceType;
						if (that.branch != '') json['branch'] = that.branch;
						if (that.applyState != '') json['state'] = that.applyState;
						
						if(that.pageNum < that.allPage - 1) {
							show_loading();
							json['pageNum'] = that.allPage - 1;
							json['pageSize'] = that.pageSize;
							$.get(url + "invoice/selectInvoice", json, function(result) {
								console.log(result)
								that.pageNum = that.allPage - 1;
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					gotoPage: function() {
						var that = this;
						var json = {};
						if (that.invoice_no != '') json['invoice_no'] = that.invoice_no;
						if (that.order_no != '') json['order_no'] = that.order_no;
						if (that.create_start != '') json['create_start'] = that.create_start;
						if (that.create_end != '') json['create_end'] = that.create_end;
						if (that.invoiceType != '') json['kind'] = that.invoiceType;
						if (that.branch != '') json['branch'] = that.branch;
						if (that.applyState != '') json['state'] = that.applyState;
						that.pageNum = parseInt(that.pnumber);
						if (that.pageNum > that.allPage)
						{
								that.pnumber = that.allPage;
								that.pageNum = that.allPage;
						}						
						
						if(that.pageNum <= that.allPage) {
							show_loading();
							that.pageNum = that.pageNum - 1;
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;						
							$.get(url + "visa/list", json, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
          delete_confirm: function (index,id) {
          	$('#delete_id #order_id').html(id);
          	$('#delete_id').modal('show');
          	this.orderId = id;
          	this.index = index;
          }          
				}		
			});
			
			function return_result(result)
			{							
				for(var i = 0; i < result.data.length; i++) {
						result.data[i].oid = result.data[i].id;	
						result.data[i].create_start = v.getTime1(result.data[i].gmt_create);
						result.data[i].strState = (result.data[i].state == 'NORMAL' ? '<span style="color:#72d0eb;">'+result.data[i].state+'</span>':result.data[i].state);		
				};				
				return result.data;
			}                                
			
			v.$watch('subject', function(obj) {
					$('.default-date-picker').datepicker({   				
				        format: 'dd/mm/yyyy'
				  });
				  $('.default-date-picker1').datepicker({   				
				        format: 'yyyy-mm-dd'
				  });
				  				  				  				 					  			       
			    //绑定类型
			    var obj_kind = $("#kind");
			    $("#kind").empty();
			    //obj_kind.append("<option value=''>请选择</option>");
			    obj_kind.append("<option value='SF'>签证</option>");
			    obj_kind.append("<option value='SC'>留学</option>");
			    obj_kind.val(v.invoiceType);		    
	        //绑定地区
			    var obj_branch = $("#branch");
			    $("#branch").empty();
			    obj_branch.append("<option value=''>请选择</option>");
			    $.ajax({
	          url: '../invoice/selectAddress',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	var result_data = response.data;
	        	for (var item in result_data)
	        	{
	        			obj_branch.append("<option value='"+result_data[item]+"'>"+result_data[item]+"</option>");	        			
	        	}
	        	obj_branch.val(v.branch);        	
	        });		    
			});						
			
			function getRequest(par)
			{
					var str_value = '';
			    var url = decodeURI(location.search);
			    var theRequest = new Object();
			    if (url.indexOf('?') != -1) {
			        url = url.substr(1);
			    }
			    if (url) {
			        var strs = url.split('&');
			        for (var i = 0; i < strs.length; i++) {
			            var srtArry = strs[i].split('=');
			            var y = srtArry.shift();
			            theRequest[y] = unescape(srtArry.join('='));
			        }
			    }
			    str_value = theRequest[par];
			    if (par == 'state')
			    {					    
					    $("#invoice_"+str_value).addClass("active");
					    if (str_value != '') $("#invoice_").removeClass("active");
			  	}
			    return str_value;
			}						        
      
      function show_knowledge_detail(id,parentId)
      {
      		sessionStorage.setItem("id", id);
      		sessionStorage.setItem("menu_parentid", parentId);
					window.location.href = "knowledge.html"; 
      }
      
      function url_replace(str)
			{
					var reg = /((http|ftp|https):\/\/)?[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/g;
					str=str.replace(reg,function(a){
					    if(!a.indexOf('http'))
					    {
					    	return '<a href="'+a+'" target="_blank">'+a+'</a>';
					    }else
					    {
					    	return '<a href="http://'+a+'" target="_blank">'+a+'</a>';
					    }
					});
					return str;
			}
			
			function url_replace1(str)
			{
					var reg = /((http|ftp|https):\/\/)?[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/g;
					str=str.replace(reg,function(a){
					    if(!a.indexOf('http'))
					    {
					    	return "<a href=\'"+a+"\' target=\'_blank\'>"+a+"</a>";
					    }else
					    {
					    	return "<a href=\'http://"+a+"\' target=\'_blank\'>"+a+"</a>";
					    }
					});
					return str;
			}			
			
			function  formatDate(now)
			{
			    var   now= new Date(now);     
			    var   year=now.getFullYear();     
			    var   month=now.getMonth()+1;     
			    var   date=now.getDate();     
			    var   hour=now.getHours();
			    var   minute=now.getMinutes();     
			    var   second=now.getSeconds();
			    return fixZero(date,2)+"/"+fixZero(month,2)+"/"+year;
			}
			
			function  formatDate1(now)
			{
			    var   now= new Date(now);     
			    var   year=now.getFullYear();     
			    var   month=now.getMonth()+1;     
			    var   date=now.getDate();     
			    var   hour=now.getHours();
			    var   minute=now.getMinutes();     
			    var   second=now.getSeconds();
			    return   year+"-"+fixZero(month,2)+"-"+fixZero(date,2)+" "+fixZero(hour,2)+":"+fixZero(minute,2)+":"+fixZero(second,2); 
			}
			
			function  formatDate2(str_date)
			{
			    var arr = str_date.split("/");
			    var year = arr[2];
			    var month = arr[1];
			    var date = arr[0];
			    return   year+"-"+fixZero(month,2)+"-"+fixZero(date,2)+" 00:00:00"; 
			}
			
			function fixZero(num,length)
			{     
			    var str=""+num;
			    var len=str.length;     var s="";
			    for(var i=length;i-->len;)
			    {         
			        s+="0";
			    }
			    return s+str;
			}
			
			function show_loading()
			{
					$('#loading_id').on('show.bs.modal', function(){
	          var $this = $(this);
	          var $modal_dialog = $this.find('.modal-dialog');
	          $this.css('display', 'block');
	          $modal_dialog.css({'margin-top': Math.max(0, ($(window).height() - $modal_dialog.height()) / 2) });
	        });
					$('#loading_id').modal('show');
			}
			
			function deleteId()
      {      		
      		show_loading();
					$.get("visa/delete", {
						id: v.orderId
					}, function(result) {
						$('#loading_id').modal('hide');
						if(result.data)
						{
								v.orderId = 0;
								$('#delete_id').modal('hide');
								$('#delete_id #alert_success').css('marginLeft','30%');
				   			$('#delete_id #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
								//v.table_remove();
		   					//重新载入数据源
		   					v.getDatalist();
		   					$('.modal-backdrop').remove();
						}else
						{								
								$('#delete_id #alert_error').css('marginLeft','30%');
				   			$('#delete_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
        				$("#delete_id #error_info").html(result.message);
						}
					});      		
      }
      
      function invoice_cancel(invoiceNo,invoiceIds)
			{
					var str_url = url+'invoice/updateState';
					var json = {};
					json['invoiceNo'] = invoiceNo;
					json['invoiceIds'] = invoiceIds;
					show_loading();
					$.post(str_url, json,
		   		function(data){
		   				$('#loading_id').modal('hide');
		   				if (data.code == 0)
		   				{
		   						$('#showconfirmbox_id #alert_success').css('marginTop','30%');
			   					$('#showconfirmbox_id #alert_success').css('marginLeft','30%');
			   					$('#showconfirmbox_id #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
			   					$('#showconfirmbox_id').modal('hide');
			   					v.getDatalist();
			   					$('.modal-backdrop').remove();
		   				}else
		   				{
		   						$('#showconfirmbox_id #alert_error').css('marginTop','30%');
			   					$('#showconfirmbox_id #alert_error').css('marginLeft','30%');
			   					$('#showconfirmbox_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
	          			$("#showconfirmbox_id #error_info").html(data.message);
		        			return false;
		   				}
		   		});
			}

			function show_confirmbox(invoiceNo,invoiceIds)
			{
					v.invoiceNo = invoiceNo;
					v.invoiceIds = invoiceIds;
					$('#showconfirmbox_id').on('show.bs.modal', function(){
			      var $this = $(this);
			      var $modal_dialog = $this.find('.modal-dialog');
			      $this.css('display', 'block');
			      $modal_dialog.css({'margin-top': Math.max(0, ($(window).height() - $modal_dialog.height()) / 2) });
			    });
					$('#showconfirmbox_id').modal('show');
			}
			
	    jQuery(document).ready(function() {
	    });
		</script>
	</body>

</html>