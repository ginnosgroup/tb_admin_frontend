<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<meta http-equiv="Pragma" content="no-cache" />   
		<meta http-equiv="Cache-Control" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<link rel="shortcut icon" href="img/favicon.ico">
		<title>客户管理</title>
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet">
		<link href="assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-datepicker/css/datepicker.css"><!-- BOOTSTRAP DATEPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-timepicker/compiled/timepicker.css"><!-- BOOTSTRAP TIMEPICKER PLUGIN CSS -->		
		<link rel="stylesheet" type="text/css" href="css/jquery.autocompleter.css">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link href="css/index.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body id="users" v-cloak>
		<section id="container">
			<header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-placement="right" class="fa fa-bars tooltips">
					</div>
				</div>
				<a href="main.html" class="logo">
					佣金系统
					<span v-if="ap_list==='KJ'">
           	 会计
          </span>
          <span v-if="ap_list==='GW'">
           	 顾问
          </span>
          <span v-if="ap_list==='WA'">
           	 文案
          </span>
          <span v-if="ap_list==='MA'">
           	 Mara
          </span>
          <span v-if="ap_list==='SUPERAD'">
           	 超级管理员
          </span>
				</a>
				<div class="top-nav ">
					<ul class="nav pull-right top-menu">
						<li style="padding-right:15px;"><a href="knowledge-detail.html?id=1000164" style="color:#ff6c60;">帮助中心</a></li>
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="username">
                  {{admin}}
                </span>
								<b class="caret">
                </b>
							</a>
							<ul class="dropdown-menu extended logout">
								<li class="log-arrow-up">
								</li>
								<li>
									<a href="password.html">
										<i class="fa fa-key">
                    </i> 修改密码
									</a>
								</li>
								<li><a href="javascript:tb.out();">
										<i class="fa fa-user">
                    </i> Log Out
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</header>
			<aside>
				<div id="sidebar" class="nav-collapse">
					<ul class="sidebar-menu" id="nav-accordion">
						<li >
              <a href="main.html">
                <i class="fa fa-dashboard">
                </i>
                <span>
                  Dashboard
                </span>
              </a>
            </li>
            <dli v-if="ap_list==='SUPERAD'">            
            <li>
              <a href="adviser.html">
                <i class="fa fa-book">
                </i>
                <span>
                  顾问管理
                </span>
              </a>
            </li>
            </dli>
            <dli v-if="ap_list==='SUPERAD' || (ap_list==='WA' && wa_admin === 'true')"> 
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 文案管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="official.html">
										文案管理
									</a>
								</li>
								<li>
									<a href="official-tag.html">
										订单标签管理
									</a>
								</li>								
							</ul>
						</li>
            </dli>
            <dli v-if="ap_list==='SUPERAD'">
            <li>
              <a href="mara.html">
                <i class="fa fa-book">
                </i>
                <span>
                  MARA管理
                </span>
              </a>
            </li>
            <li>
              <a href="accounting.html">
                <i class="fa fa-book">
                </i>
                <span>
                  会计管理
                </span>
              </a>
            </li>
            </dli>
          	<dli v-if="ap_list==='SUPERAD' || (ap_list==='GW' && gw_regionid !== 'null')">
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 学校管理
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="school.html">
										学校管理
									</a>
								</li>
								<li>
									<a href="school-setting.html">
										佣金设置
									</a>
								</li>								
							</ul>
						</li>
						</dli>
						<dli v-if="ap_list==='SUPERAD'">
            <li>
              <a href="receive-type.html">
                <i class="fa fa-book">
                </i>
                <span>
                  收款方式管理
                </span>
              </a>
            </li>
            <li>
              <a href="subagency.html">
                <i class="fa fa-book">
                </i>
                <span>
                  Subagency管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
            	<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 服务管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="service.html">
										服务项目管理
									</a>
								</li>
								<li>
									<a href="service-package.html">
										服务包管理
									</a>
								</li>
								<li>
									<a href="visa-ca.html">
										签证职业评估管理
									</a>
								</li>							
							</ul>              
            </li>
          	</dli>
          	<li v-if="ap_list!=='KJ' && ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;" class="active">
								<i class="fa fa-book">
                </i>
								<span>
                 	 客户管理
                </span>
							</a>
							<ul class="sub">
								<li class="active">
									<a href="users.html">
										客户管理
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="user-tags.html">
										标签管理
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='KJ'" class="sub-menu">
							<a href="serviceorder-list.html">
                <i class="fa fa-book">
                </i>
                <span>
                  服务订单管理
                </span>
              </a>
						</li>           	
            <li v-if="ap_list==='SUPERAD'" class="sub-menu" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 渠道管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="source.html">
										渠道列表
									</a>
								</li>
								<li>
									<a href="source-type.html">
										来源分类
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 佣金表
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'">
									<a href="mycommission.html">
										我的佣金报表
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_PENDING">
									<a href="mycommission.html?applyState=PENDING">
										未申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_COMPLETE">
									<a href="mycommission.html?applyState=COMPLETE">
										已申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_DJY">
									<a href="mycommission-accounting.html?commission_state=DJY">
										待结佣订单
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_YJY">
									<a href="mycommission-accounting.html?commission_state=YJY">
										已结佣订单
									</a>									
								</li>								
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="mycommission-check-accounting.html">
										自动对账
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="create-visa-commission.html">
										重建签证佣金表订单
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="table-export.html">
										导出数据
									</a>
								</li>
							</ul>
						</li>
						<li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 知识库
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="knowledge-menu.html">
										菜单管理
									</a>
								</li>
								<li>
									<a href="knowledge.html">
										知识库菜单
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</aside>
			<section id="main-content" class="content">
				<section class="wrapper site-min-height">
					<div class="row">
						<div class="col-lg-12">
							<section class="panel">
								<header class="panel-heading">
									客户管理
								</header>
								<div class="panel-body">
									<div class="adv-table editable-table">
										<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
									      <button data-dismiss="alert" class="close close-sm" type="button">
									      <i class="fa fa-times"></i>
									      </button>
									      <strong>Success!</strong> You  just achieved success.
									  </div>
									  <div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
                      <button data-dismiss="alert" class="close close-sm" type="button">
                      <i class="fa fa-times"></i>
                      </button>
                      <strong id="error_info"></strong>
                   </div>
										<div class="clearfix">
                       <div class="btn-group">
                          <button id="editable-sample_new" class="btn btn-success green" onclick="addNew();">
                          Add New <i class="fa fa-plus"></i>
                          </button>
                       </div>
                       <div class="btn-group">
                          <button id="editable-sample_new" class="btn btn-info" onclick="add_service3(0,0,'');">
                          独立技术移民 <i class="fa"></i>
                          </button>
                       </div>
                       <div class="btn-group">
                          <button id="editable-sample_new" class="btn btn-info" onclick="add_service1(0,0,'');">
                          签证服务 <i class="fa"></i>
                          </button>
                       </div>
                       <div class="btn-group">
                          <button id="editable-sample_new" class="btn btn-info" onclick="add_service2(0,0,'');">
                          留学服务 <i class="fa"></i>
                          </button>
                       </div>
                    </div>
                    <form class="form-inline" style="margin-top:10px;">
											<div class="form-group">
												<input v-model.trim="name" type="text" class="form-control" placeholder="输入姓名">
												<input v-model.trim="phone" type="text" class="form-control" placeholder="输入手机号码">
												<select v-if="ap_list==='SUPERAD' || (ap_list==='GW' && gw_regionid !== 'null')" v-model.trim="adviserId" id="adviserId" class="form-control" style="width:130px;"></select>
												<input v-model.trim="wechatUsername" type="text" class="form-control" placeholder="输入客户微信号">
												<select v-model.trim="tagId" id="tagId" class="form-control" style="display:none;">
												<option value="" selected="true">请选择标签</option>
												</select>
											</div>
											<div class="form-group">
												<button @click="getUser" type="button" class="btn btn-info">查询</button>
											</div>
										</form>
										<div class="responsive-table margin-top">
											<input type="hidden" name="id" id="id" value="0" />
											<table class="display table table-bordered table-striped" id="example">
												<thead>
													<tr>
														<!--<th><input @click="checked" type="checkbox"></th>-->
														<th>ID</th>
														<th>昵称</th>
														<th>姓名(拼音)&nbsp;<a @click="getOrder1" href="javascript:;">排序</a></th>
														<th>初次咨询记录</th>														
														<th>生日&nbsp;<a @click="getOrder2" href="javascript:;">排序</a></th>
														<th>手机号码&nbsp;<a @click="getOrder3" href="javascript:;">排序</a></th>
														<th>所持签证类别号</th>
														<th>签证到期日期</th>
														<th>微信号</th>											
														<th>客户来源</th>														
														<th>客户标签</th>
														<th>所属顾问</th>
														<th>咨询提醒</th>
														<th>服务项目</th>
														<th>Edit</th>
														<th>Delete</th>
													</tr>
												</thead>
												<tbody>
													<tr v-for="item in subject" class="gradeX">
														<td v-html="item.oid"></td>
														<td v-html="item.authNickname"></td>
														<td v-html="item.name"></td>
														<td v-html="item.firstControllerContents"></td>														
														<td v-html="item.birthday"></td>
														<td v-html="item.phone"></td>
														<td v-html="item.visaCode"></td>													
														<td v-html="item.visaExpirationDate"></td>
														<td v-html="item.wechatUsername"></td>
														<td v-html="item.source"></td>
														<td v-html="item.str_tagListName"></td>
														<td @dblclick="table_edit($index,'adviserName','u1')"><span v-html="item.adviserName"></span></td>
														<td v-html="item.consultation"></td>
														<td v-html="item.service"></td>
														<td><a v-if="item.id" class="edit" href="javascript:;" @click="table_modify($index)"><span class="label label-success">Edit</span></a>
																<a v-else class="edit" href="javascript:;"><span class="label label-primary">Save</span></a>
														</td>
														<td><a v-if="item.id" class="delete" href="#" @click="delete_confirm($index,item.id)"><span class="label label-danger">Delete</span></a>
																<a v-else class="cancel" href="javascript:;"><span class="label label-info">Cancel</span></a>
														</td>														
													</tr>
												</tbody>
											</table>
										</div>
										<div class="row-fluid">
											<div class="span6">
												<div class="dataTables_info" id="hidden-table-info_info">共{{count}}条</div>
											</div>
											<div class="span6">
												<div class="dataTables_paginate paging_bootstrap pagination">
													<ul>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="firstPage" href="javascript:;">首页</a>
														</li>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="prevPage" href="javascript:;">← Pre</a>
														</li>
														<li class="nowPage" style="padding: 0px 0px;margin: 0 1px;">
															第{{pageNum+1}}页/共{{allPage}}页&nbsp;
															跳到 <input type="text" v-model.trim="pnumber" @keyup.enter="submit" style="width:50px;color:#c7c7c7;border: 1px solid #ddd;border-radius: 3px;-webkit-border-radius: 3px;padding: 5px 10px;display: inline-block;" id="b100" placeholder="" value=""> 页
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="nextPage" href="javascript:;">Next → </a>
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="lastPage" href="javascript:;">末页</a>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
							</section>
						</div>
					</div>
				</section>
			</section>
			<footer class="site-footer">
				<div class="text-center">
					2018 &copy; 佣金系统 by <span style="color:#2a8ba7;">GIG</span>.
					<a href="#" class="go-top">
						<i class="fa fa-angle-up">
            </i>
					</a>
				</div>
			</footer>
		</section>
		<div class="modal fade" id="delete_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">删除</h4>
					</div>
					<div class="modal-body">
						确认删除吗？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="deleteId()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="close_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="close_title">关闭</h4>
					</div>
					<div class="modal-body">
						确认<span id="close_title1">关闭</span>吗？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="closeId()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="add_tag" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="tag_title">选择</h4>
					</div>
					<div class="modal-body">
							<form class="form-horizontal" autocomplete="off">
							<input type="hidden" id="tag_list" name="tag_list" value="" />
							<table class="display table table-bordered table-striped" id="example6">
							<thead>
								<tr>
									<th>选择</th>
									<th>标签名称</th>									
								</tr>
							</thead>
							<tbody>
							<tr v-for="item in subject1" class="gradeX">
								<td v-html="item.chk"></td>
								<td v-html="item.name"></td>
							</tr>
							</tbody>
							</table>						
							</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="tagUpdate()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="consultation_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">添加记录</h4>
					</div>
					<div class="modal-body">
							<form class="form-horizontal" autocomplete="off">							
							<div class="form-group">
								<label class="col-sm-3 control-label">咨询内容<span style="color:red;">*</span></label>
								<div class="col-sm-8">
									<textarea id="t0" class="form-control" style="height:100px;"></textarea>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">下次提醒日期</label>
								<div class="col-sm-8">
									<input type="text" id="t1" class="form-control default-date-picker1" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">提醒内容</label>
								<div class="col-sm-8">
									<textarea id="t2a" class="form-control" style="height:100px;"></textarea>
								</div>
							</div>
							</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="consultationAddSave()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>		
		<div class="modal fade" id="addnew_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
			<div class="modal-dialog" role="document" style="width:700px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">添加客户</h4>
					</div>
					<form class="cmxform form-inline" style="" name="addnewid_form" id="addnewid_form">
					<div class="modal-body">							
							<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
						      <button data-dismiss="alert" class="close close-sm" type="button">
						      <i class="fa fa-times"></i>
						      </button>
						      <strong>Success!</strong> You  just achieved success.
						  </div>
						  <div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
                <button data-dismiss="alert" class="close close-sm" type="button">
                <i class="fa fa-times"></i>
                </button>
                <strong id="error_info"></strong>
             </div>						
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="color:red;">客户昵称</label>
								<input type="text" class="form-control small" style="width:200px;" name="a1" id="a1" placeholder="请输入客户的昵称" value="">								
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="color:red;">客户的姓</label>
								<input type="text" autocomplete="off" name="a2" id="a2" class="form-control" style="width:200px;" onKeyUp="value=value.replace(/[^a-zA-Z ]/g,'').toUpperCase();" placeholder="请输入客户姓的拼音" >
								<label class="control-label" style="color:red;">客户的名</label>
								<input type="text" autocomplete="off" name="a2b" id="a2b" class="form-control" style="width:200px;" onKeyUp="value=value.replace(/[^a-zA-Z]/g,'').substring(0, 1).toUpperCase()+value.replace(/[^a-zA-Z ]/g,'').substring(1);" placeholder="请输入客户名的拼音" >
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="color:red;">手机号码</label>
								<input type="text" autocomplete="off" name="a3" id="a3" class="form-control" style="width:200px;" placeholder="请输入手机号码" >
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label">微信账号</label>
								<input type="text" autocomplete="off" name="a4" id="a4" class="form-control" style="width:200px;" placeholder="请输入微信号" >
							</div>
							<div class="form-group" style="height:40px;">
								<label class="control-label">客户生日</label>
								<input type="text" autocomplete="off" name="a5" id="a5" class="form-control default-date-picker" style="width:200px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
							</div>
							<div class="form-group" style="width:100%;line-height:40px;">
								<label class="control-label">客户来源</label>
								<select class="form-control" style="width:200px;" name="a6" id="a6"></select>
							</div>						
							<div class="form-group" style="width:100%;line-height:40px;">
								<label class="control-label" style="color:red;">所属顾问</label>
								<select class="form-control" style="width:200px;" name="a7" id="a7"></select>
							</div>							
							<div class="form-group" style="width:100%;line-height:40px;">
								<label class="control-label">初次咨询记录</label>
								<textarea id="a8" class="form-control" style="width:98%"></textarea>
							</div>							
					</div>
					<div class="modal-footer" style="text-align: center;">						
						<button id="btnSubmit1" type="submit" class="btn btn-primary"><span id="btn_id">提交并增加服务</span></button>
						<button onclick="addNewSave(0)" type="button" class="btn btn-primary">仅提交</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>
				</form>
			</div>
		</div>
		<div class="modal fade" id="loading_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static' style="z-index:99999;">
			<div class="modal-dialog" role="document" style="width:350px;">
				<div class="modal-content">
					<div class="modal-header">
					</div>
					<div class="modal-body">
							<div style="text-align:center;color:#0066CC;"><img src="img/input-spinner.gif" /> 正在执行，请稍后...</div>
					</div>
					
				</div>
			</div>
		</div>		
		<div id="load-user-common-page"></div>
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.dcjqaccordion.2.7.js"></script>
		<script src="js/jquery.scrollTo.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>
		<script src="assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script><!-- BOOTSTRAP DATEPICKER JS  -->
    <script src="assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script><!-- BOOTSTRAP DATETIMEPICKER JS  -->
    <script src="js/jquery.autocompleter.js"></script>
    <script src="js/jquery.validate.min.js"></script><!-- VALIDATE JS  -->
		<script src="js/common-scripts.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/common.js?verson=1"></script>
		<script>
			$("#load-user-common-page").load("user-common.html?random="+Math.random());
			tb.isLogin("users.html");
			$("td,th").addClass("text-center");
			var v = new Vue({
				el: '#users',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),
					gw_regionid: sessionStorage.getItem("gw_regionid"),
					wa_admin: sessionStorage.getItem("wa_admin"),
					adviser_id: sessionStorage.getItem("adviser_id"),
					addnewservice1_bind: 0,
					addnewservice2_bind: 0,
					addnewservice3_bind: 0,
					orderId : 0,
					country: '',
					allSort: [],
					subject: [],
					subject1: [],
					tagList: '',
					count: 0,
					dId: '',
					eId: '',
					name: '',
					user_id: 0,
					user_name: '',
					sort: '',
					state: '',
					pageNum: 0,
					pageSize: 20,
					allPage: 0,
					add: false,
					current_index: '',
					current_row: '',
					orderby: true,
					index: 0,
					close: false
				},
				created: function() {
					this.getDatalist();
					document.onkeydown = function(e) {
						var key = window.event.keyCode;
						if (key == 13) v.gotoPage();
					};
					//this.getSort();
				},
				methods: {
					getSort: function() {
						var that = this;
						show_loading();
						$.get(url + "user/list", {
							state: "",
							pageNum: 0,
							pageSize: 1000000
						}, function(result) {
							console.log(result)
							that.allSort = result.data;
							$('#loading_id').modal('hide');
						});
					},
					getDatalist: function() {
						var that = this;
						var json = {};
						show_loading();
						if (this.gw_regionid != 'null')
						{
								if (this.adviserId == undefined)
								{
										json['adviserId'] = this.adviser_id;
								}else
								{
										if (that.adviserId != '0') json['adviserId'] = that.adviserId;
								}
						}else
						{
								if (that.adviserId != '0') json['adviserId'] = that.adviserId;
						}
						$.get(url + "user/count", json, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						json['pageNum'] = that.pageNum;
						json['pageSize'] = that.pageSize;
						$.get(url + "user/list", json, function(result) {
							//console.log(result)
							that.pageNum = 0;							
							that.subject = return_result(result);
							$('#loading_id').modal('hide');
							//console.log(that.subject);
						});
					},
					getUser: function() {
						var that = this;
						show_loading();
						if (that.adviserId == undefined) that.adviserId = that.adviser_id;
						if (that.adviserId == 'null') that.adviserId = '';
						$.get(url + "user/count", {
							name: that.name,
							phone: that.phone,
							adviserId: that.adviserId,
							wechatUsername: that.wechatUsername,
							//tagId: that.tagId
						}, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						$.get(url + "user/list", {
							name: that.name,
							phone: that.phone,
							adviserId: that.adviserId,
							wechatUsername: that.wechatUsername,
							//tagId: that.tagId,
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							//console.log(result)
							that.pageNum = 0;
							that.subject = return_result(result);
							$('#loading_id').modal('hide');
							//console.log(that.subject);
						});
					},
					getOrder1: function() {
						var that = this;
						show_loading();
						if (v.orderby == true)
						{
								v.orderby = false;
						}else
						{
								v.orderby = true;
						}
						$.get(url + "user/count", {							
						}, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						$.get(url + "user/list?orderByField=name&isDesc="+v.orderby, {							
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							//console.log(result)
							that.pageNum = 0;
							that.subject = return_result(result);
							$('#loading_id').modal('hide');
							//console.log(that.subject);
						});
					},
					getOrder2: function() {
						var that = this;
						show_loading();
						if (v.orderby == true)
						{
								v.orderby = false;
						}else
						{
								v.orderby = true;
						}
						$.get(url + "user/count", {							
						}, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						$.get(url + "user/list?orderByField=birthday&isDesc="+v.orderby, {							
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							//console.log(result)
							that.pageNum = 0;
							that.subject = return_result(result);
							$('#loading_id').modal('hide');
							//console.log(that.subject);
						});
					},
					getOrder3: function() {
						var that = this;
						show_loading();
						if (v.orderby == true)
						{
								v.orderby = false;
						}else
						{
								v.orderby = true;
						}
						$.get(url + "user/count", {							
						}, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						$.get(url + "user/list?orderByField=phone&isDesc="+v.orderby, {							
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							that.pageNum = 0;
							that.subject = return_result(result);
							$('#loading_id').modal('hide');
							//console.log(that.subject);
						});
					},
					getTime: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y;
						return date2;
					},
					addZero: function(obj) {
						if(obj < 10) {
							obj = '0' + obj;
						};
						return obj;
					},
					firstPage: function() {
						var that = this;						
						if(that.pageNum > 0) {
							show_loading();
							$.get(url + "user/list", {
								name: that.name,
								phone: that.phone,
								adviserId: that.adviserId,
								wechatUsername: that.wechatUsername,
								//tagId: that.tagId,
								pageNum: 0,
								pageSize: that.pageSize
							}, function(result) {
								that.pageNum = 0;
								that.subject = return_result(result);
								$('#loading_id').modal('hide');
							});
						}
					},
					prevPage: function() {
						var that = this;						
						if(that.pageNum > 0) {
							show_loading();
							that.pageNum--;
							$.get(url + "user/list", {
								name: that.name,
								phone: that.phone,
								adviserId: that.adviserId,
								wechatUsername: that.wechatUsername,
								//tagId: that.tagId,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								that.subject = return_result(result);
								$('#loading_id').modal('hide');
							});
						}
					},
					nextPage: function() {
						var that = this;						
						if(that.pageNum < that.allPage - 1) {
							show_loading();
							that.pageNum++;
							$.get(url + "user/list", {
								name: that.name,
								phone: that.phone,
								adviserId: that.adviserId,
								wechatUsername: that.wechatUsername,
								//tagId: that.tagId,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								that.subject = return_result(result);
								$('#loading_id').modal('hide');
							});
						}
					},
					lastPage: function() {
						var that = this;						
						if(that.pageNum < that.allPage - 1) {
							show_loading();
							$.get(url + "user/list", {
								name: that.name,
								phone: that.phone,
								adviserId: that.adviserId,
								wechatUsername: that.wechatUsername,
								//tagId: that.tagId,
								pageNum: that.allPage - 1,
								pageSize: that.pageSize
							}, function(result) {
								that.subject = return_result(result);
								$('#loading_id').modal('hide');
							});
						}
					},
					gotoPage: function() {
						var that = this;
						that.pageNum = parseInt(that.pnumber);
						if (that.pageNum > that.allPage)
						{
								that.pnumber = that.allPage;
								that.pageNum = that.allPage;
						}
						
						if(that.pageNum <= that.allPage) {
							show_loading();
							that.pageNum = that.pageNum - 1;							
							$.get(url + "user/list", {
								name: that.name,
								phone: that.phone,
								adviserId: that.adviserId,
								wechatUsername: that.wechatUsername,
								//tagId: that.tagId,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								$('#loading_id').modal('hide');
							});
						}
					},
					table_insert() {
						if (!this.add)
						{
								$("#id").val('0');
								if (this.current_index != null)
								{
										this.subject[this.current_index] = this.current_row;
										this.current_index = '';
										this.current_row = '';
								}
								dId = 0;																			
								this.subject.splice(0,0, {
									id:'',									
									name: '<input type="text" class="form-control small" style="" id="t0" onKeyUp="value=value.replace(/[^a-zA-Z ]/g,\'\')" value="">',
									firstControllerContents: '<textarea id="t13" class="form-control" style=""></textarea>',
									authNickname: '<input type="text" class="form-control small" style="" id="t1" value="">',
									birthday: '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:80px;" id="t2" data-date-format="dd-mm-yyyy" value="">',
									phone: '<input type="text" class="form-control small" style="" id="t3" value="">',
									visaCode: '<input type="text" class="form-control small" style="" id="t10" value="">',
									visaExpirationDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:80px;" id="t11" data-date-format="dd-mm-yyyy" value="">',
									wechatUsername: '<input type="text" class="form-control small" style="" id="t13" value="">',
									source: '<select class="form-control" style="" id="t12"></select>',
									str_tagListName: '',
									adviserName: '<select class="form-control" style="" id="t4"></select>',
									consultation: '',
									});									
								this.add = true;
						}
					},
					table_modify: function (index) {						
						if (this.current_index != null)
						{
								if (this.add)
								{
										this.subject[this.current_index-1] = this.current_row;
								}else
								{
										this.subject[this.current_index] = this.current_row;
								}
						}
						this.current_index = index;
						this.current_row = this.subject[index];
						v.dId = this.subject[index].id;
						tagList = this.subject[index].str_tagList;
						this.subject[index].name = delHtmlTag(this.subject[index].name);
						this.subject[index].authNickname = delHtmlTag(this.subject[index].authNickname);
						if (this.subject[index].imageUrl == null) this.subject[index].imageUrl = '';
						if (this.subject[index].firstControllerContents == null) this.subject[index].firstControllerContents = '';
						if (this.subject[index].visaCode == null) this.subject[index].visaCode = '';
						if (this.subject[index].visaExpirationDate == null) this.subject[index].visaExpirationDate = '';
						if (this.subject[index].wechatUsername == null) this.subject[index].wechatUsername = '';
						if (this.subject[index].source == null) this.subject[index].source = '';
						this.subject.splice(index,1, {
							oid: parseInt(this.subject[index].id),
							name: '<input type="text" class="form-control small" style="" id="t0" onKeyUp="value=value.replace(/[^a-zA-Z ]/g,\'\')" value="'+this.subject[index].name+'">',
							firstControllerContents: '<textarea id="t13" class="form-control" style="">'+this.subject[index].firstControllerContents+'</textarea>',							
							authNickname: '<input type="text" class="form-control small" style="" id="t1" value="'+this.subject[index].authNickname+'">',
							birthday: '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:80px;" id="t2" data-date-format="dd-mm-yyyy" value="'+this.subject[index].birthday+'">',
							phone: '<input type="text" class="form-control small" style="" id="t3" value="'+this.subject[index].phone+'">',
							visaCode: '<input type="text" class="form-control small" style="" id="t10" value="'+this.subject[index].visaCode+'">',
							visaExpirationDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:80px;" id="t11" data-date-format="dd-mm-yyyy" value="'+this.subject[index].visaExpirationDate+'">',
							wechatUsername: '<input type="text" class="form-control small" style="" id="t13" value="'+this.subject[index].wechatUsername+'">',
							source: '<select class="form-control" style="" id="t12"></select>',
							str_tagListName: '<a href="javascript:tagSet(\''+tagList+'\')">设置</a>',
							adviserName: '<select class="form-control" style="" id="t4"></select>',
							consultation: '',							
						});						
						if (this.add)
						{
								this.subject.splice(0, 1);
								this.add = false;
								this.current_index = index-1;								
						}
						//alert(this.current_row.id);																			
					},
					table_remove: function (index) {
             this.subject.splice(index, 1);  
          },
          table_edit: function (index,field,byid) {
						if (this.ap_list == 'GW' && this.gw_regionid != '')
						{
								if (this.current_index != null)
								{
										this.subject[this.current_index] = this.current_row;
								}						
								v.update_field = field;
								v.update_byid = byid;
								this.current_index = index;
								this.current_row = this.subject[index];
								v.dId = this.subject[index].id;
								var json = {};
								json['oid'] = this.subject[index].oid;
								json['authNickname'] = this.subject[index].authNickname;
								json['name'] = this.subject[index].name;
								json['firstControllerContents'] = this.subject[index].firstControllerContents;
								json['birthday'] = this.subject[index].birthday;
								json['phone'] = this.subject[index].phone;
								json['visaCode'] = this.subject[index].visaCode;
								json['visaExpirationDate'] = this.subject[index].visaExpirationDate;
								json['wechatUsername'] = this.subject[index].wechatUsername;
								json['source'] = this.subject[index].source;
								json['str_tagListName'] = this.subject[index].str_tagListName;
								json['consultation'] = this.subject[index].consultation;
								json['service'] = this.subject[index].service;
								if (field == 'adviserName' && this.ap_list == 'GW' && this.gw_regionid != '')
								{
										json['adviserName'] = '<select class="form-control" style="width:120px;" id="'+byid+'" style="background: #F0FFFF;color: #428bca;"></select><div style="padding-top:10px;"><a class="save1" href="javascript:;"><span style="color:blue;">保存</span></a>&nbsp;&nbsp;<a class="cancel" href="javascript:;">取消</a></div>';
								}
								this.subject.splice(index,1, json);
						}
					},
          delete_confirm: function (index,id) {
          	$('#delete_id').modal('show');
          	this.dId = id;
          	this.index = index;
          },
          show_detail: function (id){
          	sessionStorage.setItem("userId", id);
						window.location.href = "user-detail.html";     
			    },
			    tag_set: function (tagList){		      		
		      		var that = this;
		      		//读取客户的标签列表
		      		var arr = Array();
		      		$('#tag_list').val(tagList);
		      		arr = tagList.split(",");
							$.get(url + "user/listTag", {						
							}, function(result) {								
								for(var i = 0; i < result.data.length; i++) {
										result.data[i].oid = result.data[i].id;										
										var a = arr.indexOf(result.data[i].id.toString());
										if (a != -1)
										{
												str_checked = ' checked="true" ';
										}else
										{
												str_checked = '';
										}
										result.data[i].chk = '<input type="checkbox" name="chk"'+str_checked+' value="'+result.data[i].id+'" />';
								}
								that.subject1 = result.data;						
							});      		
		      }
				}		
			});						
			
			$('#example a.edit').live('click', function (e) {
				e.preventDefault();
				table_addsave();
			});
			
			$('#example a.cancel').live('click', function (e) {
				e.preventDefault();
				if (!parseInt($("#id").val()))
				{
						v.subject.splice(0, 1);
						v.add = false;
				}else
				{
						v.subject.splice(v.current_index, 0);
						v.subject.splice(v.current_index,1, v.current_row);
				}
			});
			
			$('#example a.save1').live('click', function (e) {
					e.preventDefault();
					table_changeAdviser();
			});
			
			function return_result(result)
			{
					for(var i = 0; i < result.data.length; i++) {
							result.data[i].oid = result.data[i].id;
							result.data[i].service = '<a href="javascript:;" onclick="add_service3(0,\''+result.data[i].id+'\',\''+result.data[i].name+'\')"><span class="label label-primary">独立技术移民</span></a>&nbsp;<a href="javascript:;" onclick="add_service1(0,\''+result.data[i].id+'\',\''+result.data[i].name+'\')"><span class="label label-primary">签证</span></a>&nbsp;<a href="javascript:;" onclick="add_service2(0,\''+result.data[i].id+'\',\''+result.data[i].name+'\')"><span class="label label-primary">留学</span></a>';
							result.data[i].name = '<a href="javascript:;" onclick="show_detail('+result.data[i].id+');">'+result.data[i].name+'</a>';									
							result.data[i].authNickname = '<a href="javascript:;" onclick="show_detail('+result.data[i].id+');">'+result.data[i].authNickname+'</a>';
							if (result.data[i].birthday)
							{
									result.data[i].birthday = v.getTime(result.data[i].birthday);
							}else
							{
									result.data[i].birthday = '';
							}
							if (result.data[i].visaExpirationDate)
							{
									result.data[i].visaExpirationDate = v.getTime(result.data[i].visaExpirationDate);
							}else
							{
									result.data[i].visaExpirationDate = '';
							}
							if (result.data[i].adviserDto)
							{
									result.data[i].adviserName = result.data[i].adviserDto.name;
							}else
							{
									result.data[i].adviserName = '';
							}
							result.data[i].consultation = '<a href="javascript:;" onclick="add_consultation(\''+result.data[i].id+'\')"><span class="label label-success">添加提醒</span></a>';									
							//读取标签
							result.data[i].str_tagList = '';
							result.data[i].str_tagListName = '';
							var str = '';
							var str_name = '';
							if (result.data[i].tagList)
							{
									for(var t = 0; t < result.data[i].tagList.length; t++) {
											if (str == '')
											{
													str = result.data[i].tagList[t].id;
													str_name = '['+result.data[i].tagList[t].name+']';
											}else
											{
													str += ','+result.data[i].tagList[t].id;
													str_name += '<br/>['+result.data[i].tagList[t].name+']';
											}
									}
							}
							result.data[i].str_tagList = str;
							result.data[i].str_tagListName = str_name + '<a href="javascript:v.dId='+result.data[i].id+';tagSet(\''+str+'\')">设置</a>';
					};
					return result.data;
			}				
			
			function addNew()
			{
					$('#addnew_id').modal('show');					
			}
			
			function table_addsave()
			{
          var jqInputs = $('input',$("#example"));
          var jqSelect = $('select',$("#example"));
          var jqTextarea = $('textarea',$("#example"));
          //$.ajaxSettings.async = false;
          
          var check_result = 1;
          /*if (jqInputs[1].value != '' && jqInputs[3].value != '')
          {
          		check_result = true;
          }else
          {          		
          		$('#alert_error').addClass('alert-danger').show().delay(1500).fadeOut();
          		$("#error_info").html('姓名(拼音)和手机号必须填写！');
          		return false;
          }*/          
          
          if (check_result)
          {
          		var arr_d = new Array();
          		var str_d = '';
          		var date = new Date();
          		var d2 = new Date();
          		if (jqInputs[2].value && jqInputs[2].value != '0')
          		{
		          		arr_d = jqInputs[2].value.split("/");
		          		str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
		              date = new Date(str_d);
		          		d2 = date.getTime();
          		}else
          		{
          				d2 = 0;
          		}
          		var d5 = new Date();          		
          		if (jqInputs[5].value && jqInputs[5].value != '0')
          		{
		          		arr_d = jqInputs[5].value.split("/");
		          		str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
		              date = new Date(str_d);
		          		d5 = date.getTime();
          		}else
          		{
          				d5 = 0;
          		}
              var str_url = url + "user/add";
              var sa_id = $("#id").val();
              if (sa_id != '0') str_url = url + "user/update";
              $("#id").val('0');
              
              $.post(str_url, { id: sa_id, name: jqInputs[1].value, firstControllerContents: jqTextarea[0].value, authNickname: jqInputs[0].value, birthday: d2, phone: jqInputs[3].value, visaCode: jqInputs[4].value, visaExpirationDate: d5, wechatUsername: jqInputs[6].value, source: jqSelect[0].value, adviserId: jqSelect[1].value},
					   	function(data){
					   			if (data.code == 0)
					   			{
					   					//更换顾问
					   					$.post(url + 'user/updateAdviser', { id: sa_id, adviserId: jqSelect[1].value},function(data){});					   					
					   					v.add = false;		
					   					$('.alert').addClass('alert-success').show().delay(1500).fadeOut();
					   					v.table_remove();
					   					//重新载入数据源
					   					v.getDatalist();
					   					v.getSort();
					   			}else
					   			{
					   					$('#alert_error').addClass('alert-danger').show().delay(1500).fadeOut();
					   					$("#error_info").html(data.message);
					   			}
					   			//console.log(data);
					   	});
			  	}                
      }            
      
      function addNewSave(par)
			{          
          var f = '#addnew_id ';
          var json = {};
          
          var check_result = 0;          
          if ($(f+'#a1').val() !='' && $(f+'#a2').val() !='' && $(f+'#a2b').val() !='' && $(f+'#a3').val()!='' && $(f+'#a7').val() != '0')
          {
          		check_result = true;
          }else
          {
          		$('#addnew_id #alert_error').css('marginLeft','30%');
          		$('#addnew_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			        $("#addnew_id #error_info").html('提示：红色字段必须填写或选择！');
          		return false;
          }
          
          if (check_result)
          {
          		json['authNickname'] = $(f+'#a1').val();
          		var str_name = $(f+'#a2').val()+' '+$(f+'#a2b').val();
            	json['name'] = str_name;
            	json['phone'] = $(f+'#a3').val();
            	json['wechatUsername'] = $(f+'#a4').val();            	
          		var d = 0;
          		if ($(f+'#a5').val() != '')
          		{
		          		var arr_d = $(f+'#a5').val().split("/");
		          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
		              var date = new Date(str_d);
		              d = date.getTime();		              
            	}
            	json['birthday'] = d;
            	json['source'] = $(f+'#a6').val();
            	json['adviserId'] = $(f+'#a7').val();
            	json['firstControllerContents'] = $(f+'#a8').val();
            	json['visaCode'] = null;
            	json['visaExpirationDate'] = 0;
                             
             	var str_url = url + "user/add";
	            var sa_id = $("#id").val();
	            if (sa_id != '0') str_url = url + "user/update";
	            $("#id").val('0');	            
              
              $.post(str_url, json,
					   	function(data){
					   			if (data.code == 0)
					   			{	   					   					
					   					$('#addnew_id #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					$('#addnew_id').modal('hide');
					   					if (par == 0)
					   					{
					   							$('#a1').val('');
					   							$('#a2').val('');
					   							$('#a2b').val('');
					   							$('#a3').val('');
					   							$('#a4').val('');
					   							$('#a5').val('');
					   							$('#a8').val('');							   					
					   					}else
					   					{
					   							//弹出新增服务					   							
					   							add_service1(0,data.data,str_name);
					   					}
					   					v.getDatalist();
							   			v.getSort();
					   			}else
					   			{
					   					$('#addnew_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#addnew_id #error_info").html(data.message);
				        			return false;
					   			}
					   			//console.log(data);
					   	});
			  	}                
      }
      
      function table_changeAdviser()
      {
      		var f = '#example ';
					var str_val = $(f+'#'+v.update_byid).val();
					var field = v.update_field;
					var check_result = 0;
					
					if (parseInt(str_val))
					{
							check_result = true;
					}else
					{
							$('#alert_error').css('marginLeft','40%');
			    		$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			        $("#error_info").html('提示：所属顾问 必须选择！');
			    		return false;
					}
					
					if (check_result)
    			{
    					var str_url = url + "user/updateAdviser";
       				var json = {};
       				json['id'] = v.dId;
       				if (field == 'adviserName')
       				{
       					 json['adviserId'] = str_val;
       				} 				
       				       				
       				show_loading();       				
       				$.post(str_url, json,
					   	function(data){
					   			$('#loading_id').modal('hide');
					   			if (data.code == 0)
					   			{
					   					v.dId = 0;
					   					$('#alert_success').css('marginLeft','40%');
					   					$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					v.table_remove();
					   					setTimeout(function(){v.getDatalist();$('.modal-backdrop').remove();}, 1000);
					   			}else
					   			{
					   					$('#alert_error').css('marginLeft','40%');
					   					$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#error_info").html(data.message);
				        			return false;
					   			}				   	
					   	});
    			}
      }            
			
			v.$watch('subject', function(obj) {
					$('.default-date-picker').datepicker({   				
				        format: 'dd/mm/yyyy'
				  });
				  $('.default-date-picker1').datepicker({   				
				        format: 'dd/mm/yyyy'			        
				  });	
				  var adviserId = 0;
				  var adviserId_u1 = 0;
				  var str_source = '';
				  var str_taglist = '';
				 	if (this.current_row.id)
				  {
				  		$("#id").val(this.current_row.id);	  		
				  		adviserId = this.current_row.adviserId;
				  		str_source = 	this.current_row.source;
				  		adviserId_u1 = this.current_row.adviserId;
				  }else
				  {
				  		adviserId = v.adviser_id;
				  }			    
			    //绑定顾问列表
			    var obj_adviserId = $("#t4");
			    $("#t4").empty();
			    $.ajax({
	          url: url + 'adviser/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	var str_selected = '';
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_adviserId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_adviserId.val(adviserId);   
	        });
	        //绑定顾问列表
	        var obj_adviserId1 = $("#a7");
	        $("#a7").empty();
	        obj_adviserId1.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'adviser/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	var str_selected = '';
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			if (adviserId == 'null')
	        			{
	        					obj_adviserId1.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        			}else
	        			{
	        					if (adviserId == response[item].id) obj_adviserId1.append("<option value='"+response[item].id+"' selected='true'>"+response[item].name+"</option>");	        					
	        			}
	        	}
	        	obj_adviserId1.val(adviserId);   
	        });
	        //绑定顾问列表
	        var obj_adviserId2 = $("#adviserId");
	        $("#adviserId").empty();
	        var strPar = '';
				  if (v.gw_regionid != 'null') strPar = '&regionId='+v.gw_regionid;
	        obj_adviserId2.append("<option value='0'>请选择顾问</option>");
			    $.ajax({
	          url: url + 'adviser/list?pageNum=0&pageSize=100000'+strPar,
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	var str_selected = '';
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_adviserId2.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_adviserId2.val((v.adviserId ? v.adviserId:adviserId));
	        });
	        var obj_adviserId_u1 = $("#u1");
				  $("#u1").empty();
				  var strPar = '';
				  if (v.gw_regionid != 'null') strPar = '&regionId='+v.gw_regionid;
	        obj_adviserId_u1.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'adviser/list?pageNum=0&pageSize=100000'+strPar,
	          type: 'GET',
	          async: false,
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_adviserId_u1.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_adviserId_u1.val(adviserId_u1);	
	        });            
	        //绑定tagId
	        var obj_tagid= $("#tagId");
	        $("#tagId").empty();
			    $.ajax({
	          url: url + 'user/listTag',
	          type: 'GET',
	          dataType: 'json',
	          async: false
	        }).done(function(response) {
	        	var arr_tag = response.data;
	        	for (var item in arr_tag)
	        	{
	        			var tag_name = arr_tag[item].name;
	        			var tag_id = arr_tag[item].id;
	        			obj_tagid.append("<option value='"+tag_id+"'>"+tag_name+"</option>");
	        	}
	        	obj_tagid.val(v.tagId);	
	        });	
	        //绑定客户来源	        
	        var obj_source = $("#t12");
	        $("#t12").empty();
			    $.ajax({
	          url: url + 'source/listSourceRegion',
	          type: 'GET',
	          dataType: 'json',
	          async: false
	        }).done(function(response) {
	        	//author:bischina
	        	obj_source.append("<option value=''>请选择</option>");
	        	var source_region = response.data;
	        	for (var item in source_region)
	        	{	  
	        			var region_name = source_region[item].name;
	        			var region_id = source_region[item].id;
	        			obj_source.append("<optgroup  label='"+region_name+"'>");
	        			$.ajax({
				          url: url + 'source/list?sourceRegionId='+region_id,
				          type: 'GET',
				          dataType: 'json',
				          async: false
				        }).done(function(response1) {
				        	response1 = response1.data;				        	
				        	for (var item1 in response1)
				        	{
				        			obj_source.append("<option value='"+response1[item1].name+"'>"+response1[item1].name+"</option>");
				        	}				        	
				        });
				        obj_source.append("</optgroup>");        			
	        				        			
	        	}
	        	obj_source.val(str_source);   
	        });
	        var obj_source1 = $("#a6");
	        $("#a6").empty();
			    $.ajax({
	          url: url + 'source/listSourceRegion',
	          type: 'GET',
	          dataType: 'json',
	          async: false
	        }).done(function(response) {
	        	//author:bischina
	        	obj_source1.append("<option value=''>请选择</option>");
	        	var source_region1 = response.data;
	        	for (var item in source_region1)
	        	{	  
	        			var region_name = source_region1[item].name;
	        			var region_id = source_region1[item].id;
	        			obj_source1.append("<optgroup  label='"+region_name+"'>");
	        			$.ajax({
				          url: url + 'source/list?sourceRegionId='+region_id,
				          type: 'GET',
				          dataType: 'json',
				          async: false
				        }).done(function(response1) {
				        	response1 = response1.data;				        	
				        	for (var item1 in response1)
				        	{
				        			obj_source1.append("<option value='"+response1[item1].name+"'>"+response1[item1].name+"</option>");
				        	}				        	
				        });
				        obj_source1.append("</optgroup>");        			
	        				        			
	        	}
	        	obj_source1.val(str_source);   
	        });       
	        
			});
			
			function show_loading()
			{
					$('#loading_id').on('show.bs.modal', function(){
	          var $this = $(this);
	          var $modal_dialog = $this.find('.modal-dialog');
	          $this.css('display', 'block');
	          $modal_dialog.css({'margin-top': Math.max(0, ($(window).height() - $modal_dialog.height()) / 2) });
	        });
					$('#loading_id').modal('show');
			}
			
			function deleteId()
      {
					$.get(url + "user/delete", {
						id: v.dId
					}, function(result) {
						console.log(result);
						if(result.data == true) {
							$('#delete_id').modal('hide');
							$('.alert').addClass('alert-success').show().delay(1500).fadeOut();
							v.table_remove();
	   					//重新载入数据源
	   					v.getDatalist();
	   					v.getSort();
						};
					});      		
      }
      
      function show_detail(id)
      {
      		sessionStorage.setItem("userId", id);
					window.location.href = "user-detail.html"; 
      }
      
      function show_knowledge_detail(id,parentId)
      {
      		sessionStorage.setItem("id", id);
      		sessionStorage.setItem("menu_parentid", parentId);
					window.location.href = "knowledge.html"; 
      }
      
      function add_consultation(id)
      {
      		$('#t0').val('');
					$('#t1').val('');
					$('#t2a').val('');
      		$('#consultation_id').modal('show');			      		
      		v.userid = id;
      }
      
      function consultationAddSave()
      {
      		var str_contents = $("#t0").val();      		
      		var setdate = $("#t1").val();
      		var remind_d = 0;
      		if (setdate != '')
      		{ 		
		      		var arr_d = setdate.split("/");
		      		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];     				
		      		var date = new Date(str_d);
			    		remind_d = date.getTime();
	    		}
	    		var str_remindContents = $("#t2a").val();
	    		
      		if (str_contents != '')
      		{      				    		
			    		$.post(url + 'consultation/add', { userId: v.userid, contents: str_contents, remindDate: remind_d,remindContents: str_remindContents},
					   	function(data){
					   		$('#consultation_id').modal('hide');
					   		$('.alert').addClass('alert-success').show().delay(1500).fadeOut();				   		
					   	});
			  	}
      }            
      
      function tagSet(tagList)
      {
      		v.tag_set(tagList);
      		$('#add_tag').modal('show');
      } 
      
      function tagUpdate()
      {
      		var tag_list = $('#tag_list').val();//当前的标签 
      		var tagold_array = new Array();
      		if (tag_list != '')
      		{
      				tagold_array = tag_list.split(",");
      		}   		
      		var tagnew_array = new Array();  
					$('input[name="chk"]:checked').each(function(){  
					    tagnew_array.push($(this).val());
					});
					//待添加的tag_id
					//var add_array = new Array();
					for(var i = 0; i < tagnew_array.length; i++) {
						var result = tagold_array.indexOf(tagnew_array[i].toString());
						if (result == -1) 
						{
								$.post(url + 'user/addTag', { userId: v.dId, tagId: tagnew_array[i]},function(data){});								
								//add_array.push(tagnew_array[i]);
						}
					}		
					//待删除的tag_id
					//var del_array = new Array();
					for(var i = 0; i < tagold_array.length; i++) {
						var result = tagnew_array.indexOf(tagold_array[i].toString());
						if (result == -1)
						{
								$.get(url + "user/deleteUserTagByTagIdAndUserId", {tagId: tagold_array[i],userId: v.dId}, function(result){});
								//del_array.push(tagold_array[i]);
						}
					}
					$('#add_tag').modal('hide');
					window.location.href = "users.html"; 
      }         
      
      function delHtmlTag(str)
			{
			return str.replace(/<[^>]+>/g,"");
			}      
			
			function  formatDate(now)
			{
			    var   now= new Date(now);     
			    var   year=now.getFullYear();     
			    var   month=now.getMonth()+1;     
			    var   date=now.getDate();     
			    var   hour=now.getHours();
			    var   minute=now.getMinutes();     
			    var   second=now.getSeconds();
			    return   year+"-"+fixZero(month,2)+"-"+fixZero(date,2); 
			}  
			
			function fixZero(num,length)
			{     
			    var str=""+num;
			    var len=str.length;     var s="";
			    for(var i=length;i-->len;)
			    {         
			        s+="0";
			    }
			    return s+str;
			}
			
	    jQuery(document).ready(function() {
	    });
	    
	    $('#addnew_id').on('show.bs.modal', function () {
				$("#addnew_id #addnewid_form").validate({
						submitHandler: function () {						
			            addNewSave(1);
			      },
			      rules: {
			          a1: {required: true},
			          a2: {required: true},
			          a2b: {required: true},
			          a3: {required: true},
			          a5: {minlength: 10},
			          a7: {required: true,min: 1},
			      },
			      messages: {
			          a1: "",
			          a2: "",
			          a2b: "",
			          a3: "",
			          a5: " 格式错：只能选择日期。",
			          a7: "",
			      }
			  });
			});
		</script>
	</body>

</html>