<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<link rel="shortcut icon" href="img/favicon.ico">
		<title>顾问管理</title>
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet">
		<link href="assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-datepicker/css/datepicker.css"><!-- BOOTSTRAP DATEPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-timepicker/compiled/timepicker.css"><!-- BOOTSTRAP TIMEPICKER PLUGIN CSS -->		
		<link rel="stylesheet" type="text/css" href="css/jquery.autocompleter.css">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link href="css/index.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->
		<style>
		/*----switch ----*/
.has-switch {
	border-radius: 30px;
	-webkit-border-radius: 30px;
	display: inline-block;
	cursor: pointer;
	line-height: 1.231;
	overflow: hidden;
	position: relative;
	text-align: left;
	width: 80px;
	-webkit-mask: url('img/mask.png') 0 0 no-repeat;
	mask: url('img/mask.png') 0 0 no-repeat;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	-o-user-select: none;
	user-select: none;
}

.has-switch.deactivate {
	opacity: 0.5;
	filter: alpha(opacity=50);
	cursor: default !important;
}

.has-switch.deactivate label,
.has-switch.deactivate span {
	cursor: default !important;
}

.has-switch > div {
	width: 162%;
	position: relative;
	top: 0;
}

.has-switch > div.switch-animate {
	-webkit-transition: left 0.25s ease-out;
	-moz-transition: left 0.25s ease-out;
	-o-transition: left 0.25s ease-out;
	transition: left 0.25s ease-out;
	-webkit-backface-visibility: hidden;
}

.has-switch > div.switch-off {
	left: -63%;
}

.has-switch > div.switch-off label {
	background-color: #7f8c9a;
	border-color: #bdc3c7;
	-webkit-box-shadow: -1px 0 0 rgba(255, 255, 255, 0.5);
	-moz-box-shadow: -1px 0 0 rgba(255, 255, 255, 0.5);
	box-shadow: -1px 0 0 rgba(255, 255, 255, 0.5);
}

.has-switch > div.switch-on {
	left: 0%;
}

.has-switch > div.switch-on label {
	background-color: #2293b4;
}

.has-switch input[type=checkbox] {
	display: none;
}

.has-switch span {
	cursor: pointer;
	font-size: 14.994px;
	font-weight: 700;
	float: left;
	height: 29px;
	line-height: 19px;
	margin: 0;
	padding-bottom: 6px;
	padding-top: 5px;
	position: relative;
	text-align: center;
	width: 50%;
	z-index: 1;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
	-webkit-transition: 0.25s ease-out;
	-moz-transition: 0.25s ease-out;
	-o-transition: 0.25s ease-out;
	transition: 0.25s ease-out;
	-webkit-backface-visibility: hidden;
}

.has-switch span.switch-left {
	border-radius: 30px 0 0 30px;
	background-color: #2A3542;
	color: #2293b4;
	border-left: 1px solid transparent;
}

.has-switch span.switch-right {
	border-radius: 0 30px 30px 0;
	background-color: #bdc3c7;
	color: #ffffff;
	text-indent: 7px;
}

.has-switch span.switch-right [class*="fui-"] {
	text-indent: 0;
}

.has-switch label {
	border: 4px solid #2A3542;
	border-radius: 50%;
	-webkit-border-radius: 50%;
	float: left;
	height: 29px;
	margin: 0 -21px 0 -14px;
	padding: 0;
	position: relative;
	vertical-align: middle;
	width: 29px;
	z-index: 100;
	-webkit-transition: 0.25s ease-out;
	-moz-transition: 0.25s ease-out;
	-o-transition: 0.25s ease-out;
	transition: 0.25s ease-out;
	-webkit-backface-visibility: hidden;
}

.switch-square {
	border-radius: 6px;
	-webkit-border-radius: 6px;
	-webkit-mask: url('../img/mask.png') 0 0 no-repeat;
	mask: url('../img/mask.png') 0 0 no-repeat;
}

.switch-square > div.switch-off label {
	border-color: #7f8c9a;
	border-radius: 6px 0 0 6px;
}

.switch-square span.switch-left {
	border-radius: 6px 0 0 6px;
}

.switch-square span.switch-left [class*="fui-"] {
	text-indent: -10px;
}

.switch-square span.switch-right {
	border-radius: 0 6px 6px 0;
}

.switch-square span.switch-right [class*="fui-"] {
	text-indent: 5px;
}

.switch-square label {
	border-radius: 0 6px 6px 0;
	border-color: #2293b4;
}
		</style>
	</head>

	<body id="adviser" v-cloak>
		<section id="container">
			<header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-placement="right" class="fa fa-bars tooltips">
					</div>
				</div>
				<a href="main.html" class="logo">
					佣金系统
					<span v-if="ap_list==='KJ'">
           	 会计
          </span>
          <span v-if="ap_list==='GW'">
           	 顾问
          </span>
          <span v-if="ap_list==='WA'">
           	 文案
          </span>
          <span v-if="ap_list==='MA'">
           	 Mara
          </span>
          <span v-if="ap_list==='SUPERAD'">
           	 超级管理员
          </span>          
				</a>
				<div class="top-nav ">
					<ul class="nav pull-right top-menu">
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="username">
                  {{admin}}
                </span>
								<b class="caret">
                </b>
							</a>
							<ul class="dropdown-menu extended logout">
								<li class="log-arrow-up">
								</li>
								<li>
									<a href="password.html">
										<i class="fa fa-key">
                    </i> 修改密码
									</a>
								</li>
								<li><a href="javascript:tb.out();">
										<i class="fa fa-user">
                    </i> Log Out
									</a>
								</li>								
							</ul>
						</li>
					</ul>
				</div>
			</header>
			<aside>
				<div id="sidebar" class="nav-collapse">
					<ul class="sidebar-menu" id="nav-accordion">
						<li >
              <a href="main.html">
                <i class="fa fa-dashboard">
                </i>
                <span>
                  Dashboard
                </span>
              </a>
            </li>
            <dli v-if="ap_list==='SUPERAD'">            
            <li>
              <a href="adviser.html" class="active">
                <i class="fa fa-book">
                </i>
                <span>
                  顾问管理
                </span>
              </a>
            </li>            
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 文案管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="official.html">
										文案管理
									</a>
								</li>
								<li>
									<a href="official-tag.html">
										订单标签管理
									</a>
								</li>								
							</ul>
						</li>
            <li>
              <a href="mara.html">
                <i class="fa fa-book">
                </i>
                <span>
                  MARA管理
                </span>
              </a>
            </li>
            <li>
              <a href="accounting.html">
                <i class="fa fa-book">
                </i>
                <span>
                  会计管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 学校管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="school.html">
										学校管理
									</a>
								</li>
								<li>
									<a href="school-setting.html">
										佣金设置
									</a>
								</li>								
							</ul>
						</li>
            <li>
              <a href="receive-type.html">
                <i class="fa fa-book">
                </i>
                <span>
                  收款方式管理
                </span>
              </a>
            </li>
            <li>
              <a href="subagency.html">
                <i class="fa fa-book">
                </i>
                <span>
                  Subagency管理
                </span>
              </a>
            </li>
            <li>
              <a href="service.html">
                <i class="fa fa-book">
                </i>
                <span>
                  服务项目管理
                </span>
              </a>
            </li>
          	</dli>
          	<li v-if="ap_list!=='KJ' && ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 客户管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="users.html">
										客户管理
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="user-tags.html">
										标签管理
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='KJ'" class="sub-menu">
							<a href="serviceorder-list.html">
                <i class="fa fa-book">
                </i>
                <span>
                  服务订单管理
                </span>
              </a>
						</li>
            <li v-if="ap_list==='SUPERAD'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 渠道管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="source.html">
										渠道列表
									</a>
								</li>
								<li>
									<a href="source-type.html">
										来源分类
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 佣金表
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" class="active">
									<a href="mycommission.html">
										我的佣金报表
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_PENDING">
									<a href="mycommission.html?applyState=PENDING">
										未申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_COMPLETE">
									<a href="mycommission.html?applyState=COMPLETE">
										已申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_DJY">
									<a href="mycommission-accounting.html?commission_state=DJY">
										待结佣订单
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_YJY">
									<a href="mycommission-accounting.html?commission_state=YJY">
										已结佣订单
									</a>									
								</li>								
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="mycommission-check-accounting.html">
										自动对账
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="create-visa-commission.html">
										重建签证佣金表订单
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="table-export.html">
										导出数据
									</a>
								</li>
							</ul>
						</li>
						<li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 知识库
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="knowledge-menu.html">
										菜单管理
									</a>
								</li>
								<li>
									<a href="knowledge.html">
										知识库菜单
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</aside>
			<section id="main-content" class="content">
				<section class="wrapper site-min-height">
					<div class="row">
						<div class="col-lg-12">
							<section class="panel">
								<header class="panel-heading">
									顾问管理
								</header>
								<div class="panel-body responsive-table">
									<div class="adv-table editable-table">
										<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
									      <button data-dismiss="alert" class="close close-sm" type="button">
									      <i class="fa fa-times"></i>
									      </button>
									      <strong>Success!</strong> You  just achieved success.
									  </div>
									  <div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
                      <button data-dismiss="alert" class="close close-sm" type="button">
                      <i class="fa fa-times"></i>
                      </button>
                      <strong id="error_info"></strong>
                   	</div>
										<div class="clearfix">
                       <div class="btn-group">
                          <button id="editable-sample_new" class="btn btn-success green" @click="table_insert">
                          Add New <i class="fa fa-plus"></i>
                          </button>
                       </div>
                    </div>
                    <form class="form-inline" style="margin-top:10px;">
											<div class="form-group">
												<input v-model.trim="name" type="text" class="form-control" placeholder="输入顾问名称">												
											</div>
											<div class="form-group">
												<button @click="getUser" type="button" class="btn btn-info">查询</button>
											</div>
										</form>
										<div class="margin-top">
											<input type="hidden" name="id" id="id" value="0" />
											<table class="display table table-bordered table-striped" id="example">
												<thead>
													<tr>
														<!--<th><input @click="checked" type="checkbox"></th>-->
														<th>ID</th>
														<th>顾问名称</th>
														<th>电话号码</th>
														<th>电子邮箱</th>
														<th>登录密码</th>
														<th>二维码</th>
														<th>所属区域</th>														
														<th>管理区域</th>	
														<th>账户状态</th>
														<th>Edit</th>
														<th>操作</th>
													</tr>
												</thead>
												<tbody>
													<tr v-for="item in subject" class="gradeX">
														<td v-html="item.oid"></td>
														<td v-html="item.name"></td>
														<td v-html="item.phone"></td>
														<td v-html="item.email"></td>
														<td v-html="item.password"></td>
														<td v-html="item.imageUrl"></td>
														<td v-html="item.regionName"></td>											
														<td v-html="item.adminRegionName"></td>
														<td v-html="item.state"></td>
														<td>
																<dle v-if="item.id">
																<a class="edit" href="javascript:;" @click="table_modify($index)"><span class="label label-success">Edit</span></a>
																<a href="javascript:;" @click="table_setadmin(item.id,item.adminRegionId)"><span class="label label-success" style="background-color: #58c9f3;">设为管理员</span></a>
																</dle>
																<a v-else class="edit" href="javascript:;"><span class="label label-primary">Save</span></a>
														</td>
														<td>
																<!--													
																<div v-if="item.id" class="switch has-switch">																
																<div v-if="item.state != 'DISABLED'" class="switch-on switch-animate"><input type="checkbox" checked="" data-toggle="switch"><span class="switch-left" @click="delete_confirm($index,item.id)">ON</span><label>&nbsp;</label><span class="switch-right" @click="open_confirm($index,item.id)">OFF</span></div>
																<div v-if="item.state == 'DISABLED'" class="switch-off switch-animate"><input type="checkbox" checked="" data-toggle="switch"><span class="switch-left" @click="delete_confirm($index,item.id)">ON</span><label>&nbsp;</label><span class="switch-right" @click="open_confirm($index,item.id)">OFF</span></div>
																</div>-->
																<a v-if="item.id" class="warning" href="#" @click="delete_confirm($index,item.id)"><span class="label label-danger"><span v-if="item.state != 'DISABLED'">Close</span></span></a>
																<a v-if="item.id" class="warning" href="#" @click="open_confirm($index,item.id)"><span class="label label-inverse"><span v-if="item.state == 'DISABLED'">Open</span></span></a>
																<a v-else class="cancel" href="javascript:;"><span class="label label-info">Cancel</span></a>
														</td>														
													</tr>
												</tbody>
											</table>
										</div>
										<div class="row-fluid">
											<div class="span6">
												<div class="dataTables_info" id="hidden-table-info_info">共{{count}}条</div>
											</div>
											<div class="span6">
												<div class="dataTables_paginate paging_bootstrap pagination">
													<ul>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="firstPage" href="javascript:;">首页</a>
														</li>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="prevPage" href="javascript:;">← Pre</a>
														</li>
														<li class="nowPage">
															第{{pageNum+1}}页
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="nextPage" href="javascript:;">Next → </a>
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="lastPage" href="javascript:;">末页</a>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
							</section>
						</div>
					</div>
				</section>
			</section>
			<footer class="site-footer">
				<div class="text-center">
					2018 &copy; 佣金系统 by <span style="color:#2a8ba7;">GIG</span>.
					<a href="#" class="go-top">
						<i class="fa fa-angle-up">
            </i>
					</a>
				</div>
			</footer>
		</section>
		<div class="modal fade" id="delete_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">删除</h4>
					</div>
					<div class="modal-body">
						确认关闭吗？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="deleteId()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="close_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="close_title">关闭</h4>
					</div>
					<div class="modal-body">
						确认<span id="close_title1">关闭</span>吗？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="closeId()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="passwd_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">重置密码</h4>
					</div>
					<div class="modal-body">
							<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-4 control-label">新的随机密码</label>
								<div class="col-sm-8">
									<label id="resetPasswd" style="color:red;"></label>
								</div>
							</div>
							</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="open_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="close_title">关闭</h4>
					</div>
					<div class="modal-body">
						确认<span id="close_title1">开启</span>吗？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="openId()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="setadmin_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="close_title">请配置管理员管理地区</h4>
					</div>
					<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
			      <button data-dismiss="alert" class="close close-sm" type="button">
			      <i class="fa fa-times"></i>
			      </button>
			      <strong>Success!</strong> You  just achieved success.
			  	</div>
			  	<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
		        <button data-dismiss="alert" class="close close-sm" type="button">
		        <i class="fa fa-times"></i>
		        </button>
		        <strong id="error_info"></strong>
		      </div>
					<div class="modal-body">						
							<select class="form-control" style="width:200px;" name="adminRegionId" id="adminRegionId"></select>
					</div>
					<div class="modal-footer">
						<button onclick="setadminSave()" type="button" class="btn btn-primary">确认</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>						
					</div>
				</div>
			</div>
		</div>
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.dcjqaccordion.2.7.js"></script>
		<script src="js/jquery.scrollTo.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>
		<script src="assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script><!-- BOOTSTRAP DATEPICKER JS  -->
    <script src="assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script><!-- BOOTSTRAP DATETIMEPICKER JS  -->    
    <script src="js/jquery.autocompleter.js"></script>
		<script src="js/common-scripts.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/common.js?verson=1"></script>
		<script>
			tb.isLogin("adviser.html");
			$("td,th").addClass("text-center");
			var v = new Vue({
				el: '#adviser',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),
					allSort: [],
					subject: [],
					count: 0,
					dId: '',
					eId: '',
					current_adminRegionId: 0,
					username: '',
					name: '',
					sort: '',
					state: '',
					pageNum: 0,
					pageSize: 10,
					allPage: 0,
					add: false,
					current_index: '',
					current_row: '',
					index: 0,
					close: false
				},
				created: function() {
					this.getDatalist();
				},
				methods: {
					getUser: function() {
						var that = this;
						$.get(url + "adviser/count", {
							name: that.name,							
							adviserId: that.adviserId
						}, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						$.get(url + "adviser/list", {
							name: that.name,
							adviserId: that.adviserId,							
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							//console.log(result)
							that.pageNum = 0;
							that.subject = return_result(result);
							//console.log(that.subject);
						});
					},
					getDatalist: function() {
						var that = this;
						$.get(url + "adviser/count", {
							keyword: that.name							
						}, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						$.get(url + "adviser/list", {
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							//console.log(result)
							that.pageNum = 0;
							that.subject = return_result(result);
							//console.log(that.subject);
						});
					},
					getTime: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y;
						return date2;
					},
					addZero: function(obj) {
						if(obj < 10) {
							obj = '0' + obj;
						};
						return obj;
					},
					firstPage: function() {
						var that = this;
						if(that.pageNum > 0) {
							$.get(url + "adviser/list", {
								keyword: that.name,
								state: that.state,
								pageNum: 0,
								pageSize: that.pageSize
							}, function(result) {
								that.pageNum = 0;
								that.subject = return_result(result);
							});
						}
					},
					prevPage: function() {
						var that = this;
						if(that.pageNum > 0) {
							that.pageNum--;
							$.get(url + "adviser/list", {
								keyword: that.name,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								that.subject = return_result(result);
							});
						}
					},
					nextPage: function() {
						var that = this;
						if(that.pageNum < that.allPage - 1) {
							that.pageNum++;
							$.get(url + "adviser/list", {
								keyword: that.name,
								categoryId: that.sort,
								state: that.state,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								that.subject = return_result(result);
							});
						}
					},
					lastPage: function() {
						var that = this;
						if(that.pageNum < that.allPage - 1) {
							$.get(url + "adviser/list", {
								keyword: that.name,
								categoryId: that.sort,
								state: that.state,
								pageNum: that.allPage - 1,
								pageSize: that.pageSize
							}, function(result) {
								that.pageNum = that.allPage - 1;
								that.subject = return_result(result);
							});
						}
					},
					table_insert() {
						if (!this.add)
						{
								$("#id").val('0');
								if (this.current_index != null)
								{
										this.subject[this.current_index] = this.current_row;
										this.current_index = '';
										this.current_row = '';
								}											
								this.subject.splice(0,0, {
									id:'',									
									name: '<input type="text" class="form-control small" style="width:150px;" id="t0" value="">',
									phone: '<input type="text" class="form-control small" style="width:150px;" id="t1" value="">',
									email: '<input type="text" class="form-control small" style="width:200px;" id="t2" value="">',
									password: '<input type="password" autocomplete="off" class="form-control small" style="width:150px;" id="t5" value="">',
									imageUrl: '<textarea type="text" class="form-control small" style="width:200px;" id="t3"></textarea>',
									regionName: '<select class="form-control" style="width:150px;" id="t4"></select>',
									state: '',
									});
								this.add = true;
						}
					},
					table_modify: function (index) {						
						if (this.current_index != null)
						{
								if (this.add)
								{
										this.subject[this.current_index-1] = this.current_row;
								}else
								{
										this.subject[this.current_index] = this.current_row;
								}
						}
						this.current_index = index;
						this.current_row = this.subject[index];
						if (this.subject[index].imageUrl == null) this.subject[index].imageUrl = '';
						this.subject.splice(index,1, {
							oid: parseInt(this.subject[index].id),
							name: '<input type="text" class="form-control small" style="width:150px;" id="t0" value="'+this.subject[index].name+'">',
							phone: '<input type="text" class="form-control small" style="width:150px;" id="t1" value="'+this.subject[index].phone+'">',
							email: '<input type="text" class="form-control small" style="width:200px;" id="t2" value="'+this.subject[index].email+'">',
							imageUrl: '<textarea type="text" class="form-control small" style="width:200px;" id="t3">'+this.subject[index].imageUrl+'</textarea>',
							regionName: '<select class="form-control" style="width:150px;" id="t4"></select>',
							state: '',							
						});						
						if (this.add)
						{
								this.subject.splice(0, 1);
								this.add = false;
								this.current_index = index-1;								
						}
						//alert(this.current_row.id);																			
					},
					table_setadmin:	function (id,adminRegionId) {
						this.dId = id;						
						if (adminRegionId != 'null')
						{
								this.current_adminRegionId = adminRegionId;
						}else
						{
								this.current_adminRegionId = 0;
						}
						$('#setadmin_id').modal('show');
						var obj_adminRegionId = $("#setadmin_id #adminRegionId");
						obj_adminRegionId.val(this.current_adminRegionId);
					},				
					table_remove: function (index) {
             this.subject.splice(index, 1);  
          },
          delete_confirm: function (index,id) {
          	$('#delete_id').modal('show');
          	this.dId = id;
          	this.index = index;
          },
          open_confirm: function (index,id) {
          	$('#open_id').modal('show');
          	this.dId = id;
          	this.index = index;
          },
          passwdSet: function (username){
          			$.post(url + 'admin_user/resetPassword', { username: username},
						   	function(data){
						   		if (data.code == 0)
						   		{
						   				$('#resetPasswd').html(data.data);
						   		}else
						   		{
						   				$('#resetPasswd').html(data.message);
						   		}
						   	});
			      		$('#passwd_id').modal('show');
			    }
				}		
			});
			
			$('#example a.edit').live('click', function (e) {
				e.preventDefault();
				table_addsave();
			});
			
			$('#example a.cancel').live('click', function (e) {
				e.preventDefault();
				if (!parseInt($("#id").val()))
				{
						v.subject.splice(0, 1);
						v.add = false;
				}else
				{
						v.subject.splice(v.current_index, 0);
						v.subject.splice(v.current_index,1, v.current_row);
				}
			});
			
			function return_result(result)
			{
				for(var i = 0; i < result.data.length; i++) {
						result.data[i].oid = result.data[i].id;	
						if (result.data[i].adminRegionId != null)
						{
								result.data[i].adminRegionName = '<label style="color:red;font-weight:bold;">'+result.data[i].adminRegionName+'</label>';
						}
						result.data[i].password = '<label id="t5" style="width:150px;"><a href="javascript:;" onclick="passwdSet(\''+result.data[i].email+'\')">重置密码</a></label>';				
				};
				return result.data;
			}
			
			function table_addsave()
			{
          var jqInputs = $('input',$("#example"));
          var jqText = $('textarea',$("#example"));
          var jqSelect = $('select',$("#example"));
          
          
          var check_result = 0;
          if (jqInputs[0].value != '' && jqInputs[1].value != '' && jqInputs[2].value != '')
          {
          		check_result = true;
          }else
          {
          		alert('所有选项必须填写！');
          }
          
          if (check_result)
          {              
              var str_url = url + "adviser/add";
              var sa_id = $("#id").val();
              if (sa_id != '0') str_url = url + "adviser/update";
              $("#id").val('0');
              
              var passwd = '';
              var str_name = '';
              var str_phone = '';
              var str_email='';
              
              str_name = jqInputs[0].value;         		
          		str_phone = jqInputs[1].value;
          		str_email = jqInputs[2].value;
          		if (jqInputs[3] != undefined) passwd = jqInputs[3].value;          		              
              
              $.post(str_url, { id: sa_id, name: str_name, phone: str_phone, email: str_email, password: passwd, imageUrl: jqText[0].value, regionId: jqSelect[0].value},
					   	function(data){
					   			if (data.message == '')
					   			{
					   					v.add = false;
					   					$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					v.table_remove();
					   					//重新载入数据源
					   					this.add = false;
					   					v.getDatalist();
					   			}else
					   			{
					   					$('#alert_error').addClass('alert-danger').show().delay(1500).fadeOut();
					   					$("#error_info").html(data.message);
					   			}
					   			//console.log(data);
					   	});
			  	}                
      }
			
			v.$watch('subject', function(obj) {
					$('.default-date-picker').datepicker({   				
				        format: 'dd/mm/yyyy'
				  });
				  var regionId = 0;				  
				 	if (this.current_row.id)
				  {
				  		$("#id").val(this.current_row.id);	  		
				  		regionId = this.current_row.regionId;	
				  }				   	    			    
			    //绑定区域列表
			    var obj_regionId = $("#t4");	
			    $.ajax({
	          url: url + 'region/list_all',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	var region_data = response.data;
	        	console.log(region_data);
	        	for (var item in region_data)
	        	{
	        			obj_regionId.append("<option value='"+region_data[item].id+"'>"+region_data[item].name+"</option>");
	        			var region_sub = region_data[item].regionList;
	        			for (var itemsub in region_sub)
	        			{
	        					obj_regionId.append("<option value='"+region_sub[itemsub].id+"'>---"+region_sub[itemsub].name+"</option>");
	        			}
	        	}
	        	obj_regionId.val(regionId);   
	        });
	        var obj_adminRegionId = $("#setadmin_id #adminRegionId");
	        obj_adminRegionId.empty();
	        obj_adminRegionId.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'region/list_all',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina	        	
	        	var str_html = '';
	        	var region_data = response.data;
	        	for (var item in region_data)
	        	{
	        			obj_adminRegionId.append("<option value='"+region_data[item].id+"'>"+region_data[item].name+"</option>");
	        			var region_sub = region_data[item].regionList;
	        			for (var itemsub in region_sub)
	        			{
	        					obj_adminRegionId.append("<option value='"+region_sub[itemsub].id+"'>---"+region_sub[itemsub].name+"</option>");
	        			}
	        	}
	        });
			});
			
			function deleteId()
      {
					 $.post(url + "adviser/update", {
						id: v.dId,
						state: 'DISABLED'
					}, function(result) {
						//console.log(result);
						if(result.code == 0) {
							$('#delete_id').modal('hide');
							$('.alert').addClass('alert-success').show().delay(1500).fadeOut();
							v.table_remove();
	   					//重新载入数据源
	   					v.getDatalist();
	   					v.getSort();
						};
					});      		
      }
      
      function openId()
      {
					 $.post(url + "adviser/update", {
						id: v.dId,
						state: 'ENABLED'
					}, function(result) {
						//console.log(result);
						if(result.code == 0) {
							$('#open_id').modal('hide');
							$('.alert').addClass('alert-success').show().delay(1500).fadeOut();
							//v.table_remove();
	   					//重新载入数据源
	   					v.getDatalist();
	   					v.getSort();
						};
					});      		
      }
      
      function passwdSet(username)
      {
      		$.post(url + 'admin_user/resetPassword', { username: username},
			   	function(data){
			   		if (data.code == 0)
			   		{
			   				$('#resetPasswd').html(data.data);
			   		}else
			   		{
			   				$('#resetPasswd').html(data.message);
			   		}
			   	});
      		$('#passwd_id').modal('show');
      }
      
      function setadminSave()
      {
      		var f = '#setadmin_id ';
      		var check_result = 0;
      		var e_info = '';
      		
      		var adviserId = v.dId;
      		var adminRegionId = parseInt($(f+'#adminRegionId').val());
      		v.dId = 0;
      		if (adminRegionId)
          {
          		check_result = true;
          }else
          {
          		e_info = '请务必选择一个管理区域。';
      				$('#setadmin_id #alert_error').css('marginLeft','30%');
			    		$('#setadmin_id #alert_error').css('marginTop','10%');
			    		$('#setadmin_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			        $("#setadmin_id #error_info").html(e_info);
      				return false;
          }
          
          if (check_result)
    			{
    					var str_url = url + "adviser/update";
    					$.post(str_url, { id: adviserId,adminRegionId: adminRegionId},
					   	function(data){
					   			if (data.code == 0)
					   			{
					   					$('#setadmin_id #alert_success').css('marginLeft','30%');
			    						$('#setadmin_id #alert_success').css('marginTop','10%');
					   					$('#setadmin_id #alert_success').addClass('alert-success').show().delay(1500).fadeOut();					   					
					   					setTimeout(function(){$('#setadmin_id').modal('hide');}, 2000);
					   					//重新载入数据源					   					
					   					v.getDatalist();
					   			}else
					   			{
					   					$('#setadmin_id #alert_error').css('marginLeft','30%');
			    						$('#setadmin_id #alert_error').css('marginTop','10%');
					   					$('#setadmin_id #alert_error').addClass('alert-danger').show().delay(1500).fadeOut();
					   					$("#setadmin_id #error_info").html(data.message);
					   			}
					   			//console.log(data);
					   	});
    			}
      }
      
      function show_knowledge_detail(id,parentId)
      {
      		sessionStorage.setItem("id", id);
      		sessionStorage.setItem("menu_parentid", parentId);
					window.location.href = "knowledge.html"; 
      }
			
			function  formatDate(now)
			{
			    var   now= new Date(now);     
			    var   year=now.getFullYear();     
			    var   month=now.getMonth()+1;     
			    var   date=now.getDate();     
			    var   hour=now.getHours();
			    var   minute=now.getMinutes();     
			    var   second=now.getSeconds();
			    return fixZero(date,2)+"/"+fixZero(month,2)+"/"+year; 
			}  
			
			function fixZero(num,length)
			{     
			    var str=""+num;
			    var len=str.length;     var s="";
			    for(var i=length;i-->len;)
			    {         
			        s+="0";
			    }
			    return s+str;
			}
			
	    
		</script>
	</body>

</html>