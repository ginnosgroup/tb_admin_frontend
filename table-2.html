<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<link rel="shortcut icon" href="img/favicon.ico">
		<title>待追佣学生表</title>
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet">
		<link href="assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-datepicker/css/datepicker.css"><!-- BOOTSTRAP DATEPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-timepicker/compiled/timepicker.css"><!-- BOOTSTRAP TIMEPICKER PLUGIN CSS -->		
		<link rel="stylesheet" type="text/css" href="css/jquery.autocompleter.css">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link href="css/index.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body id="table2" v-cloak>
		<section id="container">
			<header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-placement="right" class="fa fa-bars tooltips">
					</div>
				</div>
				<a href="main.html" class="logo">
					佣金系统
					<span v-if="ap_list==='KJ'">
           	 会计
          </span>
          <span v-if="ap_list==='GW'">
           	 顾问
          </span>
          <span v-if="ap_list==='WA'">
           	 文案
          </span>
          <span v-if="ap_list==='MA'">
           	 Mara
          </span>
          <span v-if="ap_list!=='KJ' && ap_list!=='GW' && ap_list!=='WA' && ap_list!=='MA'">
           	 超级管理员
          </span>
				</a>
				<div class="top-nav ">
					<ul class="nav pull-right top-menu">
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="username">
                  {{admin}}
                </span>
								<b class="caret">
                </b>
							</a>
							<ul class="dropdown-menu extended logout">
								<li class="log-arrow-up">
								</li>
								<li>
									<a href="password.html">
										<i class="fa fa-key">
                    </i> 修改密码
									</a>
								</li>
								<li><a href="javascript:tb.out();">
										<i class="fa fa-user">
                    </i> Log Out
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</header>
			<aside>
				<div id="sidebar" class="nav-collapse">
					<ul class="sidebar-menu" id="nav-accordion">
						<li >
              <a href="main.html">
                <i class="fa fa-dashboard">
                </i>
                <span>
                  Dashboard
                </span>
              </a>
            </li>
            <dli v-if="ap_list!=='KJ' && ap_list!=='GW' && ap_list!=='WA' && ap_list!=='MA'">            
            <li>
              <a href="adviser.html">
                <i class="fa fa-book">
                </i>
                <span>
                  顾问管理
                </span>
              </a>
            </li>
            <li>
              <a href="official.html">
                <i class="fa fa-book">
                </i>
                <span>
                  文案管理
                </span>
              </a>
            </li>
            <li>
              <a href="mara.html">
                <i class="fa fa-book">
                </i>
                <span>
                  MARA管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 学校管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="school.html">
										学校管理
									</a>
								</li>
								<li>
									<a href="school-setting.html">
										佣金设置
									</a>
								</li>								
							</ul>
						</li>
            <li>
              <a href="receive-type.html">
                <i class="fa fa-book">
                </i>
                <span>
                  收款方式管理
                </span>
              </a>
            </li>
            <li>
              <a href="subagency.html">
                <i class="fa fa-book">
                </i>
                <span>
                  Subagency管理
                </span>
              </a>
            </li>
            <li>
              <a href="service.html">
                <i class="fa fa-book">
                </i>
                <span>
                  服务项目管理
                </span>
              </a>
            </li>
          	</dli>
          	<li v-if="ap_list!=='KJ' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 客户管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="users.html">
										客户管理
									</a>
								</li>
								<li v-if="ap_list!=='KJ' && ap_list!=='GW' && ap_list!=='WA' && ap_list!=='MA'">
									<a href="user-tags.html">
										标签管理
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='KJ'" class="sub-menu">
							<a href="serviceorder-list.html">
                <i class="fa fa-book">
                </i>
                <span>
                  服务订单管理
                </span>
              </a>
						</li>
            <li v-if="ap_list!=='KJ' && ap_list!=='GW' && ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 渠道管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="source.html">
										渠道列表
									</a>
								</li>
								<li>
									<a href="source-type.html">
										来源分类
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;" class="active">
								<i class="fa fa-book">
                </i>
								<span>
                 	 佣金表
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="visa.html">
										签证类
									</a>
								</li>
								<li>
									<a href="table-1.html">
										提前扣佣学生表
									</a>
								</li>
								<li class="active">
									<a href="table-2.html">
										待追佣学生表
									</a>
								</li>
								<li>
									<a href="table-3.html">
										退款表
									</a>
								</li>
								<li v-if="ap_list!=='GW' && ap_list!=='WA' && ap_list!=='MA'">
									<a href="table-export.html">
										导出数据
									</a>
								</li>
							</ul>
						</li>
						<li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 知识库
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list!=='KJ' && ap_list!=='GW' && ap_list!=='WA' && ap_list!=='MA'">
									<a href="knowledge-menu.html">
										菜单管理
									</a>
								</li>
								{{{m_list}}}							
							</ul>
						</li>
					</ul>
				</div>
			</aside>
			<section id="main-content" class="content">
				<section class="wrapper site-min-height">
					<div class="row">
						<div class="col-lg-12">
							<section class="panel">
								<header class="panel-heading">
									留学-学校待结佣表
								</header>
								<div class="panel-body responsive-table">
									<div class="adv-table editable-table">
										<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
									      <button data-dismiss="alert" class="close close-sm" type="button">
									      <i class="fa fa-times"></i>
									      </button>
									      <strong>Success!</strong> You  just achieved success.
									  </div>
									  <div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
                      <button data-dismiss="alert" class="close close-sm" type="button">
                      <i class="fa fa-times"></i>
                      </button>
                      <strong id="error_info"></strong>
                   </div>
										<div class="clearfix">
                       <div class="btn-group">
                          <button id="editable-sample_new" class="btn btn-success green" onclick="addNew();">
                          Add New <i class="fa fa-plus"></i>
                          </button>
                       </div>
                    </div>
                    <form class="form-inline" style="margin-top:10px;width:1400px;">
											<div class="form-group">
												<input v-model.trim="keyword" type="text" class="form-control" style="width:120px;" placeholder="查询关键字">												
												<input v-model.trim="adviserId" type="text" class="form-control" style="width:100px;" placeholder="顾问编号">
												<input v-model.trim="startHandlingDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:120px;" placeholder="办理时间(开始)">
												<input v-model.trim="endHandlingDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:120px;" placeholder="办理时间(结束)">
												<input v-model.trim="startDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:120px;" placeholder="开课日期(开始)">
												<input v-model.trim="endDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:120px;" placeholder="开课日期(结束)">
												<input v-model.trim="schoolId" type="text" class="form-control" style="width:100px;" placeholder="学校编号">
												<input v-model.trim="subagencyId" type="text" class="form-control" style="width:130px;" placeholder="Subagency编号">
												是否已结佣 <select v-model.trim="isSettleAccounts" class="form-control">
												<option value="true" selected="true">是</option>
												<option value="false">否</option>
												</select>												
											</div>
											<div class="form-group">
												<button @click="getData" type="button" class="btn btn-info">查询</button>
											</div>
											<div class="form-group">
												<button @click="exportData" type="button" class="btn btn-info">导出</button>
											</div>
										</form>
										<div class="margin-top">
											<input type="hidden" name="id" id="id" value="0" />
											<input type="hidden" name="userid" id="userid" value="0" />
											<input type="hidden" name="schoolid" id="schoolid" value="0" />
											<input type="hidden" name="school_name" id="school_name" value="" />
											<input type="hidden" name="school_subject" id="school_subject" value="" />
											<table class="display table table-bordered table-striped" id="example" style="width:2500px;">
												<thead>
													<tr>
														<!--<th><input @click="checked" type="checkbox"></th>-->
														<th><span style="color:red;">创建日期</span></th>
														<th>办理日期</th>
														<th>客户姓名</th>
														<th>生日</th>
														<th>电话</th>
														<th>学校</th>
														<th>课程</th>
														<th>StudentId</th>
														<th>开课日期</th>
														<th>结束日期</th>
														<th>设置提醒</th>			
														<th><span style="color:#FF6C60;">Tuition Fee</span></th>
														<th><span style="color:#FF6C60;">First Term Tuition Fee</span></th>
														<th><span style="color:#FF6C60;">Discount</span></th>
														<th><span style="color:#FF6C60;">Commission</span></th>
														<th>GST</th>
														<th>Deduct GST</th>
														<th>月奖</th>
														<th>学校支付日期</th>
														<th>INVOICE NO.</th>
														<th>学校支付金额</th>
														<th>Subagency</th>
														<th>已结佣</th>
														<th>顾问</th>
														<th>文案</th>
														<th>备注</th>
														<th>Edit</th>
														<th>Delete</th>
														<th>Close file</th>
													</tr>
												</thead>
												<tbody>
													<tr v-for="item in subject" class="gradeX">
														<td v-html="item.gmtCreate"></td>
														<td v-html="item.handlingDate"></td>
														<td v-html="item.userName"></td>
														<td v-html="item.birthday"></td>
														<td v-html="item.phone"></td>
														<td v-html="item.schoolName"></td>
														<td v-html="item.schoolSubject"></td>
														<td v-html="item.studentCode"></td>
														<td v-html="item.startDate"></td>
														<td v-html="item.startDate"></td>
														<td width="150">
															<div v-html="item.remindDateList"></div>
															<div v-if="item.id"><label id="t9" style="width:150px;"><a href="javascript:;" @click="remindSet(item.id)">设置</a></label></div>
														</td>
														<td v-html="item.tuitionFee"></td>
														<td v-html="item.firstTermTuitionFee"></td>
														<td v-html="item.discount"></td>
														<td v-html="item.commission"></td>
														<td v-html="item.gst"></td>
														<td v-html="item.deductGst"></td>
														<td v-html="item.bonus"></td>
														<td v-html="item.payDate"></td>
														<td v-html="item.invoiceCode"></td>
														<td v-html="item.payAmount"></td>
														<td v-html="item.subagencyName"></td>
														<td v-html="item.settleAccounts"></td>
														<td v-html="item.adviserName"></td>
														<td v-html="item.officialName"></td>
														<td v-html="item.remarks"></td>
														<td>
																<dli v-if="!item.close || ap_list!=='GW'">
																<a v-if="item.id" class="edit" href="javascript:;" @click="table_modify($index)"><span class="label label-success">Edit</span></a>
																<a v-else class="edit" href="javascript:;"><span class="label label-primary">Save</span></a>
																</dli>
														</td>
														<td>
																<dli v-if="!item.close || ap_list!=='GW'">
																<a v-if="item.id" class="delete" href="#" @click="delete_confirm($index,item.id)"><span class="label label-danger">Delete</span></a>
																<a v-else class="cancel" href="javascript:;"><span class="label label-info">Cancel</span></a>
																</dli>
														</td>
														<td>
																<dli v-if="ap_list!=='GW'">
																<a v-if="!item.close && item.id" class="warning" href="#" @click="close_confirm($index,item.id,item.close)"><span class="label label-warning">Close</span></a>
																<a v-if="item.close && item.id" class="warning" href="#" @click="close_confirm($index,item.id,item.close)"><span class="label label-inverse">Open</span></a>
																</dli>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
										<div class="row-fluid">
											<div class="span6">
												<div class="dataTables_info" id="hidden-table-info_info">共{{count}}条</div>
											</div>
											<div class="span6">
												<div class="dataTables_paginate paging_bootstrap pagination">
													<ul>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="firstPage" href="javascript:;">首页</a>
														</li>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="prevPage" href="javascript:;">← Pre</a>
														</li>
														<li class="nowPage">
															第{{pageNum+1}}页
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="nextPage" href="javascript:;">Next → </a>
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="lastPage" href="javascript:;">末页</a>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
							</section>
						</div>
					</div>
				</section>
			</section>
			<footer class="site-footer">
				<div class="text-center">
					2018 &copy; 佣金系统 by <span style="color:#2a8ba7;">GIG</span>.
					<a href="#" class="go-top">
						<i class="fa fa-angle-up">
            </i>
					</a>
				</div>
			</footer>
		</section>
		<div class="modal fade" id="delete_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">删除</h4>
					</div>
					<div class="modal-body">
						确认删除吗？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="deleteId()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="close_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="close_title">关闭</h4>
					</div>
					<div class="modal-body">
						确认<span id="close_title1">关闭</span>吗？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="closeId()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="remind_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">添加提醒</h4>
					</div>
					<div class="modal-body">
							<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">提醒日期</label>
								<div class="col-sm-8">
									<input type="text" autocomplete="off" id="setdate" class="form-control default-date-picker1" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
								</div>
							</div>
							</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="remindSetSave()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="add_schoolsubject_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">添加课程</h4>
					</div>
					<div class="modal-body">
							<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">课程名程<span style="color:red;">*</span></label>
								<div class="col-sm-8">
									<input type="text" id="schoolsubject_name" class="form-control" placeholder="" />
								</div>
							</div>
							</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="ajax_subject();">取消</button>
						<button onclick="schoolSubjectSave()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="add_schoolsubject1_id" style="z-index:9999999;background-color: rgba(192,192,192,0.2);" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">添加课程</h4>
					</div>
					<div class="modal-body">
							<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">课程名程<span style="color:red;">*</span></label>
								<div class="col-sm-8">
									<input type="text" id="schoolsubject_name1" class="form-control" placeholder="" />
								</div>
							</div>
							</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="ajax_subject1();">取消</button>
						<button onclick="schoolSubjectSave1()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="addnew_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document" style="width:700px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">添加</h4>
					</div>
					<div class="modal-body">
							<form class="form-inline" style="">
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label">办理日期</label>
								<input type="text" autocomplete="off" id="a0" class="form-control default-date-picker" style="width:150px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label">客户姓名</label>
								<input type="text" class="form-control small" style="width:150px;ime-mode:disabled;" id="a1" placeholder="请输入查询" onKeyUp="value=value.replace(/[^a-zA-Z ]/g,'');" value="">
								<label class="control-label">出生日期</label>
								<input type="text" autocomplete="off" id="a2" class="form-control" style="width:120px;" readonly="readonly">
								<label class="control-label">电话号码</label>
								<input type="text" autocomplete="off" id="a3" class="form-control" style="width:120px;" readonly="readonly">
							</div>
							<div class="form-group" style="height:40px;">
								<label class="control-label">就读学校</label>
								<select class="form-control" style="width:150px;" id="a4" onchange="if (this.value!=''){check_setting(this.value);ajax_subject1();}else{set_empty1();}"></select>
							</div>
							<div class="form-group" style="height:40px;">
								<label class="control-label">选读课程</label>
								<select class="form-control" style="width:150px;" id="a5" onchange="set_schoolid1(this.value)"></select>
							</div>
							<div class="form-group" style="height:40px;">
								<label class="control-label">StudentId</label>
								<input type="text" class="form-control small" style="width:150px;ime-mode:disabled;" id="a6" placeholder="" value="">
							</div>
							<div class="form-group" style="display:block;line-height:30px;">
							<div class="form-group" style="height:40px;">
								<label class="control-label">开课日期</label>
								<input type="text" autocomplete="off" id="a7" class="form-control default-date-picker1" style="width:150px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
							</div>
							<div class="form-group" style="height:40px;">
								<label class="control-label">结束日期</label>
								<input type="text" autocomplete="off" id="a8" class="form-control default-date-picker1" style="width:150px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
							</div>							
							</div>
							<div class="form-group">
								<label class="control-label" style="color:red;">Tuition Fee</label>
								<input type="text" class="form-control small" style="width:130px;" id="a9" value="">
							</div>							
							<div class="form-group">
								<label class="control-label" style="color:red;">First Term Tuition Fee</label>
								<input type="text" class="form-control small" style="width:120px;" id="a10" value="">
							</div>
							<div class="form-group" style="margin-left:10px;">
								<label class="control-label" style="color:red;">Discount</label>
								<input type="text" class="form-control small" style="width:120px;" id="a11" value="0">
							</div>
							<div class="form-group" style="display:block;line-height:40px;">
								<label class="control-label" style="color:red;">Commission</label>
								<input type="text" class="form-control small" style="width:120px;" id="a12" value="0">
							</div>
							<div class="form-group" style="display:block;line-height:40px;">
							<div class="form-group" style="margin-left:53px;">
								<label class="control-label">GST</label>
								<input type="text" autocomplete="off" id="a13" class="form-control" style="width:100px;" readonly="readonly">
							</div>
							<div class="form-group" style="margin-left:30px;">
								<label class="control-label">Deduct GST</label>
								<input type="text" autocomplete="off" id="a14" class="form-control" style="width:120px;" readonly="readonly">
							</div>
							<div class="form-group" style="margin-left:25px;">
								<label class="control-label">月奖</label>
								<input type="text" autocomplete="off" id="a15" class="form-control" style="width:120px;" readonly="readonly">
							</div>
							</div>
							<div class="form-group" style="line-height:40px;">
								<label class="control-label">学校支付日期</label>
								<input type="text" autocomplete="off" id="a16" class="form-control default-date-picker1" style="width:120px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
							</div>
							<div class="form-group" style="line-height:40px;">
								<label class="control-label">INVOICE NO.</label>
								<input type="text" autocomplete="off" id="a17" class="form-control" style="width:120px;" placeholder="" value="">
							</div>
							<div class="form-group" style="line-height:40px;">
								<label class="control-label">学校支付金额</label>
								<input type="text" autocomplete="off" id="a18" class="form-control" style="width:120px;" placeholder="" value="">
							</div>
							<div class="form-group" style="width:100%;line-height:40px;">
								<label class="control-label">Subagency</label>
								<select class="form-control" style="width:150px;" id="a19"></select>
							</div>							
							<div class="form-group" style="margin-left:28px;line-height:40px;">
								<label class="control-label">顾问</label>
								<select class="form-control" style="width:150px;" id="a20"></select>
							</div>
							<div class="form-group">
								<label class="control-label">文案</label>
								<select class="form-control" style="width:150px;" id="a21"></select>
							</div>
							<div class="form-group" style="width:100%;margin-top:5px;margin-left:28px;line-height:40px;">
								<label class="control-label">备注</label>
								<textarea id="a23" class="form-control" style="width:90%"></textarea>
							</div>
							</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="table_addsave1()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.dcjqaccordion.2.7.js"></script>
		<script src="js/jquery.scrollTo.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>
		<script src="assets/bootstrap-datepicker/js/bootstrap-datepicker-new.js"></script><!-- BOOTSTRAP DATEPICKER JS  -->
    <script src="assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script><!-- BOOTSTRAP DATETIMEPICKER JS  -->
    <script src="js/jquery.autocompleter.js"></script>
		<script src="js/common-scripts.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/common.js?verson=1"></script>
		<script>
			tb.isLogin("table-2.html");
			$("td,th").addClass("text-center");
			var v = new Vue({
				el: '#table2',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),
					adviser_id: sessionStorage.getItem("adviser_id"),
					m_list: localStorage.getItem("str_html"),
					allSort: [],
					subject: [],
					count: 0,
					dId: '',
					eId: '',
					name: '',
					school_name: '',
					country: '',
					sort: '',
					state: '',
					pageNum: 0,
					pageSize: 10,
					allPage: 0,
					add: false,
					current_index: '',
					current_row: '',
					index: 0,
					close: false
				},
				created: function() {
					this.getDatalist();
					this.getSort();
				},				
				methods: {
					getData: function() {
						var that = this;
						$.get(url + "school_brokerage_sa/count", {
							keyword: that.keyword,							
							adviserId: that.adviserId,
							startHandlingDate: that.startHandlingDate,
							endHandlingDate: that.endHandlingDate,
							startDate: that.startDate,
							endDate: that.endDate,
							schoolId: that.schoolId,
							subagencyId: that.subagencyId,
							isSettleAccounts: that.isSettleAccounts
						}, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						$.get(url + "school_brokerage_sa/list", {
							keyword: that.keyword,							
							adviserId: that.adviserId,
							startHandlingDate: that.startHandlingDate,
							endHandlingDate: that.endHandlingDate,
							startDate: that.startDate,
							endDate: that.endDate,
							schoolId: that.schoolId,
							subagencyId: that.subagencyId,
							isSettleAccounts: that.isSettleAccounts,
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							//console.log(result)
							that.pageNum = 0;
							for(var i = 0; i < result.data.length; i++) {
									result.data[i].gmtCreate = that.getTime(result.data[i].gmtCreate);
									result.data[i].handlingDate = that.getTime(result.data[i].handlingDate);
									result.data[i].birthday = that.getTime(result.data[i].birthday);
									result.data[i].startDate = that.getTime(result.data[i].startDate);
									result.data[i].endDate = that.getTime(result.data[i].endDate);
									if (result.data[i].payDate != null) result.data[i].payDate = that.getTime(result.data[i].payDate);								
									if (result.data[i].settleAccounts)
									{
											result.data[i].settleAccounts = '是';
									}else
									{
											result.data[i].settleAccounts = '否';
									}
									if (result.data[i].remindDateList)
									{
											var str_remindDateList = '';
											var str = result.data[i].remindDateList;
											var arr = result.data[i].remindDateList;								
											for(var t =0;t<arr.length;t++)
											{
													if (str_remindDateList =='')
													{
															str_remindDateList = that.getTime(arr[t]);
													}else
													{
															str_remindDateList += '<br>'+that.getTime(arr[t]);
													}
											}
											result.data[i].remindDateList = str_remindDateList;
									}
							};
							that.subject = result.data;
							//console.log(that.subject);
						});
					},
					exportData: function() {
						var that = this;
						var down_url = url + "down/school_brokerage_sa?";
						if (typeof(that.keyword) != "undefined")
						{
								down_url += "&keyword="+that.keyword;
						}else
						{
								down_url += "&keyword=";
						}
						if (typeof(that.adviserId) != "undefined")
						{
								down_url += "&adviserId="+that.adviserId;
						}else
						{
								down_url += "&adviserId=";
						}
						if (typeof(that.startHandlingDate) != "undefined")
						{
								down_url += "&startHandlingDate="+that.startHandlingDate;
						}else
						{
								down_url += "&startHandlingDate=";
						}
						if (typeof(that.endHandlingDate) != "undefined")
						{
								down_url += "&endHandlingDate="+that.endHandlingDate;
						}else
						{
								down_url += "&endHandlingDate=";
						}
						if (typeof(that.startDate) != "undefined")
						{
								down_url += "&startDate="+that.startDate;
						}else
						{
								down_url += "startDate=";
						}
						if (typeof(that.endDate) != "undefined")
						{
								down_url += "&endDate="+that.endDate;
						}else
						{
								down_url += "&endDate=";
						}
						if (typeof(that.schoolId) != "undefined")
						{
								down_url += "&schoolId="+that.schoolId;
						}else
						{
								down_url += "&schoolId=";
						}
						if (typeof(that.subagencyId) != "undefined")
						{
								down_url += "&subagencyId="+that.subagencyId;
						}else
						{
								down_url += "&subagencyId=";
						}
						down_url += "&isSettleAccounts="+that.isSettleAccounts;
						//console.log(down_url);
						var a = document.createElement('a');
						a.download = 'school_brokerage_sa_information.xls';
						a.href = down_url;
						$("body").append(a);
						a.click();
						$(a).remove();
					},
					getSort: function() {
						var that = this;
						$.get(url + "school_brokerage_sa/list", {
							state: "",
							pageNum: 0,
							pageSize: 1000000
						}, function(result) {
							console.log(result)
							that.allSort = result.data;
						});
					},
					getDatalist: function() {
						var that = this;
						$.get(url + "school_brokerage_sa/count", {
							keyword: that.name							
						}, function(result) {
							console.log(result)
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
							console.log(that.allPage)
						});
						$.get(url + "school_brokerage_sa/list", {
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							//console.log(result)
							that.pageNum = 0;
							for(var i = 0; i < result.data.length; i++) {
								result.data[i].gmtCreate = that.getTime(result.data[i].gmtCreate);
								result.data[i].handlingDate = that.getTime(result.data[i].handlingDate);
								result.data[i].birthday = that.getTime(result.data[i].birthday);
								result.data[i].startDate = that.getTime(result.data[i].startDate);
								result.data[i].endDate = that.getTime(result.data[i].endDate);
								if (result.data[i].payDate != null) result.data[i].payDate = that.getTime(result.data[i].payDate);								
								if (result.data[i].settleAccounts)
								{
										result.data[i].settleAccounts = '是';
								}else
								{
										result.data[i].settleAccounts = '否';
								}
								if (result.data[i].remindDateList)
								{
										var str_remindDateList = '';
										var str = result.data[i].remindDateList;
										var arr = result.data[i].remindDateList;								
										for(var t =0;t<arr.length;t++)
										{
												if (str_remindDateList =='')
												{
														str_remindDateList = that.getTime(arr[t]);
												}else
												{
														str_remindDateList += '<br>'+that.getTime(arr[t]);
												}
										}
										result.data[i].remindDateList = str_remindDateList;
								}								
							};
							that.subject = result.data;
							//console.log(that.subject);
						});
					},
					getTime: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y;
						return date2;
					},
					addZero: function(obj) {
						if(obj < 10) {
							obj = '0' + obj;
						};
						return obj;
					},
					firstPage: function() {
						var that = this;
						if(that.pageNum > 0) {
							$.get(url + "school_brokerage_sa/list", {
								keyword: that.name,
								state: that.state,
								pageNum: 0,
								pageSize: that.pageSize
							}, function(result) {
								console.log(result)
								that.pageNum = 0;
								for(var i = 0; i < result.data.length; i++) {
										result.data[i].gmtCreate = that.getTime(result.data[i].gmtCreate);
										result.data[i].handlingDate = that.getTime(result.data[i].handlingDate);
										result.data[i].birthday = that.getTime(result.data[i].birthday);
										result.data[i].startDate = that.getTime(result.data[i].startDate);
										result.data[i].endDate = that.getTime(result.data[i].endDate);
										if (result.data[i].payDate != null) result.data[i].payDate = that.getTime(result.data[i].payDate);
										if (result.data[i].settleAccounts)
										{
												result.data[i].settleAccounts = '是';
										}else
										{
												result.data[i].settleAccounts = '否';
										}
										if (result.data[i].remindDateList)
										{
												var str_remindDateList = '';
												var str = result.data[i].remindDateList;
												var arr = result.data[i].remindDateList;								
												for(var t =0;t<arr.length;t++)
												{
														if (str_remindDateList =='')
														{
																str_remindDateList = that.getTime(arr[t]);
														}else
														{
																str_remindDateList += '<br>'+that.getTime(arr[t]);
														}
												}
												result.data[i].remindDateList = str_remindDateList;
										}
								};
								that.subject = result.data;
							});
						}
					},
					prevPage: function() {
						var that = this;
						if(that.pageNum > 0) {
							that.pageNum--;
							$.get(url + "school_brokerage_sa/list", {
								keyword: that.name,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								console.log(result)
								for(var i = 0; i < result.data.length; i++) {
										result.data[i].gmtCreate = that.getTime(result.data[i].gmtCreate);
										result.data[i].handlingDate = that.getTime(result.data[i].handlingDate);
										result.data[i].birthday = that.getTime(result.data[i].birthday);
										result.data[i].startDate = that.getTime(result.data[i].startDate);
										result.data[i].endDate = that.getTime(result.data[i].endDate);
										if (result.data[i].payDate != null) result.data[i].payDate = that.getTime(result.data[i].payDate);
										if (result.data[i].settleAccounts)
										{
												result.data[i].settleAccounts = '是';
										}else
										{
												result.data[i].settleAccounts = '否';
										}
										if (result.data[i].remindDateList)
										{
												var str_remindDateList = '';
												var str = result.data[i].remindDateList;
												var arr = result.data[i].remindDateList;								
												for(var t =0;t<arr.length;t++)
												{
														if (str_remindDateList =='')
														{
																str_remindDateList = that.getTime(arr[t]);
														}else
														{
																str_remindDateList += '<br>'+that.getTime(arr[t]);
														}
												}
												result.data[i].remindDateList = str_remindDateList;
										}
								};
								that.subject = result.data;
							});
						}
					},
					nextPage: function() {
						var that = this;
						if(that.pageNum < that.allPage - 1) {
							that.pageNum++;
							$.get(url + "school_brokerage_sa/list", {
								keyword: that.name,
								categoryId: that.sort,
								state: that.state,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								console.log(result)
								for(var i = 0; i < result.data.length; i++) {
										result.data[i].gmtCreate = that.getTime(result.data[i].gmtCreate);
										result.data[i].handlingDate = that.getTime(result.data[i].handlingDate);
										result.data[i].birthday = that.getTime(result.data[i].birthday);
										result.data[i].startDate = that.getTime(result.data[i].startDate);
										result.data[i].endDate = that.getTime(result.data[i].endDate);
										if (result.data[i].payDate != null) result.data[i].payDate = that.getTime(result.data[i].payDate);
										if (result.data[i].settleAccounts)
										{
												result.data[i].settleAccounts = '是';
										}else
										{
												result.data[i].settleAccounts = '否';
										}
										if (result.data[i].remindDateList)
										{
												var str_remindDateList = '';
												var str = result.data[i].remindDateList;
												var arr = result.data[i].remindDateList;								
												for(var t =0;t<arr.length;t++)
												{
														if (str_remindDateList =='')
														{
																str_remindDateList = that.getTime(arr[t]);
														}else
														{
																str_remindDateList += '<br>'+that.getTime(arr[t]);
														}
												}
												result.data[i].remindDateList = str_remindDateList;
										}
								};
								that.subject = result.data;
							});
						}
					},
					lastPage: function() {
						var that = this;
						if(that.pageNum < that.allPage - 1) {
							$.get(url + "school_brokerage_sa/list", {
								keyword: that.name,
								categoryId: that.sort,
								state: that.state,
								pageNum: that.allPage - 1,
								pageSize: that.pageSize
							}, function(result) {
								console.log(result)
								that.pageNum = that.allPage - 1;
								for(var i = 0; i < result.data.length; i++) {
										result.data[i].gmtCreate = that.getTime(result.data[i].gmtCreate);
										result.data[i].handlingDate = that.getTime(result.data[i].handlingDate);
										result.data[i].birthday = that.getTime(result.data[i].birthday);
										result.data[i].startDate = that.getTime(result.data[i].startDate);
										result.data[i].endDate = that.getTime(result.data[i].endDate);
										if (result.data[i].payDate != null) result.data[i].payDate = that.getTime(result.data[i].payDate);
										if (result.data[i].settleAccounts)
										{
												result.data[i].settleAccounts = '是';
										}else
										{
												result.data[i].settleAccounts = '否';
										}
										if (result.data[i].remindDateList)
										{
												var str_remindDateList = '';
												var str = result.data[i].remindDateList;
												var arr = result.data[i].remindDateList;								
												for(var t =0;t<arr.length;t++)
												{
														if (str_remindDateList =='')
														{
																str_remindDateList = that.getTime(arr[t]);
														}else
														{
																str_remindDateList += '<br>'+that.getTime(arr[t]);
														}
												}
												result.data[i].remindDateList = str_remindDateList;
										}										
								};
								that.subject = result.data;
							});
						}
					},
					table_insert() {
						$('#schoolid').val(0);
						$('#school_name').val('');
						$('#school_subject').val('');
						$('#t5').find("option:selected").text("");
						$('#t5').empty();
						if (!this.add)
						{
								if (this.current_index != null)
								{
										this.subject[this.current_index] = this.current_row;
										this.current_index = '';
										this.current_row = '';
								}
								var paydate_isreadonly = '"';
								var invoicecode_isreadonly = '';
								var payamount_isreadonly = '';
								if (this.ap_list =='GW')
								{
										paydate_isreadonly = 'default-date-picker" readonly="readonly';
										invoicecode_isreadonly = ' readonly="readonly"';
										payamount_isreadonly = ' readonly="readonly"';
								}else
								{
										paydate_isreadonly = ' default-date-picker';
								}
								this.subject.splice(0,0, {
									handlingDate:'<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:120px;" id="t0" data-date-format="dd-mm-yyyy" value="">',
									userName: '<div class="field"><input type="text" class="form-control small" style="width:150px;" id="t1" placeholder="请输入查询" onKeyUp="value=value.replace(/[^a-zA-Z ]/g,\'\')" value=""></div>',
									birthday: '<p id="t2" style="width:120px;"></p>',
									phone: '<p id="t3" style="width:120px;"></p>',
									schoolName: '<select class="form-control" style="width:150px;" id="t4" onchange="if (this.value!=\'\'){check_setting(this.value);ajax_subject();}else{set_empty();}"></select>',
									schoolSubject: '<select class="form-control" style="width:150px;" id="t5" onchange="set_schoolid(this.value)"></select>',
									studentCode: '<input type="text" class="form-control small" style="width:120px;" id="t6" data-date-format="dd-mm-yyyy" value="">',
									startDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker1" style="width:120px;" id="t7" data-date-format="dd-mm-yyyy" value="">',
									endDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker1" style="width:120px;" id="t8" data-date-format="dd-mm-yyyy" value="">',
									//remindDateList: '<textarea class="form-control" style="width:180px;" id="t9"></textarea>',
									remindDateList: '<label id="t9" style="width:150px;"></label>',
									tuitionFee: '<input type="text" class="form-control small" style="width:120px;" id="t10" value="">',
									firstTermTuitionFee: '<input type="text" class="form-control small" style="width:120px;" id="t11" value="">',
									discount: '<input type="text" class="form-control small" style="width:120px;" id="t23" value="">',
									commission: '<input type="text" class="form-control small" style="width:120px;" id="t12" value="">',
									gst: '<label id="t13" style="width:50px;"></label>',
									deductGst: '<label id="t14" style="width:50px;"></label>',
									bonus: '<label id="t15" style="width:50px;"></label>',
									payDate: '<input type="text" autocomplete="off" class="form-control small'+paydate_isreadonly+'" style="width:120px;" id="t16" data-date-format="dd-mm-yyyy" value="">',
									invoiceCode: '<input type="text" class="form-control small" style="width:120px;" id="t17" value=""'+invoicecode_isreadonly+'>',
									payAmount: '<input type="text" class="form-control small" style="width:120px;" id="t18" value=""'+payamount_isreadonly+'>',
									subagencyName: '<select class="form-control" style="width:150px;" id="t19"></select>',
									settleAccounts: '<label id="t22" style="width:50px;"></label>',
									adviserName: '<select class="form-control" style="width:150px;" id="t20"></select>',
									officialName: '<select class="form-control" style="width:150px;" id="t21"></select>',
									remarks: '<textarea id="t23" class="form-control" style="width:150px;"></textarea>'
									});
								this.add = true;
						}
					},
					table_modify: function (index) {						
						if (this.current_index != null)
						{
								if (this.add)
								{
										this.subject[this.current_index-1] = this.current_row;
								}else
								{
										this.subject[this.current_index] = this.current_row;
								}
						}
						this.current_index = index;
						this.current_row = this.subject[index];	
						dId = this.subject[index].id;
						var paydate_isreadonly = '"';
						var invoicecode_isreadonly = '';
						var payamount_isreadonly = '';
						if (this.ap_list =='GW')
						{
								paydate_isreadonly = 'default-date-picker" readonly="readonly';
								invoicecode_isreadonly = ' readonly="readonly"';
								payamount_isreadonly = ' readonly="readonly"';
						}else
						{
								paydate_isreadonly = ' default-date-picker';
						}
						//this.subject[index].remindDateList = this.subject[index].remindDateList.replace(/<br>/g,"\n");
						if (this.subject[index].payDate == null) this.subject[index].payDate = '';
						if (this.subject[index].invoiceCode == null) this.subject[index].invoiceCode = '';
						if (this.subject[index].remarks == null) this.subject[index].remarks = '';
						this.subject.splice(index,1, { 
							handlingDate:'<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:120px;" id="t0" data-date-format="dd-mm-yyyy" value="'+this.subject[index].handlingDate+'">',
							userName: '<div class="field"><input type="text" class="form-control small" style="width:150px;" id="t1" placeholder="请输入查询" onKeyUp="value=value.replace(/[^a-zA-Z ]/g,\'\')" value="'+this.subject[index].userName+'"></div>',
							birthday: '<p id="t2" style="width:120px;">'+this.subject[index].birthday+'</p>',
							phone: '<p id="t3" style="width:120px;">'+this.subject[index].phone+'</p>',
							schoolName: '<select class="form-control" style="width:150px;" id="t4" onchange="if (this.value!=\'\'){check_setting(this.value);ajax_subject();}else{set_empty();}"></select>',
							schoolSubject: '<select class="form-control" style="width:150px;" id="t5" onchange="set_schoolid(this.value)"></select>',
							studentCode: '<input type="text" class="form-control small" style="width:120px;" id="t6" data-date-format="dd-mm-yyyy" value="'+this.subject[index].studentCode+'">',
							startDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker1" style="width:120px;" id="t7" data-date-format="dd-mm-yyyy" value="'+this.subject[index].startDate+'">',
							endDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker1" style="width:120px;" id="t8" data-date-format="dd-mm-yyyy" value="'+this.subject[index].endDate+'">',
							//remindDateList: '<textarea class="form-control" style="width:140px;" id="t9">'+this.subject[index].remindDateList+'</textarea>',
							remindDateList: '<div>'+this.subject[index].remindDateList+'</div><label id="t9" style="width:150px;"><a href="javascript:remindSet(dId);">设置</a></label>',
							tuitionFee: '<input type="text" class="form-control small" style="width:120px;" id="t10" value="'+this.subject[index].tuitionFee+'">',
							firstTermTuitionFee: '<input type="text" class="form-control small" style="width:120px;" id="t11" value="'+this.subject[index].firstTermTuitionFee+'">',
							discount: '<input type="text" class="form-control small" style="width:120px;" id="t23" value="'+this.subject[index].discount+'">',
							commission: '<input type="text" class="form-control small" style="width:120px;" id="t12" value="'+this.subject[index].commission+'">',
							gst: '<label id="t13">'+this.subject[index].gst+'</label>',
							deductGst: '<label id="t14">'+this.subject[index].deductGst+'</label>',
							bonus: '<label id="t15">'+this.subject[index].bonus+'</label>',
							payDate: '<input type="text" autocomplete="off" class="form-control small'+paydate_isreadonly+'" style="width:120px;" id="t16" data-date-format="dd-mm-yyyy" value="'+this.subject[index].payDate+'">',
							invoiceCode: '<input type="text" class="form-control small" style="width:120px;" id="t17" value="'+this.subject[index].invoiceCode+'"'+invoicecode_isreadonly+'>',
							payAmount: '<input type="text" class="form-control small" style="width:120px;" id="t18" value="'+this.subject[index].payAmount+'"'+payamount_isreadonly+'>',
							subagencyName: '<select class="form-control" style="width:150px;" id="t19"></select>',
							settleAccounts: '<label id="t22" style="width:50px;"></label>',
							adviserName: '<select class="form-control" style="width:150px;" id="t20"></select>',
							officialName: '<select class="form-control" style="width:150px;" id="t21"></select>',
							remarks: '<textarea id="t23" class="form-control" style="width:150px;">'+this.subject[index].remarks+'</textarea>',
							btnsave: '<a class="edit" href="javascript:;"><span class="label label-primary">Save</span></a>',
							btncancel: '<a class="cancel" href="javascript:;"><span class="label label-info">Cancel</span></a>',
						});						
						if (this.add)
						{
								this.subject.splice(0, 1);
								this.add = false;
								this.current_index = index-1;								
						}
						//alert(this.current_row.id);																			
					},
					table_remove: function (index) {
             this.subject.splice(index, 1);  
          },
          delete_confirm: function (index,id) {
          	$('#delete_id').modal('show');
          	this.dId = id;
          	this.index = index;
          },
          close_confirm: function (index,id,close) {
          	if (close)
          	{
          			$('#close_title').html('打开');
          			$('#close_title1').html('打开');
          	}else
          	{
          			$('#close_title').html('关闭');
          			$('#close_title1').html('关闭');
          	}
          	$('#close_id').modal('show');
          	this.dId = id;
          	this.index = index;        	
          	this.close = close;
          },
          remindSet: function (id){
			      		$('#remind_id').modal('show');
			      		$("#setdate").val('');
			      		v.dId = id;
			    }
				}				
			});
			
			$('#example a.edit').live('click', function (e) {
				e.preventDefault();
				table_addsave();
			});
			
			$('#example a.cancel').live('click', function (e) {
				e.preventDefault();
				if (!parseInt($("#id").val()))
				{
						v.subject.splice(0, 1);
						v.add = false;
				}else
				{
						v.subject.splice(v.current_index, 0);
						v.subject.splice(v.current_index,1, v.current_row);
				}
			});
			
			function addNew()
			{
					$('#addnew_id').modal('show');
			}
			
			function table_addsave()
			{
          var jqInputs = $('input',$("#example"));
          var jqSelect = $('select',$("#example"));
          var jqTextarea = $('textarea',$("#example"));
          
          var check_result = 0;
          if (jqInputs[0].value != '' && jqInputs[1].value != '' && jqInputs[2].value != '' && jqInputs[3].value != '' && jqInputs[5].value != '' && jqInputs[6].value != '')
          {
          		check_result = true;
          }else
          {
          		alert('所有选项必须填写！');
          }
          
          $.ajaxSettings.async = false; 
          if (check_result)
          {
          		var arr_d = jqInputs[0].value.split("/");
          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
              var date = new Date(str_d);
              var d0 = date.getTime();
              arr_d = jqInputs[3].value.split("/");
          		str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
              date = new Date(str_d);
              var d5 = date.getTime();
              arr_d = jqInputs[4].value.split("/");
          		str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
              date = new Date(str_d);
              var d6 = date.getTime();
              var d10 = '';
              if (jqInputs[9].value != '')
              {
              		arr_d = jqInputs[9].value.split("/");
          				str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
		              date = new Date(str_d);
		              d10 = date.getTime();
            	}
              var str_url = "school_brokerage_sa/add";
              var sa_id = $("#id").val();
              if (sa_id != '0') str_url = "school_brokerage_sa/update";
              $("#id").val('0');
              
              $.post(str_url, { id: sa_id, handlingDate: d0, userId: $('#userid').val(), schoolId: $('#schoolid').val(),studentCode: jqInputs[2].value, startDate: d5, endDate: d6, tuitionFee: jqInputs[5].value, firstTermTuitionFee: jqInputs[6].value, discount: jqInputs[7].value, commission: jqInputs[8].value, payDate: d10, invoiceCode: jqInputs[10].value, payAmount: jqInputs[11].value, subagencyId: jqSelect[2].value, adviserId: jqSelect[3].value, officialId: jqSelect[4].value,remarks: jqTextarea[0].value},
					   	function(data){
					   			if (data.code == 0)
					   			{
					   					//设置提醒
					   					/*if (jqTextarea[0].value != '')
					   					{					   							
					   							var arr = jqTextarea[0].value.split(/[\n,]/g);
					   							var remind_d = 0;
											    for(var i =0;i<arr.length;i++)
											    {
											    		date = new Date(arr[i]);
											    		remind_d = date.getTime();
											    		$.post('remind/add', { schoolBrokerageSaId: 2, remindDate: remind_d},
													   	function(data){							   			
													   	});						    
											    }
					   					}*/
					   					if (data.data.id) sa_id = data.data.id;					   					
					   					//重新计算佣金
					   					$.post('school_brokerage_sa/updateCommission', { id: sa_id},
					   					function(data){
					   						if (data.code != 0)
					   						{
					   								$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
						          			$("#error_info").html(data.message);
							        			return false;
					   						}
					   					});
					   					v.add = false;
					   					$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					v.table_remove();
					   					//重新载入数据源
					   					v.getDatalist();
					   					v.getSort();
					   			}
					   			//console.log(data);
					   	});
			  	}                
      }
      
      function table_addsave1()
			{
          var jqInputs = $('input',$("#addnew_id"));
          var jqSelect = $('select',$("#addnew_id"));
          var jqTextarea = $('textarea',$("#addnew_id"));
          
          var check_result = 0;
          if (jqInputs[0].value != '' && jqInputs[1].value != '' && jqInputs[4].value != '' && jqInputs[5].value != '' && jqInputs[6].value != '' && jqInputs[7].value != '' && jqInputs[8].value != '' && jqInputs[9].value != '' && jqInputs[10].value != '')
          {
          		check_result = true;
          }else
          {
          		$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
        			$("#error_info").html('所有选项必须填写！(备注可选填。)');
        			return false;
          }
          
          $.ajaxSettings.async = false; 
          if (check_result)
          {
          		var arr_d = jqInputs[0].value.split("/");
          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
              var date = new Date(str_d);
              var d0 = date.getTime();
              arr_d = jqInputs[5].value.split("/");
          		str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
              date = new Date(str_d);
              var d5 = date.getTime();
              arr_d = jqInputs[6].value.split("/");
          		str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
              date = new Date(str_d);
              var d6 = date.getTime();
              var d14 = '';
              if (jqInputs[14].value != '')
              {
              		arr_d = jqInputs[14].value.split("/");
          				str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
		              date = new Date(str_d);
		              d14 = date.getTime();
            	}
              var str_url = "school_brokerage_sa/add";
              var sa_id = $("#id").val();
              if (sa_id != '0') str_url = "school_brokerage_sa/update";
              $("#id").val('0');
              
              $.post(str_url, { id: sa_id, handlingDate: d0, userId: $('#userid').val(), schoolId: $('#schoolid').val(),studentCode: jqInputs[2].value, startDate: d5, endDate: d6, tuitionFee: jqInputs[7].value, firstTermTuitionFee: jqInputs[8].value, discount: jqInputs[9].value, commission: jqInputs[10].value, payDate: d14, invoiceCode: jqInputs[15].value, payAmount: jqInputs[16].value, subagencyId: jqSelect[2].value, adviserId: jqSelect[3].value, officialId: jqSelect[4].value,remarks: jqTextarea[0].value},
					   	function(data){
					   			if (data.code == 0)
					   			{					   					
					   					if (data.data.id) sa_id = data.data.id;					   					
					   					//重新计算佣金
					   					$.post('school_brokerage_sa/updateCommission', { id: sa_id},
					   					function(data){
					   						if (data.code != 0)
					   						{
					   								$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
						          			$("#error_info").html(data.message);
							        			return false;
					   						}
					   					});
					   					$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					$('#addnew_id').modal('hide');
					   					//重新载入数据源
					   					v.getDatalist();
					   					v.getSort();
					   			}else
					   			{
					   					$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#error_info").html(data.message);
				        			return false;
					   			}
					   			//console.log(data);
					   	});
			  	}                
      }
			
			v.$watch('subject', function(obj) {
					$('.default-date-picker').datepicker({   				
				        format: 'dd/mm/yyyy',
				        endDate: new Date()				        
				  });
				  $('.default-date-picker1').datepicker({   				
				        format: 'dd/mm/yyyy'			        
				  });
				  $('.default-date-picker2').datepicker({   				
				        format: 'yyyy-mm-dd'			        
				  });
				  var schoolId = 0;
				  var schoolName = '';
				  var schoolSubject = '';
				  var adviserId = 0;
				 	var officialId = 0;
				 	var subagencyId = 0;
				 	if (this.current_row.id)
				  {
				  		$("#id").val(this.current_row.id);
				  		schoolId = this.current_row.schoolId;
				  		schoolName = this.current_row.schoolName;
				  		schoolSubject = this.current_row.schoolSubject;
				  		adviserId = this.current_row.adviserId;
				  		officialId = this.current_row.officialId;
				  		subagencyId = this.current_row.subagencyId;
				  		$("#userid").val(this.current_row.userId);
				  		$("#schoolid").val(this.current_row.schoolId);
				  		$("#school_name").val(schoolName);
				  		$("#school_subject").val(schoolSubject);
				  }else
				  {
				  		officialId = 3;
				  }
				  var user = $("#t1");
				  user.autocompleter({
			    	highlightMatches: true,
			    	limit: 10,
			    	cache: false,
			    	customValue: 'name',
			    	customLabel: 'name',
			    	source: 'user/list?authNickname=&phone=&pageNum=0',
			    	combine: function(params) {
			    		return {
				        name: params.query,
				        pageSize: params.limit
				      };
			    	},
			    	callback: function(value, index, object) {
			    		$('#userid').val(object.id);
			    		$("#t2").html(formatDate(object.birthday));
			    		$("#t3").html(object.phone);
			    	},
			    	minLength: 1						    	
			    });
			    var user1 = $("#a1");
				  user1.autocompleter({
			    	highlightMatches: true,
			    	limit: 10,
			    	cache: false,
			    	customValue: 'name',
			    	customLabel: 'name',
			    	source: 'user/list?authNickname=&phone=&pageNum=0',
			    	combine: function(params) {
			    		return {
				        name: params.query,
				        pageSize: params.limit
				      };
			    	},
			    	callback: function(value, index, object) {
			    		$('#userid').val(object.id);
			    		$("#a2").val(formatDate(object.birthday));
			    		$("#a3").val(object.phone);
			    	},
			    	minLength: 1						    	
			    });   	    
			    //绑定学校信息
			    var school_name = $("#t4");
			    school_name.append("<option value=''>请选择学校</option>");
			    $.ajax({
	          url: 'school/listSchool?name=',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			school_name.append("<option value='"+response[item].name+"'>"+response[item].name+"</option>");
	        	}	
	        	school_name.val(schoolName);
	        });
	        var school_name1 = $("#a4");
			    school_name1.append("<option value=''>请选择学校</option>");
			    $.ajax({
	          url: 'school/listSchool?name=',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	response = response.data;	        	    	
	        	for (var item in response)
	        	{
	        			school_name1.append("<option value='"+response[item].name+"'>"+response[item].name+"</option>");
	        	}	
	        	school_name1.val(schoolName);
	        });
	        //绑定课程信息
	        ajax_subject();
	        ajax_subject1();
			    //计算相关金额
	        $("#t12").keyup(function(){
	        	var fee = $("#t12").val();
	        	var gst = (fee/11).toFixed(2);
	        	$("#t13").html('<span>'+gst+'</span>');
	        	var deduct_gst = (fee-gst).toFixed(2);
	        	$("#t14").html('<span>'+deduct_gst+'</span>');
	        	var bonus = (deduct_gst*0.1).toFixed(2);
	        	$("#t15").html('<span>'+bonus+'</span>');	        	
					});
					$("#a12").keyup(function(){
	        	var fee = $("#a12").val();
	        	var gst = (fee/11).toFixed(2);
	        	$("#a13").val(gst);
	        	var deduct_gst = (fee-gst).toFixed(2);
	        	$("#a14").val(deduct_gst);
	        	var bonus = (deduct_gst*0.1).toFixed(2);
	        	$("#a15").val(bonus);	        	
					});
					//绑定Subagency列表
			    var obj_subagencyId = $("#t19");	
			    $.ajax({
	          url: 'subagency/list',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_subagencyId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_subagencyId.val(subagencyId);   
	        });
	        var obj_subagencyId1 = $("#a19");	
			    $.ajax({
	          url: 'subagency/list',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_subagencyId1.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_subagencyId1.val(subagencyId);   
	        });	        
			    //绑定顾问列表
			    var current_user = this.admin;
			    var current_adviserId = this.adviser_id;
			    var obj_adviserId = $("#t20");	
			    $.ajax({
	          url: 'adviser/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	response = response.data;
	        	var isAdmin = false;
	        	if (v.ap_list == 'AD' || v.ap_list == 'null') isAdmin = true;
	        	for (var item in response)
	        	{
	        			if (response[item].id == current_adviserId || isAdmin)
	        			{
	        					obj_adviserId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        			}
	        	}
	        	obj_adviserId.val(current_adviserId);   
	        });
	        var obj_adviserId1 = $("#a20");	
			    $.ajax({
	          url: 'adviser/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	response = response.data;
	        	var isAdmin = false;
	        	if (v.ap_list == 'AD' || v.ap_list == 'null') isAdmin = true;
	        	for (var item in response)
	        	{
	        			if (response[item].id == current_adviserId || isAdmin)
	        			{
	        					obj_adviserId1.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        			}
	        	}
	        	obj_adviserId1.val(current_adviserId);   
	        });
	        //绑定文案列表
			    var obj_officialId = $("#t21");	
			    $.ajax({
	          url: 'official/list?pageNum=0&pageSize=10',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_officialId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_officialId.val(officialId);	        	
	        });
	        var obj_officialId1 = $("#a21");	
			    $.ajax({
	          url: 'official/list?pageNum=0&pageSize=10',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_officialId1.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_officialId1.val(officialId);	        	
	        });
			});
			
			function check_setting(school_name)
			{
					$.ajax({
	          url: 'school/hasSchoolSetting?schoolName='+school_name,
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	result = response.data;
	        	if (!result)
	        	{
	        			$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
          			$("#error_info").html('选择的学校未设置佣金卡片，请联系管理员设置。');
	        			return false;
	        	}
	        });
			}
			
			function ajax_subject()
			{
				var school_subject = $("#t5");
				var school_name = $("#t4").find("option:selected").text();				
				if (school_name != '请选择学校' || $("#school_name").val() != '')
				{
						schoolid = $("#schoolid").val();
						schoolSubject = $("#school_subject").val();
						if (school_name == '请选择学校') school_name = $("#school_name").val();
						v.school_name = school_name;
						school_subject.find("option:selected").text("");
						school_subject.empty();
						school_subject.append("<option value=''>请选择</option>");
				    $.ajax({
		          url: 'school/list?name='+school_name,
		          type: 'GET',
		          dataType: 'json'
		        }).done(function(response) {
		        	response = response.data;
		        	for (var item in response)
		        	{
		        			if (!response[item].subject == '')
		        			{
				        			school_subject.append("<option value='"+response[item].id+"'>"+response[item].subject+"</option>");
				        			v.country = response[item].country;
		        			}
		        	}
		        	school_subject.append("<option value='-1'>我要添加</option>");
		        	if(schoolSubject != '') school_subject.val(schoolid);		        	
		        });
      	}else
      	{
      			school_subject.find("option:selected").text("");
						school_subject.empty();
      	}
			}
			
			function ajax_subject1()
			{
				var school_subject1 = $("#a5");
				var school_name = $("#a4").find("option:selected").text();				
				if (school_name != '请选择学校' || $("#school_name").val() != '')
				{
						schoolid = $("#schoolid").val();
						schoolSubject = $("#school_subject").val();
						if (school_name == '请选择学校') school_name = $("#school_name").val();
						v.school_name = school_name;						
						school_subject1.find("option:selected").text("");
						school_subject1.empty();
						school_subject1.append("<option value=''>请选择</option>");
				    $.ajax({
		          url: 'school/list?name='+school_name,
		          type: 'GET',
		          dataType: 'json'
		        }).done(function(response) {
		        	response = response.data;
		        	for (var item in response)
		        	{
		        			if (!response[item].subject == '')
		        			{
				        			school_subject1.append("<option value='"+response[item].id+"'>"+response[item].subject+"</option>");		
				        			v.country = response[item].country;
		        			}
		        	}
		        	school_subject1.append("<option value='-1'>我要添加</option>");
		        	if(schoolSubject != '') school_subject1.val(schoolid);		        	
		        });
      	}else
      	{
      			school_subject1.find("option:selected").text("");
						school_subject1.empty();
      	}
			}
			
			function set_empty()
			{
				var school_subject = $("#t5");
				school_subject.find("option:selected").text("");
				school_subject.empty();
				school_subject.append("<option value=''>请选择</option>");
			}
			
			function set_empty1()
			{
				var school_subject1 = $("#a5");
				school_subject1.find("option:selected").text("");
				school_subject1.empty();
				school_subject1.append("<option value=''>请选择</option>");
			}
			
			function set_schoolid(id)
			{
				if(id > 0)
				{
					$("#schoolid").val(id);
				}else if(id == '')
				{
					$("#schoolid").val(0);
				}else if(id == -1)
				{
					$('#add_schoolsubject_id').modal('show');
				}
			}
			
			function set_schoolid1(id)
			{
				if(id > 0)
				{
					$("#schoolid").val(id);
				}else if(id == '')
				{
					$("#schoolid").val(0);
				}else if(id == -1)
				{
					$('#add_schoolsubject1_id').modal('show');
				}
			}
			
			function schoolSubjectSave()
			{
				var school_subject = $("#schoolsubject_name").val();
				if (school_subject != '')
				{
						var str_url = "school/add";
						$.post(str_url, { id: 0, name: v.school_name, subject: school_subject, country: v.country},
				   	function(data){
				   			if (data.code == 0)
				   			{
				   					//添加成功
				   					$('#add_schoolsubject_id').modal('hide');
				   					ajax_subject();
				   			}
				   			//console.log(data);
				   	});
		  	}
			}
			
			function schoolSubjectSave1()
			{
				var school_subject = $("#schoolsubject_name1").val();
				if (school_subject != '')
				{
						var str_url = "school/add";
						$.post(str_url, { id: 0, name: v.school_name, subject: school_subject, country: v.country},
				   	function(data){
				   			if (data.code == 0)
				   			{
				   					//添加成功
				   					$('#add_schoolsubject1_id').modal('hide');
				   					ajax_subject1();
				   			}
				   			//console.log(data);
				   	});
		  	}
			}						
			
			function deleteId()
      {
					$.get("school_brokerage_sa/delete", {
						id: v.dId
					}, function(result) {
						console.log(result);
						if(result.data == true) {
							$('#delete_id').modal('hide');
							$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
							v.table_remove();
	   					//重新载入数据源
	   					v.getDatalist();
	   					v.getSort();
						};
					});      		
      }            
      
      function closeId()
      {
      		var str_url = '';
      		if (v.close)
      		{
      				str_url = 'school_brokerage_sa/reopen';
      		}else
      		{
      				str_url = 'school_brokerage_sa/close';
      		}
					$.get(str_url, {
						id: v.dId
					}, function(result) {
						console.log(result);
						if(result.data == true) {
							$('#close_id').modal('hide');
							$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
							v.table_remove();
	   					//重新载入数据源
	   					v.getDatalist();
	   					v.getSort();
						};
					});      		
      }            
      
      function remindSetSave()
      {
      		var setdate = $("#setdate").val();
      		if (setdate != '')
      		{
      				var arr_d = setdate.split("/");
          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];     				
		      		var date = new Date(str_d);
			    		var remind_d = date.getTime();			    		
			    		$.post('remind/add', { schoolBrokerageSaId: v.dId, remindDate: remind_d},
					   	function(data){
					   		$('#remind_id').modal('hide');
					   		$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   		v.table_remove();
					   		//重新载入数据源
		   					v.getDatalist();
		   					v.getSort();
					   	});
			  	}
      }
      
      function show_knowledge_detail(id,parentId)
      {
      		sessionStorage.setItem("id", id);
      		sessionStorage.setItem("menu_parentid", parentId);
					window.location.href = "knowledge.html"; 
      }
			
			function  formatDate(now)
			{
			    var   now= new Date(now);     
			    var   year=now.getFullYear();     
			    var   month=now.getMonth()+1;     
			    var   date=now.getDate();     
			    var   hour=now.getHours();
			    var   minute=now.getMinutes();     
			    var   second=now.getSeconds();
			    return fixZero(date,2)+"/"+fixZero(month,2)+"/"+year; 
			}  
			
			function fixZero(num,length)
			{     
			    var str=""+num;
			    var len=str.length;     var s="";
			    for(var i=length;i-->len;)
			    {         
			        s+="0";
			    }
			    return s+str;
			}
			
	    jQuery(document).ready(function() {
	    });
		</script>
	</body>

</html>