<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<link rel="shortcut icon" href="img/favicon.ico">
		<title>银行对账单</title>
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet">
		<link href="assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-datepicker/css/datepicker.css"><!-- BOOTSTRAP DATEPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-timepicker/compiled/timepicker.css"><!-- BOOTSTRAP TIMEPICKER PLUGIN CSS -->		
		<link rel="stylesheet" type="text/css" href="css/jquery.autocompleter.css">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link href="css/index.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body id="accounting-bankbill" v-cloak>
		<section id="container">
			<header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-placement="right" class="fa fa-bars tooltips">
					</div>
				</div>
				<a href="main.html" class="logo">
					佣金系统
					<span v-if="ap_list==='KJ'">
           	 会计
          </span>
          <span v-if="ap_list==='GW'">
           	 顾问
          </span>
          <span v-if="ap_list==='WA'">
           	 文案
          </span>
          <span v-if="ap_list==='MA'">
           	 Mara
          </span>
          <span v-if="ap_list==='SUPERAD'">
           	 超级管理员
          </span>
				</a>
				<div class="top-nav ">
					<ul class="nav pull-right top-menu">
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="username">
                  {{admin}}
                </span>
								<b class="caret">
                </b>
							</a>
							<ul class="dropdown-menu extended logout">
								<li class="log-arrow-up">
								</li>
								<li>
									<a href="password.html">
										<i class="fa fa-key">
                    </i> 修改密码
									</a>
								</li>
								<li><a href="javascript:tb.out();">
										<i class="fa fa-user">
                    </i> Log Out
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</header>
			<aside>
				<div id="sidebar" class="nav-collapse">
					<ul class="sidebar-menu" id="nav-accordion">
						<li >
              <a href="main.html">
                <i class="fa fa-dashboard">
                </i>
                <span>
                  Dashboard
                </span>
              </a>
            </li>
            <dli v-if="ap_list==='SUPERAD'">            
            <li>
              <a href="adviser.html">
                <i class="fa fa-book">
                </i>
                <span>
                  顾问管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 文案管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="official.html">
										文案管理
									</a>
								</li>
								<li>
									<a href="official-tag.html">
										订单标签管理
									</a>
								</li>								
							</ul>
						</li>
            <li>
              <a href="mara.html">
                <i class="fa fa-book">
                </i>
                <span>
                  MARA管理
                </span>
              </a>
            </li>
            <li>
              <a href="accounting.html">
                <i class="fa fa-book">
                </i>
                <span>
                  会计管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 学校管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="school.html">
										学校管理
									</a>
								</li>
								<li>
									<a href="school-setting.html">
										佣金设置
									</a>
								</li>								
							</ul>
						</li>
            <li>
              <a href="receive-type.html">
                <i class="fa fa-book">
                </i>
                <span>
                  收款方式管理
                </span>
              </a>
            </li>
            <li>
              <a href="subagency.html">
                <i class="fa fa-book">
                </i>
                <span>
                  Subagency管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
            	<a href="javascript:;" class="active">
								<i class="fa fa-book">
                </i>
								<span>
                 	 服务管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="service.html">
										服务项目管理
									</a>
								</li>
								<li>
									<a href="service-package.html">
										服务包管理
									</a>
								</li>	
								<li>
									<a href="visa-ca.html">
										签证职业评估管理
									</a>
								</li>							
							</ul>              
            </li>            
          	</dli>
          	<li v-if="ap_list!=='KJ' && ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 客户管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="users.html">
										客户管理
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="user-tags.html">
										标签管理
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='KJ'" class="sub-menu">
							<a href="serviceorder-list.html">
                <i class="fa fa-book">
                </i>
                <span>
                  服务订单管理
                </span>
              </a>
						</li>
            <li v-if="ap_list==='SUPERAD'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 渠道管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="source.html">
										渠道列表
									</a>
								</li>
								<li>
									<a href="source-type.html">
										来源分类
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;" class="active">
								<i class="fa fa-book">
                </i>
								<span>
                 	 佣金表
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" class="active">
									<a href="mycommission.html">
										我的佣金报表
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_PENDING">
									<a href="mycommission.html?applyState=PENDING">
										未申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_COMPLETE">
									<a href="mycommission.html?applyState=COMPLETE">
										已申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_DJY">
									<a href="mycommission-accounting.html?commission_state=DJY">
										待结佣订单
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_YJY">
									<a href="mycommission-accounting.html?commission_state=YJY">
										已结佣订单
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="accounting-bank.html">
										转账信息配置
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'" class="active">
									<a href="accounting-bankbill.html">
										银行对账单
									</a>									
								</li>							
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="mycommission-check-accounting.html">
										自动对账
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="create-visa-commission.html">
										重建签证佣金表订单
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="table-export.html">
										导出数据
									</a>
								</li>
							</ul>
						</li>
						<li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 知识库
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="knowledge-menu.html">
										菜单管理
									</a>
								</li>
								<li>
									<a href="knowledge.html">
										知识库菜单
									</a>
								</li>
								<li>
									<a href="http://question.zhinanzhen.org/api/users/znz/{{admin}}" target="_blank">
										指南针问答
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</aside>
			<section id="main-content" class="content">
				<section class="wrapper site-min-height">
					<div class="row">
						<div class="col-lg-12">
							<section class="panel">
								<header class="panel-heading">
									银行对账单
								</header>
								<div class="panel-body">
									<div class="adv-table editable-table" id="my_table">
										<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
                      <button data-dismiss="alert" class="close close-sm" type="button">
                      <i class="fa fa-times"></i>
                      </button>
                      <strong id="error_info"></strong>
                   	</div>
										<div class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
									      <button data-dismiss="alert" class="close close-sm" type="button">
									      <i class="fa fa-times"></i>
									      </button>
									      <strong>Success!</strong> You  just achieved success.
									  </div>
									  <form class="form-inline" style="margin-top:10px;">
											<div class="form-group">													
													<label>时间范围：</label>	
													<input v-model.trim="bankDateStart" type="text" autocomplete="off" class="form-control default-date-picker" style="width:120px;" placeholder="时间(开始)">
													<label>至</label>
													<input v-model.trim="bankDateEnd" type="text"  autocomplete="off" class="form-control default-date-picker" style="width:120px;" placeholder="时间(结束)">
													<label>选择地区</label>
													<select v-model.trim="regionId" id="regionId1" class="form-control" style="width:130px;">
													</select>
											</div>
											<div class="form-group">
													<button @click="getSearch" type="button" class="btn btn-info">查询</button>
													<button @click="getExport" type="button" class="btn btn-primary">下载Excel</button>
											</div>
											<div class="form-group">
													<button id="upload_excel" class="btn btn-success green" onclick="uploadFile()" type="button">上传Excel <i class="fa fa-plus"></i></button>
                      </div>
										</form>										
										<div class="responsive-table margin-top">
											<input type="hidden" name="id" id="id" value="0" />
											<table class="display table table-bordered table-striped" id="bankbill_list">
												<thead>
													<tr>
														<th>ID</th>
														<th>记账日期</th>
														<th>Name(客户姓名)</th>
														<th>状态</th>												
														<th>入账金额</th>
														<th>余额</th>
														<th>顾问名称</th>
														<th>业务名称</th>
														<th>本次实收金额</th>
														<th>对应佣金订单ID (修改：请双击对应栏)</th>
														<th>Bank statement(备注)</th>
														<th>操作</th>
													</tr>
												</thead>
												<tbody>
													<tr v-for="item in subject" class="gradeX">
														<td v-html="item.oid"></td>
														<td v-html="item.bankDate"></td>
														<td v-html="item.userName"></td>														
														<td v-html="item.strIncome"></td>
														<td v-html="item.money"></td>
														<td v-html="item.balance"></td>
														<td v-html="item.adviserName"></td>
														<td v-html="item.business"></td>
														<td v-html="item.amount"></td>
														<td @dblclick="table_edit($index,'orderId','t1')"><span v-html="item.orderId"></span></td>
														<td v-html="item.comment"></td>
														<td>
																<dli v-if="item.id"></dli>																
																<dli v-else>																																	
																		<a class="save" href="javascript:;"><span style="color:blue;">保存</span></a>
																		<a class="cancel" href="javascript:;">取消</a>
																</dli>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
										<div class="row-fluid" style="display:;">
											<div class="span6">
												<div class="dataTables_info" id="hidden-table-info_info">共{{count}}条</div>
											</div>
											<div class="span6">
												<div class="dataTables_paginate paging_bootstrap pagination">
													<ul>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="firstPage" href="javascript:;">首页</a>
														</li>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="prevPage" href="javascript:;">← Pre</a>
														</li>
														<li class="nowPage">
															第{{pageNum+1}}页
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="nextPage" href="javascript:;">Next → </a>
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="lastPage" href="javascript:;">末页</a>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
							</section>
						</div>
					</div>
				</section>
			</section>
			<footer class="site-footer">
				<div class="text-center">
					2018 &copy; 佣金系统 by <span style="color:#2a8ba7;">GIG</span>.
					<a href="#" class="go-top">
						<i class="fa fa-angle-up">
            </i>
					</a>
				</div>
			</footer>
		</section>		
		<div class="modal fade" id="loading_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static' style="z-index:99999;">
			<div class="modal-dialog" role="document" style="width:350px;">
				<div class="modal-content">
					<div class="modal-header">
					</div>
					<div class="modal-body">
							<div style="text-align:center;color:#0066CC;"><img src="img/input-spinner.gif" /> 正在执行，请稍后...</div>
					</div>
					
				</div>
			</div>
		</div>
		<div class="modal fade" id="upload_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">上传数据</h4>
					</div>
					<div class="modal-body">
							<form class="form-horizontal" autocomplete="off">
							<div class="form-group">
								<label class="col-sm-3 control-label">请选择文件</label>
								<div class="col-sm-8">
									<input type="file" id="f2" accept=".xls,.xlsx" class="form-control" placeholder="请选择一个文件">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">请选择地区</label>
								<div class="col-sm-8">
									<select id="regionId" class="form-control" style="width:130px;">
									</select>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-12 control-label" id="show_message" style="text-align: center;color:red;"></label>
							</div>							
							</form>
					</div>
					<div class="modal-footer">
						<button id="btnUpload" type="button" class="btn btn-primary">确认上传</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>						
					</div>
				</div>
			</div>
		</div>
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.dcjqaccordion.2.7.js"></script>
		<script src="js/jquery.scrollTo.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>
		<script src="assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script><!-- BOOTSTRAP DATEPICKER JS  -->
    <script src="assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script><!-- BOOTSTRAP DATETIMEPICKER JS  -->
    <script src="js/jquery.autocompleter.js"></script>
    <script src="js/jquery.validate.min.js"></script><!-- VALIDATE JS  -->
		<script src="js/common-scripts.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/common.js?verson=1"></script>
		<script>
			tb.isLogin("accounting-bankbill.html");
			$("td,th").addClass("text-center");
			var v = new Vue({
				el: '#accounting-bankbill',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),					
					allSort: [],
					subject: [],
					count: 0,
					dId: '',
					eId: '',
					name: '',
					sort: '',
					state: '',					
					pageSize: 20,
					pageNum: 1000000,
					allPage: 0,
					add: false,
					current_index: '',
					current_row: '',
					bank_id: 0,
					Id: 0,
					index: 0,
					close: false
				},
				created: function() {
					this.getDatalist();
				},
				methods: {					
					getSearch: function() {
						var that = this;
						that.pageNum = 0;
						that.pnumber = null;
						that.getDatalist();
					},					
					getDatalist: function() {
						var that = this;
						$.get(url + "verify/count", {
							bankDateStart: that.bankDateStart,
							bankDateEnd: that.bankDateEnd,
							regionId: that.regionId,
						}, function(result) {
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
						});
						$.get(url + "verify/list", {
							bankDateStart: that.bankDateStart,
							bankDateEnd: that.bankDateEnd,
							regionId: that.regionId,
							pageNum: 0,
							pageSize: that.pageSize
						}, function(result) {
							//console.log(result)
							that.pageNum = 0;							
							that.subject = return_result(result);
							//console.log(that.subject);
						});
					},
					getExport: function() {
						var that = this;						
						//json['commissionState'] = that.commission_state;
						if (typeof(that.bankDateStart) == "undefined" || typeof(that.bankDateEnd) == "undefined")
						{
								$('#my_table #alert_error').css('marginLeft','40%');
				    		$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
				        $("#my_table #error_info").html('提示：时间范围 必须选择！');
								return false;
						}
						show_loading();
						var down_url = url + "verify/down?";
						if (typeof(that.bankDateStart) != "undefined")
						{
								down_url += "bankDateStart="+that.bankDateStart;
						}else
						{
								down_url += "bankDateStart=";
						}
						if (typeof(that.bankDateEnd) != "undefined")
						{
								down_url += "&bankDateEnd="+that.bankDateEnd;
						}else
						{
								down_url += "&bankDateEnd=";
						}
						if (typeof(that.regionId) != "undefined")
						{
								down_url += "&regionId="+that.regionId;
						}else
						{
								down_url += "&regionId=";
						}					
						console.log(down_url);
						var a = document.createElement('a');
						a.download = 'bankbill.xls';
						a.href = down_url;
						$("body").append(a);
						a.click();
						$(a).remove();
						setTimeout(function(){$('#loading_id').modal('hide');}, 3000);
					},
					getTime: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y;
						return date2;
					},
					getTime1: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y+' '+h+':'+m2+':'+s;
						return date2;
					},
					addZero: function(obj) {
						if(obj < 10) {
							obj = '0' + obj;
						};
						return obj;
					},
					firstPage: function() {
						var that = this;
						if(that.pageNum > 0) {
							$.get(url + "verify/list", {
								bankDateStart: that.bankDateStart,
								bankDateEnd: that.bankDateEnd,
								regionId: that.regionId,
								pageNum: 0,
								pageSize: that.pageSize
							}, function(result) {
								that.pageNum = 0;
								that.subject = return_result(result);
							});
						}
					},
					prevPage: function() {
						var that = this;
						if(that.pageNum > 0) {
							that.pageNum--;
							$.get(url + "verify/list", {
								bankDateStart: that.bankDateStart,
								bankDateEnd: that.bankDateEnd,
								regionId: that.regionId,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								that.subject = return_result(result);
							});
						}
					},
					nextPage: function() {
						var that = this;
						if(that.pageNum < that.allPage - 1) {
							that.pageNum++;
							$.get(url + "verify/list", {
								bankDateStart: that.bankDateStart,
								bankDateEnd: that.bankDateEnd,
								regionId: that.regionId,
								pageNum: that.pageNum,
								pageSize: that.pageSize
							}, function(result) {
								that.subject = return_result(result);
							});
						}
					},
					lastPage: function() {
						var that = this;
						if(that.pageNum < that.allPage - 1) {
							$.get(url + "verify/list", {
								bankDateStart: that.bankDateStart,
								bankDateEnd: that.bankDateEnd,
								regionId: that.regionId,
								pageNum: that.allPage - 1,
								pageSize: that.pageSize
							}, function(result) {
								that.pageNum = that.allPage - 1;
								that.subject = return_result(result);
							});
						}
					},			
					table_edit: function (index,field,byid) {
						if (this.current_index != null)
						{
								this.subject[this.current_index] = this.current_row;
						}						
						v.update_field = field;
						v.update_byid = byid;
						this.current_index = index;
						this.current_row = this.subject[index];
						v.Id = this.subject[index].id;
						var json = {};
						json['oid'] = parseInt(this.subject[index].id);
						json['bankDate'] = this.subject[index].bankDate;
						json['userName'] = this.subject[index].userName;
						json['strIncome'] = this.subject[index].strIncome;
						json['money'] = this.subject[index].money;
						json['balance'] = this.subject[index].balance;
						json['adviserName'] = this.subject[index].adviserName;
						json['business'] = this.subject[index].business;
						json['comment'] = this.subject[index].comment;						
						if (field == 'orderId')
						{
								json['orderId'] = '<input type="text" class="form-control small" style="width:120px;" id="'+byid+'" value="'+(this.subject[index].orderId == null ? '': this.subject[index].orderId)+'">';
						}else
						{
								alert(this.subject[index].orderId);
								json['orderId'] = this.subject[index].orderId;
						}						
						this.subject.splice(index,1, json);															
					},		
					table_remove: function (index) {
             this.subject.splice(index, 1);  
          }
				}		
			});											
			
			function return_result(result)
			{				
				
				for(var i = 0; i < result.data.length; i++) {
						result.data[i].oid = result.data[i].id;
						result.data[i].userName = '';
						result.data[i].adviserName = '';
						result.data[i].bankDate = v.getTime1(result.data[i].bankDate);
						if (result.data[i].user != null) result.data[i].userName = result.data[i].user.name;			
						if (result.data[i].income)
						{
								result.data[i].strIncome = 'Amt rec\'d（收入）';
						}else
						{
								result.data[i].strIncome = 'Amt paid（支出）';
						}
						if (result.data[i].adviser != null) result.data[i].adviserName = result.data[i].adviser.name;
				};				
				return result.data;
			}
			
			$('#bankbill_list a.cancel').live('click', function (e) {
				e.preventDefault();
				v.subject.splice(v.current_index, 0);
				v.subject.splice(v.current_index,1, v.current_row);
			});
			
			$('#bankbill_list a.save').live('click', function (e) {
				e.preventDefault();
				table_editsave();
			});
			
			v.$watch('subject', function(obj) {
					$('.default-date-picker').datepicker({   				
				        format: 'dd/mm/yyyy'
				  });
				 	if (this.current_row.id)
				  {
				  		console.log(this.current_row);
				  		$("#id").val(this.current_row.id);	  		
				  }	
				  
				  //绑定区域列表
			    var obj_regionId = $("#regionId");
			    var obj_regionId1 = $("#regionId1");
			    $("#regionId").empty();
			    $("#regionId1").empty();
			    obj_regionId.append("<option value='0'>请选择</option>");
			    obj_regionId1.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'region/list_all',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	var region_data = response.data;
	        	for (var item in region_data)
	        	{
	        			obj_regionId.append("<option value='"+region_data[item].id+"'>"+region_data[item].name+"</option>");
	        			obj_regionId1.append("<option value='"+region_data[item].id+"'>"+region_data[item].name+"</option>");
	        			var region_sub = region_data[item].regionList;
	        			for (var itemsub in region_sub)
	        			{
	        					obj_regionId.append("<option value='"+region_sub[itemsub].id+"'>---"+region_sub[itemsub].name+"</option>");
	        					obj_regionId1.append("<option value='"+region_sub[itemsub].id+"'>---"+region_sub[itemsub].name+"</option>");
	        			}
	        	}
	        	obj_regionId.val('0');
	        	obj_regionId1.val(v.regionId);
	        });			      
			});
			
			function uploadFile()
			{
					$('#upload_id').modal('show');
					$('#upload_id #f2').val('');
					$('#upload_id #show_message').html('');
			}
			
			$('#upload_id #btnUpload').live('click', function (e) {
					var formData = new FormData();					
					formData.append("file",$("#f2")[0].files[0]);
					$('#upload_id #show_message').html('');
					if ($("#f2").val() == '' || $("#upload_id #regionId").val() == '0')
					{
							$('#upload_id #show_message').css("color","red");
			        $('#upload_id #show_message').html('文件 / 地区都必须选择，请确认。');
							return;
					}
					formData.append("regionId",$("#upload_id #regionId").val());
					show_loading();
					
					$.ajax({
			        url: url + 'verify/uploadexcel',
			        dataType:'json',
			        type:'POST',
			        async: false,
			        data: formData,
			        processData : false, //使数据不做处理
			        contentType : false,
			        success: function(data){
			        		$('#loading_id').modal('hide');			        		
			            if (data.code == '0')
			            {			            		
			            		if (data.message == '')
			            		{
			            				$('#upload_id #show_message').css("color","#78CD51");
			            				$('#upload_id #show_message').html('上传数据成功，请核对数据是否一致。');
			            		}else
			            		{
			            				$('#upload_id #show_message').css("color","red");
			            				$('#upload_id #show_message').html(data.message);
			            		}
			            }else
			            {
			            		$('#upload_id #show_message').html(data.message);
			            }	
			        },
			        error:function(response){
			            console.log(response);
			        }
			    });
			});
			
			function table_editsave()
			{
					var f = '#bankbill_list ';
					var check_result = 0;
					var str_val = $(f+'#'+v.update_byid).val();
					var field = v.update_field;
					
					if (str_val != '')
					{														
							check_result = true;							
					}else
					{
							$('#my_table #alert_error').css('marginLeft','40%');
			    		$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			        $("#my_table #error_info").html('提示：字段必须填写或选择！');
			    		return false;
					}
					if (check_result)
    			{    					
			    		var str_url = url + "verify/update";
       				var json = {};
       				json['id'] = v.Id;       				
       				json[v.update_field] = str_val;      				
       				show_loading();
       				$.post(str_url, json,
					   	function(data){
					   			$('#loading_id').modal('hide');
					   			if (data.code == 0)
					   			{
					   					$('#my_table #alert_success').css('marginLeft','40%');
					   					$('#my_table #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					if (field == 'orderId') v.current_row.orderId = str_val;
					   					v.subject.splice(v.current_index, 0);
											v.subject.splice(v.current_index,1, v.current_row);
					   					//重新载入数据源
					   					setTimeout(function(){v.getDatalist();$('.modal-backdrop').remove();}, 1000);
					   			}else
					   			{
					   					$('#my_table #alert_error').css('marginLeft','40%');
					   					$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#my_table #error_info").html(data.message);
				        			return false;
					   			}
					   	});
    			}
			}			
      
      function show_knowledge_detail(id,parentId)
      {
      		sessionStorage.setItem("id", id);
      		sessionStorage.setItem("menu_parentid", parentId);
					window.location.href = "knowledge.html"; 
      }
			
			function  formatDate(now)
			{
			    var   now= new Date(now);     
			    var   year=now.getFullYear();     
			    var   month=now.getMonth()+1;     
			    var   date=now.getDate();     
			    var   hour=now.getHours();
			    var   minute=now.getMinutes();     
			    var   second=now.getSeconds();
			    return fixZero(date,2)+"/"+fixZero(month,2)+"/"+year;
			}  
			
			function fixZero(num,length)
			{     
			    var str=""+num;
			    var len=str.length;     var s="";
			    for(var i=length;i-->len;)
			    {         
			        s+="0";
			    }
			    return s+str;
			}
			
			function show_loading()
			{
					$('#loading_id').on('show.bs.modal', function(){
	          var $this = $(this);
	          var $modal_dialog = $this.find('.modal-dialog');
	          $this.css('display', 'block');
	          $modal_dialog.css({'margin-top': Math.max(0, ($(window).height() - $modal_dialog.height()) / 2) });
	        });
					$('#loading_id').modal('show');
			}
			
	    jQuery(document).ready(function() {
	    });
		</script>
	</body>

</html>