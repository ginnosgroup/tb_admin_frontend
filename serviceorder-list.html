<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<meta http-equiv="Pragma" content="no-cache" />   
		<meta http-equiv="Cache-Control" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<link rel="shortcut icon" href="img/favicon.ico">
		<title>服务订单管理</title>
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet">
		<link href="assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-datepicker/css/datepicker.css"><!-- BOOTSTRAP DATEPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-timepicker/compiled/timepicker.css"><!-- BOOTSTRAP TIMEPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-colorpicker/css/colorpicker.css"><!-- BOOTSTRAP COLORPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="css/jquery.autocompleter.css">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link href="css/index.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body id="serviceorder-list" v-cloak>
		<section id="container">
			<header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-placement="right" class="fa fa-bars tooltips">
					</div>
				</div>
				<a href="main.html" class="logo">
					佣金系统
					<span v-if="ap_list==='KJ'">
           	 会计
          </span>
          <span v-if="ap_list==='GW'">
           	 顾问
          </span>
          <span v-if="ap_list==='WA'">
           	 文案
          </span>
          <span v-if="ap_list==='MA'">
           	 Mara
          </span>
          <span v-if="ap_list==='SUPERAD'">
           	 超级管理员
          </span>
				</a>
				<div class="top-nav ">
					<ul class="nav pull-right top-menu">
						<li style="padding-right:15px;"><a href="bank-info.html" style="color:white;">转账信息</a></li>
						<li style="padding-right:15px;"><a href="knowledge-detail.html?id=1000164" style="color:#ff6c60;">帮助中心</a></li>
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="username">
                  {{admin}}
                </span>
								<b class="caret">
                </b>
							</a>
							<ul class="dropdown-menu extended logout">
								<li class="log-arrow-up">
								</li>
								<li>
									<a href="password.html">
										<i class="fa fa-key">
                    </i> 修改密码
									</a>
								</li>
								<li><a href="javascript:tb.out();">
										<i class="fa fa-user">
                    </i> Log Out
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</header>
			<aside>
				<div id="sidebar" class="nav-collapse">
					<ul class="sidebar-menu" id="nav-accordion">
						<li >
              <a href="main.html">
                <i class="fa fa-dashboard">
                </i>
                <span>
                  Dashboard
                </span>
              </a>
            </li>
            <dli v-if="ap_list==='SUPERAD'">            
            <li>
              <a href="adviser.html">
                <i class="fa fa-book">
                </i>
                <span>
                  顾问管理
                </span>
              </a>
            </li>
            </dli>
            <dli v-if="ap_list==='SUPERAD' || (ap_list==='WA' && wa_admin === 'true')">
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 文案管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="official.html">
										文案管理
									</a>
								</li>
								<li>
									<a href="official-tag.html">
										订单标签管理
									</a>
								</li>								
							</ul>
						</li>
            </dli>
            <dli v-if="ap_list==='SUPERAD'">
            <li>
              <a href="mara.html">
                <i class="fa fa-book">
                </i>
                <span>
                  MARA管理
                </span>
              </a>
            </li>
            <li>
              <a href="accounting.html">
                <i class="fa fa-book">
                </i>
                <span>
                  会计管理
                </span>
              </a>
            </li>
            </dli>
          	<dli v-if="ap_list==='SUPERAD' || (ap_list==='GW' && gw_regionid !== 'null')">
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 学校管理
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="school.html">
										学校管理
									</a>
								</li>
								<li>
									<a href="school-setting.html">
										佣金设置
									</a>
								</li>								
							</ul>
						</li>
						</dli>
						<dli v-if="ap_list==='SUPERAD'">
            <li>
              <a href="receive-type.html">
                <i class="fa fa-book">
                </i>
                <span>
                  收款方式管理
                </span>
              </a>
            </li>
            <li>
              <a href="subagency.html">
                <i class="fa fa-book">
                </i>
                <span>
                  Subagency管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
            	<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 服务管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="service.html">
										服务项目管理
									</a>
								</li>
								<li>
									<a href="service-package.html">
										服务包管理
									</a>
								</li>
								<li>
									<a href="visa-ca.html">
										签证职业评估管理
									</a>
								</li>							
							</ul>              
            </li>
          	</dli>
          	<li v-if="ap_list!=='KJ' && ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 客户管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="users.html">
										客户管理
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="user-tags.html">
										标签管理
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='KJ'" class="sub-menu">
							<a v-if="ap_list==='WA'" href="javascript:;"  class="active">
								<i class="fa fa-book">
                </i>
								<span>
                 	 服务订单管理
                </span>
							</a>
							<ul v-if="ap_list==='WA'" class="sub">
								<li id="servicestateREVIEW">
									<a href="serviceorder-list.html?state=REVIEW">
										未审核
									</a>
								</li>
								<li id="servicestate">
									<a href="serviceorder-list.html?state=">
										所有订单
									</a>
								</li>								
							</ul>							
							<a v-if="ap_list!=='WA'" href="serviceorder-list.html"  class="active">
                <i class="fa fa-book">
                </i>
                <span>
                  服务订单管理
                </span>
              </a>
              <ul v-if="ap_list==='MA'" class="sub">
								<li id="servicestateMAWAIT">
									<a href="serviceorder-list.html?state=MAWAIT">
										未审核
									</a>
								</li>
								<li id="servicestateMAFINISH">
									<a href="serviceorder-list.html?state=MAFINISH">
										已审核
									</a>
								</li>								
							</ul>
						</li>
            <li v-if="ap_list==='SUPERAD'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 渠道管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="source.html">
										渠道列表
									</a>
								</li>
								<li>
									<a href="source-type.html">
										来源分类
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 佣金表
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'">
									<a href="mycommission.html">
										我的佣金报表
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_PENDING">
									<a href="mycommission.html?applyState=PENDING">
										未申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='GW' || ap_list==='SUPERAD'" style="display:;" id="apply_state_COMPLETE">
									<a href="mycommission.html?applyState=COMPLETE">
										已申请月奖
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_DJY">
									<a href="mycommission-accounting.html?commission_state=DJY">
										待结佣订单
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_YJY">
									<a href="mycommission-accounting.html?commission_state=YJY">
										已结佣订单
									</a>									
								</li>								
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="mycommission-check-accounting.html">
										自动对账
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="create-visa-commission.html">
										重建签证佣金表订单
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="table-export.html">
										导出数据
									</a>
								</li>
							</ul>
						</li>
						<li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 知识库
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="knowledge-menu.html">
										菜单管理
									</a>
								</li>
								<li>
									<a href="knowledge.html">
										知识库菜单
									</a>
								</li>
								<li>
									<a href="http://question.zhinanzhen.org/api/users/znz/{{admin}}" target="_blank">
										指南针问答
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</aside>
			<section id="main-content" class="content">
				<section class="wrapper site-min-height">
					<div class="row">
						<div class="col-lg-12">
							<section class="panel">
								<header class="panel-heading">
									服务订单管理
								</header>
								<div class="panel-body">
									<div class="adv-table editable-table">
										<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
									      <button data-dismiss="alert" class="close close-sm" type="button">
									      </button>
									      <strong>Success!</strong> You  just achieved success.
									  </div>
									  <div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
                      <button data-dismiss="alert" class="close close-sm" type="button">                      
                      </button>
                      <strong id="error_info"></strong>
                    </div>
									  <form class="form-inline" style="margin-top:10px;">
									  	<input v-model.trim="userId" type="hidden" name="userId" id="userId" value="0" />
											<div class="form-group">
													<label>订单ID</label>
													<input v-model.trim="id" id="id" type="text" class="form-control" style="width:130px;" placeholder="请输入纯数字">
													<label>客户姓名</label>
													<input type="text" name="user_name" id="user_name" class="form-control" style="width:150px;">	
													<!--											
													<label>手机号码</label>
													<input v-model.trim="phone" type="text" class="form-control" style="width:130px;" placeholder="请输入手机号码">
													<label>客户微信号</label>
													<input v-model.trim="wechatUsername" type="text" class="form-control" style="width:130px;" placeholder="输入客户微信号">
													-->
													<dle v-if="gw_regionid !== 'null'">
													<label>顾问</label>
													<select v-model.trim="adviserId" id="adviserId" class="form-control" style="width:130px;">
													</select>
													</dle>
													<dle v-if="(ap_list!=='KJ' && ap_list!=='WA') || (ap_list==='WA' && wa_admin === 'true')">
													<label>文案</label>											
													<select v-model.trim="officialId" id="officialId" class="form-control" style="width:130px;">
													</select>
													</dle>
													<dle v-if="ap_list!=='KJ' && ap_list!=='MA'">
													<label>Mara</label>											
													<select v-model.trim="maraId" id="maraId" class="form-control" style="width:130px;">
													<option value="" selected="true">请选择</option>
													</select>
													</dle>
													<dle v-if="ap_list==='GW' || ap_list==='WA'">
													<input v-model.trim="startOfficialApprovalDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:150px;" placeholder="文案审核时间(开始)">
													<input v-model.trim="endOfficialApprovalDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:150px;" placeholder="文案审核时间(结束)">
													</dle>
													<dle v-if="ap_list==='WA'">
													<input v-model.trim="startReadcommittedDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:150px;" placeholder="提交申请时间(开始)">
													<input v-model.trim="endReadcommittedDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:150px;" placeholder="提交申请时间(结束)">
													</dle>																																				
											</div>
											<div class="form-group">													
													<label>服务项目</label>											
													<select v-model.trim="type" id="type" class="form-control" style="width:130px;">
													<option value="" selected="true">请选择</option>
													<option value="VISA">签证</option>
													<option value="OVST">留学</option>
													<option value="SIV">独立技术移民</option>
													</select>													
													<dle v-if="ap_list!=='GW'">
													<label>选择地区</label>
													<select v-model.trim="regionId" id="regionId" class="form-control" style="width:130px;">
													</select>
													</dle>
													<label>状态</label>											
													<select v-model.trim="state" id="state" class="form-control" style="width:130px;">
													<option value="" selected="true">全部</option>
													<option value="PENDING">待提交审核</option>
													<option value="REVIEW">审核中</option>
													<option value="FINISH">审核完毕</option>
													<option value="APPLY">服务申请中</option>
													<option value="COMPLETE">申请成功</option>													
													<option value="PAID">COE支付成功</option>
													<option value="CLOSE">已关闭申请</option>
													</select>
													<label v-if="ap_list==='WA'">标签</label>
													<select v-if="ap_list==='WA'" v-model.trim="officialTagId" id="officialTagId" class="form-control" style="width:130px;">
													</select>																								
											</div>
											<div class="form-group">
												<button @click="getSearch" id="btnSearch" type="button" class="btn btn-info">查询</button>
												<button @click="getExport" type="button" class="btn btn-primary" style="display:none;">导出</button>
												<button v-if="ap_list==='WA' && wa_admin === 'true'" @click="getWaExport" type="button" class="btn btn-primary">导出</button>
											</div>
										</form>
										<div class="responsive-table margin-top">
											<input type="hidden" name="id" id="id" value="0" />
											<div id="copy_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">已复制！请告知客户转账时务必在备注填写该订单号码。</div>
											<table class="display table table-bordered table-striped" id="order_list">
												<thead>
													<tr>
														<th>ID</th>
														<th><dle v-if="ap_list!=='WA'">创建日期</dle><dle else>提交申请日期</dle></th>
														<th>提交审核时间</th>
														<th>办理完成日期</th>
														<th>客户ID</th>
														<th>客户姓名</th>
														<th>生日</th>
														<th>手机号码</th>
														<th>所属顾问</th>
														<th>MARA</th>
														<th>文案</th>
														<th>服务项目</th>
														<th>状态</th>
														<th v-if="ap_list==='WA'">标签</th>
														<th v-if="ap_list==='WA'">计数</th>
														<th>操作</th>
														<th>备注</th>
													</tr>
												</thead>
												<tbody>
													<tr v-for="item in subject" class="gradeX">
														<td v-html="item.oid"></td>
														<td v-if="ap_list!=='WA'" v-html="item.gmtCreate"></td>
														<td v-if="ap_list==='WA'" @dblclick="table_edit($index,'gmtCreate','t3')"><span v-html="item.gmtCreate"></span></td>
														<td v-html="item.approvalDate"></td>
														<td v-html="item.finishDate"></td>
														<td v-html="item.userId"></td>
														<td v-html="item.userName"></td>
														<td v-html="item.birthday"></td>
														<td v-html="item.phone"></td>
														<td v-html="item.adviserName"></td>
														<td v-html="item.maraName"></td>
														<td @dblclick="table_edit($index,'officialName','t1')"><span v-html="item.officialName"></span></td>
														<td v-html="item.serviceName"></td>
														<td v-html="item.strState"></td>
														<td v-if="ap_list==='WA'">
																<div v-if="!item.tagId"><a href="javascript:show_tagbox({{item.id}},'{{item.tagId}}');">设置标签</a></div>
																<div v-if="item.tagId" onclick="show_tagbox({{item.id}},'{{item.tagId}}')"><label style="width:80px;color:white;background:{{item.tagColour}};">{{item.tagText}}</label></div>
														</td>
														<td v-if="ap_list==='WA'" @dblclick="table_edit($index,'realPeopleNumber','tnumber')"><span v-html="item.realPeopleNumber"></span></td>
														<td>
																<dle v-if="ap_list==='GW' && item.adviserId !== current_adviserId">													
																		<a href="javascript:show_addnewservice_id({{item.id}},'{{item.type}}');">查看</a>
																</dle>
																<dle v-else>
																		<a href="javascript:open_detail({{item.id}},'{{item.type}}','{{item.currentState}}');">查看</a>
																</dle>												
																<dle v-if="ap_list==='GW'">
																		<d2 v-if="item.type==='SIV' && !item.parentId">																				
																				<d1 v-if="!item.submitted && item.pay && item.adviserId === current_adviserId">
																				<button onclick="show_confirmbox('{{item.type}}',{{item.id}},'REVIEW',1)" type="button" class="btn btn-success" style="">提交佣金表</button>
																				</d1>
																		</d2>
																		<d2 v-if="item.type!=='SIV'">
																				<d1 v-if="item.currentState==='PENDING' && item.adviserId === current_adviserId">
																				<button onclick="show_confirmbox('{{item.type}}',{{item.id}},'REVIEW',1)" type="button" class="btn btn-danger">提交审核</button>
																				</d1>
																		</d2>
																		<d2 v-if="item.type!=='SIV'">
																				<d1 v-if="item.currentState==='REVIEW' && item.adviserId === current_adviserId">
																				<a href="javascript:show_confirmbox('{{item.type}}',{{item.id}},'PENDING',1)" style="color:#ACA9A9;">撤回</a>
																				</d1>
																		</d2>
																</dle>	
																<dle v-if="ap_list==='WA'">																		
																		<d1 v-if="item.type==='VISA'">																				
																				<d1 v-if="item.currentState==='WA_MA_WAIT'">
																				<a href="javascript:show_confirmbox('{{item.type}}',{{item.id}},'REVIEW',1)" style="color:#ACA9A9;">撤回</a>
																				</d1>
																		</d1>																		
																</dle>
																<dle v-if="ap_list==='MA'">																		
																		<d1 v-if="item.review.officialState==='WAIT' && item.review.maraState==='WAIT'">
																		<a href="javascript:show_confirmbox('{{item.type}}',{{item.id}},'FINISH',1)">通过</a>
																		<a href="javascript:show_confirmbox('{{item.type}}',{{item.id}},'REVIEW',0)">驳回</a>
																		</d1>																		
																</dle>
																<dle v-if="ap_list!=='KJ' && ap_list!=='GW' && ap_list!=='WA' && ap_list!=='MA'">
																		<a v-if="item.id" class="delete" href="#" @click="delete_confirm($index,item.id)">删除</a>
																</dle>
														</td>
														<td v-html="item.strRemarks"></td>
													</tr>													
												</tbody>
											</table>
										</div>
										<div class="row-fluid" style="display:;">
											<div class="span6">
												<div class="dataTables_info" id="hidden-table-info_info">共{{count}}条</div>
											</div>
											<div class="span6">
												<div class="dataTables_paginate paging_bootstrap pagination">
													<ul>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="firstPage" href="javascript:;">首页</a>
														</li>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="prevPage" href="javascript:;">← Pre</a>
														</li>
														<li class="nowPage" style="padding: 0px 0px;margin: 0 1px;">
															第{{pageNum+1}}页/共{{allPage}}页&nbsp;
															跳到 <input type="text" v-model.trim="pnumber" @keyup.enter="submit" style="width:50px;color:#c7c7c7;border: 1px solid #ddd;border-radius: 3px;-webkit-border-radius: 3px;padding: 5px 10px;display: inline-block;" id="b100" placeholder="" value=""> 页
														</li>														
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="nextPage" href="javascript:;">Next → </a>
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="lastPage" href="javascript:;">末页</a>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
							</section>
						</div>
					</div>
				</section>
			</section>
			<footer class="site-footer">
				<div class="text-center">
					2018 &copy; 佣金系统 by <span style="color:#2a8ba7;">GIG</span>.
					<a href="#" class="go-top">
						<i class="fa fa-angle-up">
            </i>
					</a>
				</div>
			</footer>
		</section>
		<div class="modal fade" id="showconfirmbox_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="z-index:9999;">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">操作提示</h4>
					</div>
					<div class="modal-body">
						您确认执行此操作吗？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="update_state();" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="loading_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static' style="z-index:99999;">
			<div class="modal-dialog" role="document" style="width:350px;">
				<div class="modal-content">
					<div class="modal-header">
					</div>
					<div class="modal-body">
							<div style="text-align:center;color:#0066CC;"><img src="img/input-spinner.gif" /> 正在执行，请稍后...</div>
					</div>
					
				</div>
			</div>
		</div>
		<div class="modal fade" id="delete_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">删除</h4>
					</div>
					<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
			      <button data-dismiss="alert" class="close close-sm" type="button">
			      <i class="fa fa-times"></i>
			      </button>
			      <strong id="success_info">Success! You  just achieved success.</strong>
			  	</div>
			  	<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
		        <button data-dismiss="alert" class="close close-sm" type="button">
		        <i class="fa fa-times"></i>
		        </button>
		        <strong id="error_info"></strong>
		      </div>
					<div class="modal-body">
						[订单ID：<span id="order_id" style="font-weight:bold;"></span> 将被删除]&nbsp;&nbsp;执行后不可撤销操作，请慎重！！！&nbsp;&nbsp;<span style="color:red;">确认删除吗？</span>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="deleteId()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="wa_tagbox" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" style="z-index:999999;">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								<h4 class="modal-title" id="myModalLabel">设置订单标签</h4>
							</div>
							<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
					      <button data-dismiss="alert" class="close close-sm" type="button">
					      <i class="fa fa-times"></i>
					      </button>
					      <strong>Success!</strong> You  just achieved success.
					  	</div>
					  	<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
				        <button data-dismiss="alert" class="close close-sm" type="button">
				        <i class="fa fa-times"></i>
				        </button>
				        <strong id="error_info"></strong>
				      </div>
							<div class="modal-body">
									<form class="form-horizontal">
									<div class="form-group">
										<label class="col-sm-2 control-label">选择标签<span style="color:red;">*</span></label>
										<div class="col-sm-8">
											<select class="form-control" style="background: #F0FFFF;color:#428bca;" name="tag_id" id="tag_id"></select>
										</div>
									</div>
									<div class="form-group" id="del_tag" style="display:none;">
										<label class="col-sm-2 control-label">&nbsp;</label>
										<div class="col-sm-8">
												<button onclick="delWaTag()" type="button" class="btn btn-danger">清除当前设置</button>
										</div>
									</div>									
									</form>
							</div>
							<div class="modal-footer">
								<button onclick="setWaTag()" type="button" class="btn btn-primary">确认</button>
								<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>								
							</div>
						</div>
					</div>
		</div>
		<div id="load-user-common-page"></div>
		<div id="load-user-common-view-page"></div>
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.dcjqaccordion.2.7.js"></script>
		<script src="js/jquery.scrollTo.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>
		<script src="assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script><!-- BOOTSTRAP DATEPICKER JS  -->
    <script src="assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script><!-- BOOTSTRAP DATETIMEPICKER JS  -->
    <script src="assets/bootstrap-colorpicker/js/bootstrap-colorpicker.js"> </script><!-- BOOTSTRAP COLORPICKER JS  -->
    <script src="js/jquery.autocompleter.js"></script>
    <script src="js/jquery.validate.min.js"></script><!-- VALIDATE JS  -->
		<script src="js/clipboard.min.js"></script>
		<script src="js/common-scripts.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/common.js?verson=1"></script>
		<script>
			$("#load-user-common-page").load("user-common.html?random="+Math.random());
			$("#load-user-common-view-page").load("user-common-view.html?random="+Math.random());
			tb.isLogin("serviceorder-list.html");
			$("td,th").addClass("text-center");
			var v = new Vue({
				el: '#serviceorder-list',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),
					gw_regionid: sessionStorage.getItem("gw_regionid"),
					adviser_id: sessionStorage.getItem("adviser_id"),
					official_id: sessionStorage.getItem("official_id"),
					mara_id: sessionStorage.getItem("mara_id"),
					current_adviserId: parseInt(sessionStorage.getItem("adviser_id")),
					wa_admin: sessionStorage.getItem("wa_admin"),
					auditingState : getRequest('state'),
					addnewservice1_bind: 0,
					addnewservice2_bind: 0,
					addnewservice3_bind: 0,					
					orderId: 0,
					orderType: '',
					servicepackage_type: '',
					result_data: '',
					subject: [],
					count: 0,
					dId: '',
					eId: '',
					tagId: 0,
					name: '',
					sort: '',
					state: '',
					update_field: '',					
					update_byid: '',
					isNotApproved: false,
					flowstate_gw: '',
					flowstate_wa: '',
					flowstate_ma: '',
					set_state: '',
					set_type: 1,
					pageNum: 0,
					pageSize: 20,
					allPage: 0,
					add: false,
					current_index: '',
					current_row: '',
					index: 0,
					close: false
				},
				created: function() {					
					if (typeof(this.auditingState) == "undefined") $("#servicestate").addClass("active");							
					this.getDatalist();
					document.onkeydown = function(e) {
						var key = window.event.keyCode;
						if (key == 13) v.gotoPage();
					};
				},				
				methods: {				
					getSearch: function() {
						var that = this;
						that.pageNum = 0;
						that.pnumber = null;
						that.getDatalist();
					},
					getDatalist: function() {
						var that = this;
						var json = {};
						show_loading();
						json['isNotApproved'] = false;
						if (that.auditingState == 'REVIEW') json['isNotApproved'] = true;
						if (that.auditingState != '') json['auditingState'] = that.auditingState;
						if (that.id != '') json['id'] = that.id;
						if (that.userId != '0') json['userId'] = that.userId;
						if (this.gw_regionid != 'null')
						{
								if (this.adviserId == undefined)
								{
										json['adviserId'] = this.adviser_id;
								}else
								{
										if (that.adviserId != '0') json['adviserId'] = that.adviserId;
								}
						}else
						{
								if (that.adviserId != '0') json['adviserId'] = that.adviserId;
						}
						if (this.ap_list == 'WA' && this.wa_admin == 'true')
						{
								if (this.officialId == undefined)
								{
										json['officialId'] = this.official_id;
								}else
								{
										if (that.officialId != '0') json['officialId'] = that.officialId;
								}
						}else
						{
								if (that.officialId != '0') json['officialId'] = that.officialId;	
						}					
						if (that.maraId != '') json['maraId'] = that.maraId;
						if (that.type != '') json['type'] = that.type;
						if (that.state != '') json['state'] = that.state;
						if (that.startOfficialApprovalDate != '') json['startOfficialApprovalDate'] = that.startOfficialApprovalDate;
						if (that.endOfficialApprovalDate != '') json['endOfficialApprovalDate'] = that.endOfficialApprovalDate;
						if (that.startReadcommittedDate != '') json['startReadcommittedDate'] = that.startReadcommittedDate;
						if (that.endReadcommittedDate != '') json['endReadcommittedDate'] = that.endReadcommittedDate;
						if (that.startMaraApprovalDate != '') json['startMaraApprovalDate'] = that.startMaraApprovalDate;
						if (that.endMaraApprovalDate != '') json['endMaraApprovalDate'] = that.endMaraApprovalDate;
						if (that.ap_list != 'GW' && that.regionId != '') json['regionId'] = that.regionId;
						if (this.ap_list == 'WA') json['officialTagId'] = that.officialTagId;
						$.get(url + "serviceOrder/count", json, function(result) {
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
						});
						json['pageNum'] = that.pageNum;
						json['pageSize'] = that.pageSize;
						$.get(url + "serviceOrder/list", json, function(result) {
							result.data = return_result(result);
							that.subject = result.data;
							that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
							$('#loading_id').modal('hide');
						});
					},					
					getWaExport: function() {
						var that = this;
						var json = {};
						show_loading();
						var down_url = url + "serviceOrder/down?";
						json['isNotApproved'] = false;
						if (that.auditingState == 'REVIEW') json['isNotApproved'] = true;
						if (that.auditingState != '') json['auditingState'] = that.auditingState;
						if (that.id != '') json['id'] = that.id;
						if (that.userId != '0') json['userId'] = that.userId;
						if (this.gw_regionid != 'null')
						{
								if (this.adviserId == undefined)
								{
										json['adviserId'] = this.adviser_id;
								}else
								{
										if (that.adviserId != '0') json['adviserId'] = that.adviserId;
								}
						}else
						{
								if (that.adviserId != '0') json['adviserId'] = that.adviserId;
						}
						if (this.ap_list == 'WA' && this.wa_admin == 'true')
						{
								if (this.officialId == undefined)
								{
										json['officialId'] = this.official_id;
								}else
								{
										if (that.officialId != '0') json['officialId'] = that.officialId;
								}
						}else
						{
								if (that.officialId != '0') json['officialId'] = that.officialId;	
						}					
						if (that.maraId != '') json['maraId'] = that.maraId;
						if (that.type != '') json['type'] = that.type;
						if (that.state != '') json['state'] = that.state;
						if (that.startOfficialApprovalDate != '') json['startOfficialApprovalDate'] = that.startOfficialApprovalDate;
						if (that.endOfficialApprovalDate != '') json['endOfficialApprovalDate'] = that.endOfficialApprovalDate;
						if (that.startReadcommittedDate != '') json['startReadcommittedDate'] = that.startReadcommittedDate;
						if (that.endReadcommittedDate != '') json['endReadcommittedDate'] = that.endReadcommittedDate;
						if (that.startMaraApprovalDate != '') json['startMaraApprovalDate'] = that.startMaraApprovalDate;
						if (that.endMaraApprovalDate != '') json['endMaraApprovalDate'] = that.endMaraApprovalDate;
						if (that.ap_list != 'GW' && that.regionId != '') json['regionId'] = that.regionId;
						if (this.ap_list == 'WA') json['officialTagId'] = that.officialTagId;
						//生成url
						var str_url = '';						
						for(var key in json)
						{
								if (json[key] == undefined) json[key]= '';
								if (str_url == '')
								{
										str_url = key+'='+json[key];
								}else
								{
										str_url += '&'+key+'='+json[key];
								}
						}						
						var a = document.createElement('a');
						a.download = 'serviceOrder_data.xls';
						a.href = down_url+str_url;
						$("body").append(a);
						a.click();
						$(a).remove();
						setTimeout(function(){$('#loading_id').modal('hide');}, 3000);
					},
					getTime: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y;
						return date2;
					},
					getTime1: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y+' '+h+':'+m2+':'+s;
						return date2;
					},
					addZero: function(obj) {
						if(obj < 10) {
							obj = '0' + obj;
						};
						return obj;
					},
					firstPage: function() {
						var that = this;
						var json = {};
						json['isNotApproved'] = false;
						if (that.auditingState == 'REVIEW') json['isNotApproved'] = true;
						if (that.auditingState != '') json['auditingState'] = that.auditingState;
						if (that.id != '') json['id'] = that.id;
						if (that.userId != '0') json['userId'] = that.userId;
						if (that.adviserId != '0') json['adviserId'] = that.adviserId;
						if (that.officialId != '0') json['officialId'] = that.officialId;
						if (that.maraId != '') json['maraId'] = that.maraId;
						if (that.type != '') json['type'] = that.type;
						if (that.state != '') json['state'] = that.state;
						if (that.startOfficialApprovalDate != '') json['startOfficialApprovalDate'] = that.startOfficialApprovalDate;
						if (that.endOfficialApprovalDate != '') json['endOfficialApprovalDate'] = that.endOfficialApprovalDate;
						if (that.startReadcommittedDate != '') json['startReadcommittedDate'] = that.startReadcommittedDate;
						if (that.endReadcommittedDate != '') json['endReadcommittedDate'] = that.endReadcommittedDate;
						if (that.startMaraApprovalDate != '') json['startMaraApprovalDate'] = that.startMaraApprovalDate;
						if (that.endMaraApprovalDate != '') json['endMaraApprovalDate'] = that.endMaraApprovalDate;
						if (that.ap_list != 'GW' && that.regionId != '') json['regionId'] = that.regionId;
						
						if(that.pageNum > 0) {
							show_loading();
							json['pageNum'] = 0;
							json['pageSize'] = that.pageSize;
							$.get(url + "serviceOrder/list", json, function(result) {
								console.log(result)
								that.pageNum = 0;
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					prevPage: function() {
						var that = this;						
						var json = {};
						json['isNotApproved'] = false;
						if (that.auditingState == 'REVIEW') json['isNotApproved'] = true;
						if (that.auditingState != '') json['auditingState'] = that.auditingState;
						if (that.id != '') json['id'] = that.id;
						if (that.userId != '0') json['userId'] = that.userId;
						if (that.adviserId != '0') json['adviserId'] = that.adviserId;
						if (that.officialId != '0') json['officialId'] = that.officialId;
						if (that.maraId != '') json['maraId'] = that.maraId;
						if (that.type != '') json['type'] = that.type;
						if (that.state != '') json['state'] = that.state;
						if (that.startOfficialApprovalDate != '') json['startOfficialApprovalDate'] = that.startOfficialApprovalDate;
						if (that.endOfficialApprovalDate != '') json['endOfficialApprovalDate'] = that.endOfficialApprovalDate;
						if (that.startReadcommittedDate != '') json['startReadcommittedDate'] = that.startReadcommittedDate;
						if (that.endReadcommittedDate != '') json['endReadcommittedDate'] = that.endReadcommittedDate;
						if (that.startMaraApprovalDate != '') json['startMaraApprovalDate'] = that.startMaraApprovalDate;
						if (that.endMaraApprovalDate != '') json['endMaraApprovalDate'] = that.endMaraApprovalDate;
						if (that.ap_list != 'GW' && that.regionId != '') json['regionId'] = that.regionId;
						
						if(that.pageNum > 0) {
							show_loading();
							that.pageNum--;
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;
							$.get(url + "serviceOrder/list", json, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					nextPage: function() {
						var that = this;						
						var json = {};
						json['isNotApproved'] = false;
						if (that.auditingState == 'REVIEW') json['isNotApproved'] = true;
						if (that.auditingState != '') json['auditingState'] = that.auditingState;
						if (that.id != '') json['id'] = that.id;
						if (that.userId != '0') json['userId'] = that.userId;
						if (that.adviserId != '0') json['adviserId'] = that.adviserId;
						if (that.officialId != '0') json['officialId'] = that.officialId;
						if (that.maraId != '') json['maraId'] = that.maraId;
						if (that.type != '') json['type'] = that.type;
						if (that.state != '') json['state'] = that.state;
						if (that.startOfficialApprovalDate != '') json['startOfficialApprovalDate'] = that.startOfficialApprovalDate;
						if (that.endOfficialApprovalDate != '') json['endOfficialApprovalDate'] = that.endOfficialApprovalDate;
						if (that.startReadcommittedDate != '') json['startReadcommittedDate'] = that.startReadcommittedDate;
						if (that.endReadcommittedDate != '') json['endReadcommittedDate'] = that.endReadcommittedDate;
						if (that.startMaraApprovalDate != '') json['startMaraApprovalDate'] = that.startMaraApprovalDate;
						if (that.endMaraApprovalDate != '') json['endMaraApprovalDate'] = that.endMaraApprovalDate;
						if (that.ap_list != 'GW' && that.regionId != '') json['regionId'] = that.regionId;
						
						if(that.pageNum < that.allPage - 1) {
							show_loading();
							that.pageNum++;
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;
							$.get(url + "serviceOrder/list", json, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					lastPage: function() {
						var that = this;
						var json = {};
						json['isNotApproved'] = false;
						if (that.auditingState == 'REVIEW') json['isNotApproved'] = true;
						if (that.auditingState != '') json['auditingState'] = that.auditingState;
						if (that.id != '') json['id'] = that.id;
						if (that.userId != '0') json['userId'] = that.userId;
						if (that.adviserId != '0') json['adviserId'] = that.adviserId;
						if (that.officialId != '0') json['officialId'] = that.officialId;
						if (that.maraId != '') json['maraId'] = that.maraId;
						if (that.type != '') json['type'] = that.type;
						if (that.state != '') json['state'] = that.state;
						if (that.startOfficialApprovalDate != '') json['startOfficialApprovalDate'] = that.startOfficialApprovalDate;
						if (that.endOfficialApprovalDate != '') json['endOfficialApprovalDate'] = that.endOfficialApprovalDate;
						if (that.startReadcommittedDate != '') json['startReadcommittedDate'] = that.startReadcommittedDate;
						if (that.endReadcommittedDate != '') json['endReadcommittedDate'] = that.endReadcommittedDate;
						if (that.startMaraApprovalDate != '') json['startMaraApprovalDate'] = that.startMaraApprovalDate;
						if (that.endMaraApprovalDate != '') json['endMaraApprovalDate'] = that.endMaraApprovalDate;
						if (that.ap_list != 'GW' && that.regionId != '') json['regionId'] = that.regionId;
						
						if(that.pageNum < that.allPage - 1) {
							show_loading();
							json['pageNum'] = that.allPage-1;
							json['pageSize'] = that.pageSize;
							$.get(url + "serviceOrder/list", json, function(result) {
								console.log(result)
								that.pageNum = that.allPage-1;
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					gotoPage: function() {
						var that = this;
						var json = {};
						json['isNotApproved'] = false;
						if (that.auditingState == 'REVIEW') json['isNotApproved'] = true;
						if (that.auditingState != '') json['auditingState'] = that.auditingState;
						if (that.id != '') json['id'] = that.id;
						if (that.userId != '0') json['userId'] = that.userId;
						if (that.adviserId != '0') json['adviserId'] = that.adviserId;
						if (that.officialId != '0') json['officialId'] = that.officialId;
						if (that.maraId != '') json['maraId'] = that.maraId;
						if (that.type != '') json['type'] = that.type;
						if (that.state != '') json['state'] = that.state;
						if (that.startOfficialApprovalDate != '') json['startOfficialApprovalDate'] = that.startOfficialApprovalDate;
						if (that.endOfficialApprovalDate != '') json['endOfficialApprovalDate'] = that.endOfficialApprovalDate;
						if (that.startReadcommittedDate != '') json['startReadcommittedDate'] = that.startReadcommittedDate;
						if (that.endReadcommittedDate != '') json['endReadcommittedDate'] = that.endReadcommittedDate;
						if (that.startMaraApprovalDate != '') json['startMaraApprovalDate'] = that.startMaraApprovalDate;
						if (that.endMaraApprovalDate != '') json['endMaraApprovalDate'] = that.endMaraApprovalDate;
						if (that.ap_list != 'GW' && that.regionId != '') json['regionId'] = that.regionId;
						that.pageNum = parseInt(that.pnumber);
						if (that.pageNum > that.allPage)
						{
								that.pnumber = that.allPage;
								that.pageNum = that.allPage;
						}
						
						if(that.pageNum <= that.allPage) {
							show_loading();
							that.pageNum = that.pageNum - 1;
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;
							$.get(url + "serviceOrder/list", json, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
          delete_confirm: function (index,id) {
          	$('#delete_id #order_id').html(id);
          	$('#delete_id').modal('show');
          	this.dId = id;
          	this.index = index;
          },
					table_remove: function (index) {
             this.subject.splice(index, 1);  
          },						
					table_edit: function (index,field,byid) {
						if (this.ap_list == 'WA' || (this.ap_list == 'GW' && this.gw_regionid != ''))
						{				
								if (this.current_index != null)
								{
										this.subject[this.current_index] = this.current_row;
								}						
								v.update_field = field;
								v.update_byid = byid;
								this.current_index = index;
								this.current_row = this.subject[index];
								v.dId = this.subject[index].id;
								var json = {};
								json['oid'] = this.subject[index].oid;
								if (field == 'gmtCreate' && this.ap_list == 'WA' && this.wa_admin == 'true')
								{
										json['gmtCreate'] = '<input type="text" class="form-control  default-date-picker" style="width:110px;" id="'+byid+'" value="'+this.subject[index].gmtCreate+'" style="background: #F0FFFF;color: #428bca;"><div style="padding-top:10px;"><a class="save1" href="javascript:;"><span style="color:blue;">保存</span></a>&nbsp;&nbsp;<a class="cancel" href="javascript:;">取消</a></div>';
								}else
								{
										json['gmtCreate'] = this.subject[index].gmtCreate;	
								}								
								json['approvalDate'] = v.getTime(this.subject[index].officialApprovalDate);
								json['finishDate'] = this.subject[index].finishDate;
								json['userId'] = this.subject[index].userId;
								json['userName'] = this.subject[index].userName;
								json['birthday'] = this.subject[index].birthday;
								json['phone'] = this.subject[index].phone;
								json['adviserName'] = this.subject[index].adviserName;
								json['maraName'] = this.subject[index].maraName;
								json['serviceName'] = this.subject[index].serviceName;
								json['strState'] = this.subject[index].strState;
								if (field == 'adviserName' && this.ap_list == 'GW' && this.gw_regionid != '')
								{
										json['adviserName'] = '<select class="form-control" style="width:120px;" id="'+byid+'" style="background: #F0FFFF;color: #428bca;"></select><div style="padding-top:10px;"><a class="save1" href="javascript:;"><span style="color:blue;">保存</span></a>&nbsp;&nbsp;<a class="cancel" href="javascript:;">取消</a></div>';
								}else
								{
										json['adviserName'] = this.subject[index].adviserName;
								}
								if (field == 'officialName' && this.ap_list == 'WA' && this.wa_admin == 'true')
								{
										json['officialName'] = '<select class="form-control" style="width:120px;" id="'+byid+'" style="background: #F0FFFF;color: #428bca;"></select><div style="padding-top:10px;"><a class="save1" href="javascript:;"><span style="color:blue;">保存</span></a>&nbsp;&nbsp;<a class="cancel" href="javascript:;">取消</a></div>';
								}else
								{
										json['officialName'] = this.subject[index].officialName;
								}
								if (field == 'realPeopleNumber' && this.ap_list == 'WA')
								{
										json['realPeopleNumber'] = '<input type="text" class="form-control" style="width:70px;" id="'+byid+'" value="'+this.subject[index].realPeopleNumber+'" style="background: #F0FFFF;color: #428bca;"><div style="padding-top:10px;"><a class="save1" href="javascript:;"><span style="color:blue;">保存</span></a>&nbsp;&nbsp;<a class="cancel" href="javascript:;">取消</a></div>';
								}else
								{
										json['realPeopleNumber'] = this.subject[index].realPeopleNumber;
								}					
								this.subject.splice(index,1, json);
						}														
					},          
				}		
			});
			
			function return_result(result)
			{				
				for(var i = 0; i < result.data.length; i++) {
						var str_state = '';
						var str_refusestate = '';
						var customer_text = '';
						switch(result.data[i].type)
						{
								case 'VISA':
										if (result.data[i].parentId)
										{
												customer_text = 'V'+result.data[i].id+'-'+result.data[i].servicePackage.num+'<br/><a onclick="copyText()" class="copybtn" data-clipboard-action="copy" data-clipboard-text="V'+result.data[i].id+'">复制</a>';
										}else
										{
												customer_text = 'V'+result.data[i].id+'<br/><a onclick="copyText()" class="copybtn" data-clipboard-action="copy" data-clipboard-text="V'+result.data[i].id+'">复制</a>';
										}
								break;
								case 'OVST':
										customer_text = result.data[i].id;
										if (result.data[i].settle)
										{
												customer_text = 'S'+result.data[i].id+'<br/><a onclick="copyText()" class="copybtn" data-clipboard-action="copy" data-clipboard-text="S'+result.data[i].id+'">复制</a>';
										}
								break;
								case 'SIV':
										customer_text = result.data[i].id;
								break;
						}
						result.data[i].oid = customer_text;
						result.data[i].strRefuse = '';						
						result.data[i].gmtCreate = v.getTime(result.data[i].gmtCreate);
						switch(v.ap_list)
						{
								case 'GW':
										result.data[i].approvalDate = result.data[i].officialApprovalDate ? v.getTime(result.data[i].officialApprovalDate):'';										
								break;
								case 'WA':
										result.data[i].approvalDate = result.data[i].officialApprovalDate ? v.getTime(result.data[i].officialApprovalDate):'';
										result.data[i].gmtCreate = result.data[i].readcommittedDate ? v.getTime(result.data[i].readcommittedDate):'';
								break;
								case 'MA':
										result.data[i].approvalDate = result.data[i].maraApprovalDate ? v.getTime(result.data[i].maraApprovalDate):'';
								break;
								default:
										result.data[i].approvalDate = '';
								break;
						}
						result.data[i].finishDate = result.data[i].finishDate ? v.getTime(result.data[i].finishDate):'';
						result.data[i].userName = result.data[i].user.name;
						if (result.data[i].user.birthday) result.data[i].birthday = v.getTime(result.data[i].user.birthday);
						result.data[i].phone = result.data[i].user.phone;
						result.data[i].adviserName = result.data[i].adviser.name;
						result.data[i].officialName = (result.data[i].officialId ? result.data[i].official.name : '');
						if (result.data[i].review.adviserState != null) str_state = result.data[i].review.adviserState;
						if (result.data[i].review.officialState == 'REVIEW')
						{
								if (result.data[i].review.maraState == 'FINISH')
								{
										str_state = 'FINISH';//Mara已审核
								}else
								{
										str_state = 'WA_REVIEW';//文案审核中...
								}
						}else if (result.data[i].review.officialState != null)
						{
								str_state = result.data[i].review.officialState;
						}
						
						if (result.data[i].type == 'VISA')
						{
								result.data[i].maraName = (result.data[i].maraId ? result.data[i].mara.name:'');							
								if (result.data[i].review.maraState == 'WAIT' && result.data[i].review.officialState == 'WAIT')
								{
										switch(v.ap_list)
										{												
												case 'GW':
														str_state = 'WA_REVIEW';//文案审核中..
												break;
												case 'WA':
														str_state = 'WA_MA_WAIT';//已提交Mara审核
												break;
												case 'MA':
														str_state = 'MA_WAIT';//待审核
												break;
										}										
								}
								if (result.data[i].parentId)
								{
										result.data[i].serviceName = return_servicename('SIV');
										var service_packagename = return_packagetype(result.data[i].servicePackage.type);
										result.data[i].serviceName += '-'+service_packagename;										
								}else
								{
										result.data[i].serviceName = return_servicename(result.data[i].type)+'-'+result.data[i].service.code;
								}													
						}else if (result.data[i].type == 'OVST')
						{
								//如果maraState='FINISH'，表示整个流程结束。
								if (result.data[i].review.officialState == 'COMPLETE') str_state = 'COE_COMPLETE';
								var str_school = (result.data[i].schoolId ? result.data[i].school.name : '');
								result.data[i].serviceName = return_servicename(result.data[i].type)+'-'+str_school;
						}else if (result.data[i].type == 'SIV')
						{
								//独立技术移民
								result.data[i].serviceName = '<span style="font-weight:bold;color:#0066CC;">'+return_servicename(result.data[i].type)+'</span>';							
						}
						if (result.data[i].state == 'CLOSE') str_refusestate = (result.data[i].closedReason != null ? result.data[i].closedReason:'');
						if (result.data[i].review.officialState == 'PENDING' && result.data[i].review.type == 'REFUSE') str_refusestate = '<br/><span style="color:#003333">文案已驳回</span>';
						if (result.data[i].review.officialState == 'REVIEW' && result.data[i].review.type == 'REFUSE') str_refusestate = '<br/><span style="color:#003333">Mara已驳回</span>';
						if (result.data[i].type == 'SIV')
						{
								if (result.data[i].submitted)
								{
										result.data[i].currentState = 'REVIEW';
										result.data[i].strState = '<span style="color:#FF9966;">已提交佣金表</span>';
								}else
								{
										result.data[i].currentState = str_state;
								}
						}else
						{
								var servicePackage = (result.data[i].servicePackageId ? result.data[i].servicePackage.type:'');
								result.data[i].strState = return_state(str_state,servicePackage)+str_refusestate;
								if (result.data[i].type == 'OVST' && result.data[i].submitted) result.data[i].strState = result.data[i].strState+'<br/><span style="color:#6495ED;">月奖已申请</span>';																
								result.data[i].currentState = str_state;								
						}
						if (result.data[i].type == 'OVST' && result.data[i].state == 'PAID' && !result.data[i].submitted) result.data[i].strState = result.data[i].strState+'<br/><button onclick="open_detail('+result.data[i].id+',\''+result.data[i].type+'\',\''+result.data[i].currentState+'\');" type="button" class="btn btn-danger">待申请月奖</button>';						
						if (result.data[i].remarks) result.data[i].remarks = url_replace1(result.data[i].remarks);
						result.data[i].strRemarks = '';
						if (result.data[i].nutCloud !=null) result.data[i].strRemarks = '<button data-original-title="" data-html="true" data-content="<a href=\''+result.data[i].nutCloud+'\' target=\'_blank\'>点击访问</a>" data-placement="top" data-trigger="onclick" class="btn btn-info btn-xs popovers">查看资料地址</button><br/>';
						if (result.data[i].information !=null)
						{
							result.data[i].information = url_replace1(result.data[i].information);
							result.data[i].strRemarks += '<button style="margin-top:5px;" data-original-title="" data-html="true" data-content="'+result.data[i].information+'" data-placement="top" data-trigger="onclick" class="btn btn-info btn-xs popovers">客户基本信息</button><br/>';
						}
						result.data[i].strRemarks += '<button style="margin-top:5px;" data-original-title="" data-html="true" data-content="'+result.data[i].remarks+'" data-placement="bottom" data-trigger="onclick" class="btn btn-info btn-xs popovers">查看备注</button>';
						result.data[i].tagId = 0;
						result.data[i].tagColour = '';
						result.data[i].tagText = '';
						if (result.data[i].officialTag != null)  
						{
								result.data[i].tagId = result.data[i].officialTag.id;
								result.data[i].tagColour = result.data[i].officialTag.colour;
								result.data[i].tagText = result.data[i].officialTag.name;
						}
				};
				return result.data;
			}
			
			function copyText(oid)
			{
					var clipboard = new ClipboardJS('.copybtn');
					clipboard.on('success',function(e)
					{
							e.clearSelection();
							$('#copy_success').addClass('alert-success').show().delay(1500).fadeOut();
					});
					clipboard.on('error',function(e)
					{							
					});
			}				
			
			function return_servicename(va)
			{
         switch(va)
         {
         		case 'VISA':
         					return '签证';
         		break;
         		case 'OVST':
         					return '留学';
         		break;
         		case 'SIV':
         					return '独立技术移民';
         		break;
         }
      }
      
      function return_packagetype(v)
			{
				var str = '';
				switch(v)
				{
						case 'CA':
								str = '职业评估';
						break;
						case 'EOI':
								str = 'EOI';
						break;
						case 'SA':
								str = '学校申请';
						break;
						case 'VA':
								str = '签证申请';
						break;
				}
				return str;
			}
      
      function return_state(va,type)
			{
					var str_html = '';
					switch(va)
					{
						case 'PENDING':
									str_html = '待提交审核';
						break;
						case 'REVIEW':
									
									str_html = '<label style="">资料待审核</label>';							
						break;
						case 'WA_MA_WAIT':
									
									str_html = '<label style="color:#CCCCFF;">已提交Mara审核</label>';							
						break;
						case 'MA_WAIT':
									
									str_html = '<label style="">待审核</label>';							
						break;
						case 'WA_REVIEW':
									
									str_html = '<label style="color:#99CCCC;">资料审核中</label>';							
						break;
						case 'FINISH':
									str_html = '<label style="color:blue;">资料审核完成</label>';
						break;						
						case 'APPLY':
									str_html = '<label style="color:blue;">服务申请中</label>';
						break;
						case 'COMPLETE':
									var str_text = '';
									switch(type)
									{
											case '':
													str_text = '申请成功';
											break;
											case 'VA':
													str_text = '申请成功';
											break;
											case 'CA':
													str_text = '评估完成';
											break;
											case 'EOI':
													str_text = 'EOI完成';
											break;
									}									
									str_html = '<label style="color:red;">'+str_text+'</label>';
						break;
						case 'COE_COMPLETE':
									str_html = '<label style="color:red;">申请成功</label><br/>COE待支付';
						break;
						case 'PAID':
									str_html = '<label style="color:red;">COE支付成功</label>';
						break;
						case 'CLOSE':
									str_html = '<label style="color:red;">已关闭</label>';
						break;						
					}
					return str_html;
      }      
      
      function open_detail(id,type,state)
      {
      		if (v.ap_list == 'GW' && state == 'PENDING')
      		{
      				if (type == 'VISA')
      				{      				      				
      						add_service1(id,0,'');
      				}else if (type == 'OVST')      				
      				{
      						add_service2(id,0,'');
      				}else if (type == 'SIV')      				
      				{
      						add_service3(id,0,'');
      				}
      		}else
      		{
      				show_addnewservice_id(id,type);
      		}      		
      }                  
            
      
      function flowstep(va,par)
      {      		
      		var str_url = url + "serviceOrder/approval";
      		if (par == '0' || va == 'CLOSE') str_url = url + "serviceOrder/refuse";
      		
          var json = {};
          var closedReason = '';
          if (va == 'CLOSE')
          {
          		if ($('#show_addnewservice1_id #b101').val() != '') closedReason = $('#show_addnewservice1_id #b101').val();
          		if ($('#show_addnewservice2_id #c101').val() != '') closedReason = $('#show_addnewservice1_id #c101').val();
          		json['closedReason'] = closedReason;
          }              
          if (v.orderType == 'VISA' && va == 'COMPLETE')
          {
          		if (v_sub.order_detail.servicePackage == null)
          		{
		          		var flist = $('#show_addnewservice1_id #flist').val();
		          		if (flist == '')
		          		{
		          				$('#alert_error').css('marginLeft','30%');
					   					$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#error_info").html('签证凭证没有上传，请上传之后再提交。');
		          				return false;
		          		}
          		}
          }
          if (v.orderType == 'OVST' && va == 'PAID')
          {
          		var flist = $('#show_addnewservice2_id #flist').val();
          		if (flist == '')
          		{
          				$('#alert_error').css('marginLeft','30%');
			   					$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
	          			$("#error_info").html('收款凭证没有上传，请上传之后再提交。');
          				return false;
          		}
          }
          //文案更新
          if (v.orderType == 'OVST' && v.ap_list == 'WA')
          {
          		if (va != 'APPLY' && va != 'PAID' && va !='COMPLETE') json['subagencyId'] = $('#show_addnewservice2_id #c7a').val();
          		//if (va != 'APPLY' && va != 'PAID') json['remarks'] = $('#show_addnewservice2_id #c16a').val();
          }
          show_loading();
          
          json['id'] = v.orderId;
          json['state'] = va;          
          $.post(str_url, json,
			   	function(data){
			   			$('#loading_id').modal('hide');			   			
			   			if (data.code == 0)
			   			{			   					                        
          				if (v.orderType == 'VISA' && v.ap_list == 'GW' && va == 'REVIEW') reqCommissionVisa();//如果GW提交审核,就创建佣金订单 		
			   					if (va == 'PAID' || va == 'COMPLETE' || va == 'CLOSE')
			   					{
					   					$.ajax({
							          url: url + 'serviceOrder/finish?id='+json['id'],
							          type: 'GET',
							          dataType: 'json'
							        }).done(function(response) {
							        	response = response.data;
							        });
					      	}
			   					$('#alert_success').css('marginLeft','30%');
			   					$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
			   					setTimeout(function(){v.getDatalist();$('.modal-backdrop').remove();}, 1000);			   								   					
			   					if (v.orderType == 'VISA')
			   					{
			   							$('#show_addnewservice1_id').modal('hide');			   							
			   					}else if (v.orderType == 'OVST')
			   					{
			   							$('#show_addnewservice2_id').modal('hide');
			   					}
			   					//setTimeout(function(){window.location.href = "serviceorder-list.html?state=";}, 2000);				   					
			   			}else
			   			{			   					
			   					$('#alert_error').css('marginLeft','30%');
			   					$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
	          			$("#error_info").html(data.message);
		        			return false;
			   			}
			   	});
      }            
      
      function show_confirmbox(type,id,va,par)
      {
      		v.orderId = id;
      		v.orderType = type;
      		v.set_state = va;
      		v.set_type = par;
      		if (v.orderId)
					{
							$.ajax({
			          url: url + 'serviceOrder/get?id='+v.orderId,
			          type: 'GET',	          
			          dataType: 'json'
			        }).done(function(response) {
			        	response = response.data;			        	
			        	v_sub.order_detail = response;
			        });
					}
      		$('#showconfirmbox_id').modal('show');
      }
      
      function update_state()
      {      		
      		if (v_sub.order_detail.type=='SIV' && v.ap_list == 'GW' && !v_sub.order_detail.parentId && !v_sub.order_detail.submitted)
      		{
      				show_loading();
      				reqCommissionVisa();//创建SIV佣金订单
      				$('#showconfirmbox_id').modal('hide');      				
      		}else
      		{
		      		flowstep(v.set_state,v.set_type);
		      		$('#showconfirmbox_id').modal('hide');		      			      		
      		}      		
      }
      
      $('#order_list a.save1').live('click', function (e) {
					e.preventDefault();
					table_addsave1();
			});
			
			$('#order_list a.cancel').live('click', function (e) {
					e.preventDefault();
					v.subject.splice(v.current_index, 0);
					v.subject.splice(v.current_index,1, v.current_row);
			});
			
			function table_addsave1()
			{
					var f = '#order_list ';
					var str_val = $(f+'#'+v.update_byid).val();
					var field = v.update_field;
					var check_result = 0;
					
					if (parseInt(str_val))
					{
							check_result = true;
					}else
					{
							$('#alert_error').css('marginLeft','40%');
			    		$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			        $("#error_info").html('提示：字段必须选择！');
			    		return false;
					}
					
					if (check_result)
    			{
    					var str_url = url + "serviceOrder/update";
       				var json = {};
       				json['id'] = v.dId;
       				if (field == 'adviserName')
       				{
       					 json['adviserId'] = str_val;
       				}else if (field == 'officialName')
       				{
       					 json['officialId'] = str_val;
       				}else if (field == 'realPeopleNumber')
       				{
       					 str_url = url + "serviceOrder/updateRealPeopleNumber";
       					 json['realPeopleNumber'] = str_val;
       				}else if (field == 'gmtCreate')
       				{
       					 str_url = url + "serviceOrder/updateReadcommittedDate";
       					 //时间格式转换
       					 if (str_val != '') str_val = formatDate2(str_val);
       					 json['readcommittedDate'] = str_val;
       				}  				
       				
       				
       				show_loading();       				
       				$.post(str_url, json,
					   	function(data){
					   			$('#loading_id').modal('hide');
					   			if (data.code == 0)
					   			{
					   					v.dId = 0;
					   					$('#alert_success').css('marginLeft','40%');
					   					$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					v.table_remove();
					   					setTimeout(function(){v.getDatalist();$('.modal-backdrop').remove();}, 1000);
					   			}else
					   			{
					   					$('#alert_error').css('marginLeft','40%');
					   					$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#error_info").html(data.message);
				        			return false;
					   			}				   	
					   	});
    			}
			}
			
			v.$watch('subject', function(obj) {
					$('.default-date-picker').datepicker({   				
				        format: 'dd/mm/yyyy'
				  });
				  $('.default-date-picker1').datepicker({   				
				        format: 'yyyy-mm-dd',
				        endDate: new Date()
				  });				  				  
				  	
				  var adviserId = 0;
				  var adviserId_t2 = 0;
				  var officialId = 0;
				  var officialId_t1 = 0;				  
				  var maraId = 0;				   
				  if (typeof v.adviserId != "undefined") adviserId = v.adviserId; 
				  if (typeof v.officialId != "undefined") officialId = v.officialId;
				  if (typeof v.maraId != "undefined") maraId = v.maraId;
				  
				  if (this.current_row.id)
				  {
				  		$("#id").val(this.current_row.id);				  		
				  		adviserId_t2 = this.current_row.adviserId;
				  		officialId_t1 = this.current_row.officialId;
				  }
				 	
				  //查询客户
				  var user = $("#user_name");
				  user.autocompleter({
			    	highlightMatches: true,
			    	limit: 10,
			    	cache: false,
			    	customValue: 'name',
			    	customLabel: 'name',
			    	source: url + 'user/list?authNickname=&phone=&pageNum=0',
			    	combine: function(params) {
			    		return {
				        name: params.query,
				        pageSize: params.limit
				      };
			    	},
			    	callback: function(value, index, object) {
			    		if (object.id)
			    		{
					    		$('#userId').val(object.id);
					    		v.userId = object.id;  		
			    		}
			    	},
			    	minLength: 1						    	
			    });
				  //绑定顾问
				  var obj_adviserId = $("#adviserId");
				  $("#adviserId").empty();
				  var strPar = '';
				  if (v.gw_regionid != 'null')
				  {
				  		if (!adviserId) adviserId = v.adviser_id;				  			  		
				  		strPar = '&regionId='+v.gw_regionid;
				  }
	        obj_adviserId.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'adviser/list?pageNum=0&pageSize=100000'+strPar,
	          type: 'GET',
	          async: false,
	          dataType: 'json'
	        }).done(function(response) {
	        	
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_adviserId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_adviserId.val(adviserId);	
	        });
	        var obj_adviserId_t2 = $("#t2");
				  $("#t2").empty();
	        obj_adviserId_t2.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'adviser/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          async: false,
	          dataType: 'json'
	        }).done(function(response) {
	        	
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_adviserId_t2.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_adviserId_t2.val(adviserId_t2);	
	        });
				  //绑定文案列表			    
	        var obj_officialId = $("#officialId");
	        $("#officialId").empty();
	        if (this.ap_list == 'WA' && this.wa_admin == 'true')
	        {
	        		if (!officialId) officialId = v.official_id;	
	        }
	        obj_officialId.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'official/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          async: false,
	          dataType: 'json'
	        }).done(function(response) {
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_officialId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_officialId.val(officialId);	        	
	        });
	        //绑定文案列表			    
	        var obj_officialId_t1 = $("#t1");
	        $("#t1").empty();
	        obj_officialId_t1.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'official/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          async: false,
	          dataType: 'json'
	        }).done(function(response) {
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_officialId_t1.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_officialId_t1.val(officialId_t1);	        	
	        });
	        //绑定Mara列表			    
	        var obj_mara = $("#maraId");
	        $("#maraId").empty();
	        obj_mara.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'mara/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          async: false,
	          dataType: 'json'
	        }).done(function(response) {
	        	
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_mara.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_mara.val(maraId);	        	
	        });
	        //绑定区域列表
			    var obj_regionId = $("#regionId");
			    $("#regionId").empty();
			    obj_regionId.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'region/list_all',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	var region_data = response.data;
	        	for (var item in region_data)
	        	{
	        			obj_regionId.append("<option value='"+region_data[item].id+"'>"+region_data[item].name+"</option>");
	        			var region_sub = region_data[item].regionList;
	        			for (var itemsub in region_sub)
	        			{
	        					obj_regionId.append("<option value='"+region_sub[itemsub].id+"'>---"+region_sub[itemsub].name+"</option>");
	        			}
	        	}
	        });
	        //绑定文案Tag列表			    
	        var obj_tag = $("#tag_id");
	        var obj_stag = new Object();
	        if (this.ap_list == 'WA')
	        {
	        		obj_stag = $("#officialTagId");
	        		obj_stag.empty();	
	        		obj_stag.append("<option value='0'>请选择</option>");       		
	        }
	        $("#tag_id").empty();
	        obj_tag.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'officialTag/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          async: false,
	          dataType: 'json'
	        }).done(function(response) {
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_tag.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        			if (v.ap_list == 'WA') obj_stag.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_tag.val();
	        	if (v.ap_list == 'WA') obj_stag.val(v.officialTagId);	        	
	        });        
			});
			
			function getRequest(par)
			{
					var str_value = '';
			    var url = decodeURI(location.search);
			    var theRequest = new Object();
			    if (url.indexOf('?') != -1) {
			        url = url.substr(1);
			    }
			    if (url) {
			        var strs = url.split('&');
			        for (var i = 0; i < strs.length; i++) {
			            var srtArry = strs[i].split('=');
			            var y = srtArry.shift();
			            theRequest[y] = unescape(srtArry.join('='));
			        }
			    }
			    str_value = theRequest[par];
			    $("#servicestate"+str_value).addClass("active");
			    return str_value;
			}	
      
      function show_knowledge_detail(id,parentId)
      {
      		sessionStorage.setItem("id", id);
      		sessionStorage.setItem("menu_parentid", parentId);
					window.location.href = "knowledge.html"; 
      }
      
      function url_replace(str)
			{
					var reg = /((http|ftp|https):\/\/)?[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/g;
					str=str.replace(reg,function(a){
					    if(!a.indexOf('http'))
					    {
					    	return '<a href="'+a+'" target="_blank">'+a+'</a>';
					    }else
					    {
					    	return '<a href="http://'+a+'" target="_blank">'+a+'</a>';
					    }
					});
					return str;
			}
			
			function url_replace1(str)
			{
					var reg = /((http|ftp|https):\/\/)?[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/g;
					str=str.replace(reg,function(a){
					    if(!a.indexOf('http'))
					    {
					    	return "<a href=\'"+a+"\' target=\'_blank\'>"+a+"</a>";
					    }else
					    {
					    	return "<a href=\'http://"+a+"\' target=\'_blank\'>"+a+"</a>";
					    }
					});
					return str;
			}
			
			function  formatDate(now)
			{
			    var   now= new Date(now);     
			    var   year=now.getFullYear();     
			    var   month=now.getMonth()+1;     
			    var   date=now.getDate();     
			    var   hour=now.getHours();
			    var   minute=now.getMinutes();     
			    var   second=now.getSeconds();
			    return fixZero(date,2)+"/"+fixZero(month,2)+"/"+year;
			}
			
			function  formatDate2(str_date)
			{
			    var arr = str_date.split("/");
			    var year = arr[2];
			    var month = arr[1];
			    var date = arr[0];
			    return   year+"-"+fixZero(month,2)+"-"+fixZero(date,2)+" 00:00:00"; 
			} 
			
			function fixZero(num,length)
			{     
			    var str=""+num;
			    var len=str.length;     var s="";
			    for(var i=length;i-->len;)
			    {         
			        s+="0";
			    }
			    return s+str;
			}
			
			function show_loading()
			{
					$('#loading_id').on('show.bs.modal', function(){
	          var $this = $(this);
	          var $modal_dialog = $this.find('.modal-dialog');
	          $this.css('display', 'block');
	          $modal_dialog.css({'margin-top': Math.max(0, ($(window).height() - $modal_dialog.height()) / 2) });
	        });
					$('#loading_id').modal('show');
			}
			
			function show_tagbox(orderId,tagId)
			{
					if (v.ap_list == 'WA')
					{
							v.tagId = 0;
							v.orderId = orderId;
							if (tagId != '0')
							{
									v.tagId = tagId;
									$('#wa_tagbox #tag_id').val(tagId);
									$('#wa_tagbox #del_tag').show();
							}else
							{
									$('#wa_tagbox #del_tag').hide();
									$('#wa_tagbox #tag_id').val(0);
							}
							$('#wa_tagbox').modal('show');
					}
			}
			
			function setWaTag()
			{
					var f = '#wa_tagbox ';
					var tagId = $(f+"#tag_id").val();
					
					if (tagId == '')
					{
							$(f+'#alert_error').css('marginLeft','30%');
				   		$(f+'#alert_error').addClass('alert-danger').show().delay(1500).fadeOut();
				   		return false;
					}else
					{
							var str_url = url + "officialTag/addServiceOrderOfficialTag";
							if (v.tagId) str_url = url + "officialTag/updateServiceOrderOfficialTag";
							var json = {};
							json['id'] = tagId;
							json['serviceOrderId'] = v.orderId;
							
							$.post(str_url, json,
					   	function(data){
					   			if (data.code == 0)
					   			{
					   					$(f+'#alert_success').css('marginLeft','30%');
			    						$(f+'#alert_success').css('marginTop','10%');
					   					$(f+'#alert_success').addClass('alert-success').show().delay(1500).fadeOut();					   					
					   					setTimeout(function(){$("#wa_tagbox").modal('hide');}, 1500);
					   					//重新载入数据源					   					
					   					v.getDatalist();
					   			}else
					   			{
					   					$(f+'#alert_error').css('marginLeft','30%');
			    						$(f+'#alert_error').css('marginTop','10%');
					   					$(f+'#alert_error').addClass('alert-danger').show().delay(1500).fadeOut();
					   					$(f+'#error_info').html(data.message);
					   			}					   			
					   	});
					}
			}
			
			function delWaTag()
			{
					var f = '#wa_tagbox ';
					var tagId = $(f+"#tag_id").val();
					
					if (tagId != '')
					{
							var str_url = url + "officialTag/deleteServiceOrderOfficialTagById";							
							var json = {};
							json['id'] = tagId;
							json['serviceOrderId'] = v.orderId;
							
							$.get(str_url, json,
					   	function(data){
					   			if (data.code == 0)
					   			{
					   					$(f+'#alert_success').css('marginLeft','30%');
			    						$(f+'#alert_success').css('marginTop','10%');
					   					$(f+'#alert_success').addClass('alert-success').show().delay(1500).fadeOut();					   					
					   					setTimeout(function(){$("#wa_tagbox").modal('hide');}, 1500);
					   					//重新载入数据源					   					
					   					v.getDatalist();
					   			}else
					   			{
					   					$(f+'#alert_error').css('marginLeft','30%');
			    						$(f+'#alert_error').css('marginTop','10%');
					   					$(f+'#alert_error').addClass('alert-danger').show().delay(1500).fadeOut();
					   					$(f+'#error_info').html(data.message);
					   			}					   			
					   	});
					}
			}
			
			function deleteId()
      {
      		//alert(v.dId+'删除功能暂不可用。');
      		//return false;
      		show_loading();
					$.get(url + "serviceOrder/delete", {
						id: v.dId
					}, function(result) {											
						$('#loading_id').modal('hide');
						if(result.data)
						{								
								$('#delete_id').modal('hide');
								$('#delete_id #alert_success').css('marginLeft','30%');
				   			$('#delete_id #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
								//v.table_remove();
		   					//重新载入数据源		   					
		   					v.getDatalist();
		   					$('.modal-backdrop').remove();	
						}else
						{								
								$('#delete_id #alert_error').css('marginLeft','30%');
				   			$('#delete_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
        				$("#delete_id #error_info").html(result.message);
						}
					});      		
      }
			
	    jQuery(document).ready(function() {
	    });
		</script>
	</body>

</html>