<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="renderer" content="webkit">
		<meta http-equiv="Pragma" content="no-cache" />   
		<meta http-equiv="Cache-Control" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<link rel="shortcut icon" href="img/favicon.ico">
		<title>我的佣金报表</title>
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet">
		<link href="assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-datepicker/css/datepicker.css"><!-- BOOTSTRAP DATEPICKER PLUGIN CSS -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-timepicker/compiled/timepicker.css"><!-- BOOTSTRAP TIMEPICKER PLUGIN CSS -->		
		<link rel="stylesheet" type="text/css" href="css/jquery.autocompleter.css">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link href="css/index.css" rel="stylesheet">
		<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body id="mycommission-ovst-accounting" v-cloak>
<section id="container">
			<header class="header white-bg">
				<div class="sidebar-toggle-box">
					<div data-placement="right" class="fa fa-bars tooltips">
					</div>
				</div>
				<a href="main.html" class="logo">
					佣金系统
					<span v-if="ap_list==='KJ'">
           	 会计
          </span>
          <span v-if="ap_list==='GW'">
           	 顾问
          </span>
          <span v-if="ap_list==='WA'">
           	 文案
          </span>
          <span v-if="ap_list==='MA'">
           	 Mara
          </span>
          <span v-if="ap_list==='SUPERAD'">
           	 超级管理员
          </span>
				</a>
				<div class="top-nav ">
					<ul class="nav pull-right top-menu">
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="username">
                  {{admin}}
                </span>
								<b class="caret">
                </b>
							</a>
							<ul class="dropdown-menu extended logout">
								<li class="log-arrow-up">
								</li>
								<li>
									<a href="password.html">
										<i class="fa fa-key">
                    </i> 修改密码
									</a>
								</li>
								<li><a href="javascript:tb.out();">
										<i class="fa fa-user">
                    </i> Log Out
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</header>
			<aside>
				<div id="sidebar" class="nav-collapse">
					<ul class="sidebar-menu" id="nav-accordion">
						<li >
              <a href="main.html">
                <i class="fa fa-dashboard">
                </i>
                <span>
                  Dashboard
                </span>
              </a>
            </li>
            <dli v-if="ap_list==='SUPERAD'">            
            <li>
              <a href="adviser.html">
                <i class="fa fa-book">
                </i>
                <span>
                  顾问管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 文案管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="official.html">
										文案管理
									</a>
								</li>
								<li>
									<a href="official-tag.html">
										订单标签管理
									</a>
								</li>								
							</ul>
						</li>
            <li>
              <a href="mara.html">
                <i class="fa fa-book">
                </i>
                <span>
                  MARA管理
                </span>
              </a>
            </li>
            <li>
              <a href="accounting.html">
                <i class="fa fa-book">
                </i>
                <span>
                  会计管理
                </span>
              </a>
            </li>
            </dli>
          	<dli v-if="ap_list==='SUPERAD' || (ap_list==='GW' && gw_regionid !== 'null') || ap_list==='KJ'">
            <li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 学校管理
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="school.html">
										学校管理
									</a>
								</li>
								<li>
									<a href="school-setting.html">
										佣金设置
									</a>
								</li>								
							</ul>
						</li>
						</dli>
						<dli v-if="ap_list==='SUPERAD'">
            <li>
              <a href="receive-type.html">
                <i class="fa fa-book">
                </i>
                <span>
                  收款方式管理
                </span>
              </a>
            </li>
            <li>
              <a href="subagency.html">
                <i class="fa fa-book">
                </i>
                <span>
                  Subagency管理
                </span>
              </a>
            </li>
            <li class="sub-menu">
            	<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 服务管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="service.html">
										服务项目管理
									</a>
								</li>
								<li>
									<a href="service-package.html">
										服务包管理
									</a>
								</li>
								<li>
									<a href="visa-ca.html">
										签证职业评估管理
									</a>
								</li>							
							</ul>              
            </li>
          	</dli>
          	<li v-if="ap_list!=='KJ' && ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 客户管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="users.html">
										客户管理
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="user-tags.html">
										标签管理
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='KJ'" class="sub-menu">
							<a href="serviceorder-list.html">
                <i class="fa fa-book">
                </i>
                <span>
                  服务订单管理
                </span>
              </a>
						</li>
            <li v-if="ap_list==='SUPERAD'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 渠道管理
                </span>
							</a>
							<ul class="sub">
								<li>
									<a href="source.html">
										渠道列表
									</a>
								</li>
								<li>
									<a href="source-type.html">
										来源分类
									</a>
								</li>								
							</ul>
						</li>
						<li v-if="ap_list!=='WA' && ap_list!=='MA'" class="sub-menu">
							<a href="javascript:;" class="active">
								<i class="fa fa-book">
                </i>
								<span>
                 	 佣金表
                </span>
							</a>
							<ul class="sub">								
								<li v-if="ap_list==='GW'" class="active">
									<a href="mycommission.html">
										我的佣金报表
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_DJY">
									<a href="mycommission-ovst-accounting.html?commission_state=DJY&list=DJY,DZY,YZY">
										待结佣订单
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_YJY">
									<a href="mycommission-ovst-accounting.html?commission_state=YJY&list=YJY">
										已结佣订单
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_DZY">
									<a href="mycommission-ovst-accounting.html?commission_state=DZY&list=DZY">
										待追佣订单
									</a>									
								</li>	
								<li v-if="ap_list==='KJ'" id="commission_state_YZY">
									<a href="mycommission-ovst-accounting.html?commission_state=YZY&list=YZY">
										已追佣订单
									</a>									
								</li>
								<li v-if="ap_list==='KJ'" id="commission_state_TQKY">
									<a href="mycommission-ovst-accounting.html?commission_state=TQKY&list=TQKY">
										提前扣佣订单
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="accounting-bank.html">
										转账信息配置
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="accounting-bankbill.html">
										银行对账单
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="mycommission-check-accounting.html">
										自动对账
									</a>									
								</li>
								<li v-if="ap_list==='SUPERAD'">
									<a href="create-visa-commission.html">
										重建签证佣金表订单
									</a>
								</li>
								<li v-if="ap_list==='SUPERAD' || ap_list==='KJ'">
									<a href="table-export.html">
										导出数据
									</a>
								</li>
							</ul>
						</li>
						<li v-if="ap_list==='KJ' || ap_list==='SUPERAD'" class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 Tax Invoice管理
                </span>
							</a>
							<ul class="sub">
								<li id="invoice_">
									<a href="taxinvoice-list.html?state=&type=SF">
										Tax Invoice列表
									</a>									
								</li>
								<li id="invoice_canceled">
									<a href="taxinvoice-list.html?state=canceled&type=SF">
										已Cancel列表
									</a>									
								</li>															
							</ul>
						</li>
						<li class="sub-menu">
							<a href="javascript:;">
								<i class="fa fa-book">
                </i>
								<span>
                 	 知识库
                </span>
							</a>
							<ul class="sub">
								<li v-if="ap_list==='SUPERAD'">
									<a href="knowledge-menu.html">
										菜单管理
									</a>
								</li>
								<li>
									<a href="knowledge.html">
										知识库菜单
									</a>
								</li>
								<li>
									<a href="http://question.zhinanzhen.org/api/users/znz/{{admin}}" target="_blank">
										指南针问答
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</aside>
			<section id="main-content" class="content">
				<section class="wrapper site-min-height">
					<div class="row">
						<div class="col-lg-12">
							<section class="panel">
								<header class="panel-heading">
									我的佣金报表
								</header>
								<div class="panel-body">
									<div class="adv-table editable-table" id="my_table">
										<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
									      <button data-dismiss="alert" class="close close-sm" type="button">
									      </button>
									      <strong>Success!</strong> You  just achieved success.
									  </div>
									  <div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
                      <button data-dismiss="alert" class="close close-sm" type="button">                      
                      </button>
                      <strong id="error_info"></strong>
                    </div>
									  <form class="form-inline" style="margin-top:10px;">
									  	<input v-model.trim="userId" type="hidden" name="userId" id="userId" value="0" />
											<div class="form-group">
													<label>订单ID</label>
													<input v-model.trim="id" id="id" type="text" class="form-control" style="width:90px;" placeholder="请输入纯数字">
													<label>客户姓名</label>													
													<input type="text" v-model.trim="name" class="form-control" style="width:150px;" placeholder="模糊匹配">
													<label>电话号码</label>
													<input type="text" v-model.trim="phone" class="form-control" style="width:100px;">
													<label>微信号</label>
													<input type="text" v-model.trim="wechatUsername" class="form-control" style="width:100px;">
													<label>顾问</label>
													<select v-model.trim="adviserId" id="adviserId" class="form-control" style="width:130px;">
													</select>
													<label>学校</label>
													<select v-model.trim="schoolId" id="schoolId" class="form-control" style="width:130px;">
													</select>
													<label>提前扣佣</label>
													<select v-model.trim="isSettle" id="isSettle" class="form-control" style="width:130px;">
													</select>
											</div>
											<div class="form-group">
												<label>财务审核时间(开始)</label>	
												<input v-model.trim="startKjApprovalDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:150px;">
												<label>财务审核时间(结束)</label>	
												<input v-model.trim="endKjApprovalDate" type="text" autocomplete="off" class="form-control default-date-picker1" style="width:150px;">
												<label>服务项目</label>											
												<select id="type" class="form-control" style="width:130px;" onchange="gotoUrl(this.value);">
												<option value="OVST" selected="true">留学</option>
												<option value="VISA">签证</option>													
												</select>
												<dle v-if="ap_list!=='GW'">
												<label>选择地区</label>
												<select v-model.trim="regionId" id="regionId" class="form-control" style="width:130px;">
												</select>
												</dle>
												<button @click="getSearch" type="button" class="btn btn-info">查询</button>
												<button @click="getExport" type="button" class="btn btn-primary">导出</button>
												<button v-if="commission_state ==='DJY' || commission_state ==='DZY'" onclick="uploadFile()" type="button" class="btn btn-success">上传数据</button>
											</div>											
											<div v-if="commission_state ==='DZY'" class="form-group">
												<button @click="multiple_edit" type="button" class="btn btn-warning">批量编辑</button>
											</div>
											<div v-if="commission_state ==='DJY'" class="form-group">
												<button @click="multiple_edit1" type="button" class="btn btn-warning">批量编辑</button>
											</div>
										</form>
										<div class="responsive-table margin-top">
											<input type="hidden" name="id" id="id" value="0" />
											<table class="display table table-bordered table-striped" id="list_ovst" style="width:2500px;">
												<thead>
													<tr>
														<th>订单ID</th>
														<th>创建日期</th>
														<th>提交审核时间</th>
														<th>客户支付日期</th>
														<th>Student Name</th>
														<th>Student ID</th>
														<th>服务项目</th>
														<th>是否提前扣佣</th>
														<th>Institute</th>
														<th>Course Name</th>
														<th>Installment Due Date</th>
														<th>收款方式</th>
														<th>Total Tuition Fee</th>
														<th>Tuition Fee Per Installment</th>
														<th>总计应收</th>
														<th><span style="color:#FF6C60;">总计已收</span></th>											
														<th>本次收款</th>
														<th><span style="color:#FF6C60;">Commission</span></th>
														<th>确认预收业绩</th>
														<th>GST</th>
														<th>Deduct GST</th>
														<th>学校支付金额</th>
														<th>学校支付时间</th>
														<th>Invoice NO.</th>
														<th>追佣时间</th>
														<th>Subagency</th>
														<th>银行对账字段</th>
														<th>是否自动对账成功</th>
														<th>入账日期</th>
														<th>月奖</th>														
														<th>月奖支付时间</th>
														<th>顾问</th>
														<th>状态</th>
														<th>操作</th>
														<th>备注</th>
													</tr>
												</thead>
												<tbody>
													<tr v-for="item in subject" class="gradeX">
														<td v-html="item.strOid"></td>
														<td v-html="item.gmtCreate"></td>
														<td @dblclick="table_edit($index,'kjApprovalDate','t4')"><span v-html="item.kjApprovalDate"></span></td>
														<td v-html="item.receiveDate"></td>
														<td v-html="item.userName" id="userName{{item.id}}"></td>
														<td v-html="item.studentCode" id="studentCode{{item.id}}"></td>
														<td v-html="item.serviceName" id="serviceName{{item.id}}"></td>
														<td v-html="item.strSettle"></td>
														<td v-html="item.schoolName"></td>
														<td v-html="item.schoolSubject" id="schoolSubject{{item.id}}"></td>
														<td v-html="item.installmentDueDate"></td>
														<td v-html="item.receiveTypeName"></td>
														<td v-html="item.tuitionFee" id="tuitionFee{{item.id}}"></td>
														<td v-html="item.perAmount"></td>
														<td v-html="item.totalPerAmount"></td>
														<td v-html="item.totalAmount"></td>
														<td v-html="item.amount" id="amount{{item.id}}"></td>
														<td v-html="item.expectAmount" id="expectAmount{{item.id}}"></td>
														<td @dblclick="table_edit($index,'sureExpectAmount','t1')"><span v-html="item.sureExpectAmount"></span></td>
														<td v-html="item.gst"></td>
														<td v-html="item.deductGst"></td>
														<th v-html="item.schoolPaymentAmount"></th>
														<td v-html="item.schoolPaymentDate"></td>														
														<td v-html="item.invoiceNumber"></td>
														<td v-html="item.zyDate"></td>
														<td v-html="item.subagencyName"></td>
														<td @dblclick="table_edit($index,'bankCheck','t2')"><span v-html="item.bankCheck"></span></td>
														<td @dblclick="table_edit($index,'isChecked','t3')"><span v-html="item.isChecked"></span></td>
														<td v-html="item.bankDate"></td>
														<td v-html="item.bonus"></td>														
														<td v-html="item.bonusDate"></td>
														<td v-html="item.adviser.name"></td>
														<td v-html="item.strState"></td>
														<td>
																<a href="javascript:open_detail({{item.serviceOrderId}},{{item.oid}});">查看</a>
																<dli v-if="ap_list==='KJ' && commission_state ==='DJY'">
																		<dli v-if="item.id">
																				<dli v-if="item.schoolPaid">
																				<a href="javascript:;" @click="table_modify($index)"><span style="color:blue;">编辑</span></a>
																				</dli>
																				<a href="javascript:show_confirmbox({{item.oid}},'WAIT',0);"><span style="color:blue;">驳回</span></a>
																		</dli>
																		<dli v-else>
																				<dli v-if="item.type">
																				<a class="save" href="javascript:;"><span style="color:blue;" id="save{{item.oid}}">保存并审批通过</span></a>
																				</dli>
																				<dli v-else>
																				<a class="save2" href="javascript:;"><span style="color:blue;">保存</span></a>
																				</dli>
																				<a class="cancel" href="javascript:;">取消</a>
																		</dli>
																</dli>
																<dli v-if="ap_list==='KJ' && commission_state ==='DZY'">																	
																		<dli v-if="item.id">
																				<a href="javascript:;" @click="table_modify1($index)"><span style="color:blue;">编辑</span></a>
																		</dli>
																		<dli v-else>
																				<dli v-if="!is_multiple">
																						<dli v-if="item.type">
																						<a class="save1" href="javascript:;"><span style="color:blue;">保存</span></a>
																						</dli>
																						<dli v-else>
																						<a class="save2" href="javascript:;"><span style="color:blue;">保存</span></a>
																						</dli>
																						<a class="cancel" href="javascript:;">取消</a>
																				</dli>
																		</dli>
																</dli>
																<dli v-if="ap_list==='KJ' && commission_state ==='TQKY'">																		
																		<dli v-if="item.id"></dli>
																		<dli v-else>																				
																				<dli>
																				<a class="save2" href="javascript:;"><span style="color:blue;">保存</span></a>
																				</dli>
																				<a class="cancel" href="javascript:;">取消</a>
																		</dli>
																</dli>
														</td>
														<td v-html="item.strRemarks"></td>
														<td style="display:none;" v-html="item.startDate" id="startDate{{item.id}}"></td>
														<td style="display:none;" v-html="item.birthday" id="dob{{item.id}}"></td>
													</tr>
													<tr class="gradeX">
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>														
														<td style="background:#F4A460">合计：</td>
														<td style="background:#F4A460">{{total_amount}}</td>
														<td style="background:#F4A460">{{total_expectamount}}</td>														
														<td bgcolor="#F4A460">{{total_sureexpectamount}}</td>														
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td style="background:#F4A460">{{total_bonus}}</td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td style="display:none;"></td>
														<td style="display:none;"></td>
													</tr>													
												</tbody>
											</table>
										</div>
										<div class="row-fluid" style="display:;">
											<div class="span6">
												<div class="dataTables_info" id="hidden-table-info_info">共{{count}}条</div>
											</div>
											<div class="span6">
												<div class="dataTables_paginate paging_bootstrap pagination">
													<ul>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="firstPage" href="javascript:;">首页</a>
														</li>
														<li :class="[pageNum==0?'disabled':'']">
															<a @click="prevPage" href="javascript:;">← Pre</a>
														</li>
														<li class="nowPage" style="padding: 0px 0px;margin: 0 1px;">
															第{{pageNum+1}}页/共{{allPage}}页&nbsp;
															跳到 <input type="text" v-model.trim="pnumber" @keyup.enter="submit" style="width:50px;color:#c7c7c7;border: 1px solid #ddd;border-radius: 3px;-webkit-border-radius: 3px;padding: 5px 10px;display: inline-block;" id="b100" placeholder="" value=""> 页
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="nextPage" href="javascript:;">Next → </a>
														</li>
														<li :class="[pageNum==allPage-1?'disabled':'']">
															<a @click="lastPage" href="javascript:;">末页</a>
														</li>
													</ul>
												</div>
											</div>
										</div>
										<div id="show_multiple" style="display:none;margin-top:10px;">
											<button @click="multiple_save" id="btn_multiple_save" type="button" class="btn btn-primary">保存</button>
											<button @click="multiple_remove" type="button" class="btn btn-default">取消</button>
											<label id="show_info" style="display:none;margin-left:10px;color:blue;">正在保存，请稍等...</label>
										</div>
										<div id="show_multiple1" style="display:none;margin-top:10px;">
											<button @click="multiple_save1" id="btn_multiple_save" type="button" class="btn btn-primary">保存</button>
											<button @click="multiple_remove1" type="button" class="btn btn-default">取消</button>
											<label id="show_info" style="display:none;margin-left:10px;color:blue;">正在保存，请稍等...</label>
										</div>
										<div v-if="is_select==='yes'" id="ids_multiple" style="margin-top:10px;">
												<a id="selectAll" href="javascript:">全选</a>&nbsp;|&nbsp;<a id="reverse" href="javascript:">反选</a>&nbsp;|&nbsp;<a id="unSelect" href="javascript:">取消选择</a>
												<button onclick="multiple_import()" id="btn_multiple_import" type="button" class="btn btn-primary">确认导入</button>
												<button onclick="self.close();localStorage.setItem("is_select", "no");" type="button" class="btn btn-default">取消</button>
										</div>
									</div>
								</div>
							</section>
						</div>
					</div>
				</section>
			</section>
			<footer class="site-footer">
				<div class="text-center">
					2021 &copy; 佣金系统 by <span style="color:white;">Global Innovation Group</span>.
					<a href="#" class="go-top">
						<i class="fa fa-angle-up">
            </i>
					</a>
				</div>
			</footer>
		</section>
		<div class="modal fade" id="showconfirmbox_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="z-index:9999;">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">操作提示</h4>
					</div>
					<div class="modal-body">
						<div><strong>请注意，此操作不可逆。</strong>您确认执行此操作吗？</div>
						<div id="refuse_remarks" class="form-group" style="display:none;width:100%;line-height:40px;">
							<label class="control-label"><strong>驳回备注：</strong></label>
							<textarea id="refuseRemarks" class="form-control" style="width:98%"></textarea>							
						</div>
						<div class="form-group">
								<label class="col-sm-12 control-label" id="show_error_message" style="text-align: center;color:red;"></label>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="update_state();" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="upload_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">上传数据</h4>
					</div>
					<div class="modal-body">
							<form class="form-horizontal" autocomplete="off">
							<div class="form-group">
								<label class="col-sm-3 control-label">请选择文件</label>
								<div class="col-sm-8">
									<input type="file" id="f2" accept=".xls,.xlsx" class="form-control" placeholder="请选择一个文件">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-12 control-label" id="show_message" style="text-align: center;color:red;"></label>
							</div>							
							</form>
					</div>
					<div class="modal-footer">
						<button id="btnUpload" type="button" class="btn btn-primary">确认上传</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="loading_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static' style="z-index:99999;">
			<div class="modal-dialog" role="document" style="width:350px;">
				<div class="modal-content">
					<div class="modal-header">
					</div>
					<div class="modal-body">
							<div style="text-align:center;color:#0066CC;"><img src="img/input-spinner.gif" /> 正在执行，请稍后...</div>
					</div>
					
				</div>
			</div>
		</div>
		<div class="modal fade" id="showconfirmbox_invoice_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="z-index:9999;">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">操作提示</h4>
					</div>
					<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
			      <button data-dismiss="alert" class="close close-sm" type="button">
			      <i class="fa fa-times"></i>
			      </button>
			      <strong>Success!</strong> You  just achieved success.
			  	</div>
			  	<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
		        <button data-dismiss="alert" class="close close-sm" type="button">
		        <i class="fa fa-times"></i>
		        </button>
		        <strong id="error_info"></strong>
		      </div>
					<div class="modal-body">
						是否将<strong>Invoice</strong>信息添加至佣金订单中，您确认执行此操作吗？
					</div>
					<div class="modal-footer">						
						<button onclick="updateToInvoice();" type="button" class="btn btn-primary">确认</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>
			</div>
		</div>
		<div id="load-mycommission-ovst-accounting-view-page"></div>
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.dcjqaccordion.2.7.js"></script>
		<script src="js/jquery.scrollTo.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>
		<script src="assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script><!-- BOOTSTRAP DATEPICKER JS  -->
    <script src="assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script><!-- BOOTSTRAP DATETIMEPICKER JS  -->
    <script src="js/jquery.autocompleter.js"></script>
		<script src="js/common-scripts.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/common.js?verson=1"></script>
		<script>
			$("#load-mycommission-ovst-accounting-view-page").load("mycommission-ovst-common-view.html?random="+Math.random());
			tb.isLogin("mycommission-ovst-accounting.html");
			$("td,th").addClass("text-center");
			var v = new Vue({
				el: '#mycommission-ovst-accounting',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),
					adviser_id: sessionStorage.getItem("adviser_id"),
					official_id: sessionStorage.getItem("official_id"),
					mara_id: sessionStorage.getItem("mara_id"),
					kj_id: sessionStorage.getItem("kj_id"),
					commission_state: getRequest('commission_state'),
					commission_list: getRequest('list'),
					is_select : localStorage.is_select,
					orderId: 0,
					total_amount: 0.00,
					total_expectamount: 0.00,
					total_sureexpectamount: 0.00,
					total_bonus: 0.00,
					set_state: '',
					set_type: 1,
					order_detail: [],
					subject: [],
					subject_tmp: [],
					count: 0,					
					name: '',
					schoolId: 0,
					isSettle: '',
					state: '',
					update_field: '',					
					update_byid: '',
					is_multiple: 0,					
					pageNum: 0,
					pageSize: 20,
					allPage: 0,
					current_index: '',
					current_row: '',
					index: 0					
				},
				created: function() {
					if (this.kj_id == 'null')
					{
							setTimeout(function(){alert('没有权限访问此页面，请关闭对话框。');window.location.href = "mycommission.html";}, 2000);
					}else
					{
							$('.default-date-picker1').datepicker({   				
						        format: 'yyyy-mm-dd',
						        endDate: new Date()
						  });
							this.getDatalist();
							document.onkeydown = function(e) {
								var key = window.event.keyCode;
								if (key == 13) v.gotoPage();
							};
					}
				},
				methods: {					
					getDatalist1: function() {
						var that = this;
						var json = {};
						json['keyword'] = that.name;
						if (that.commission_list != 'TQKY')
						{
								json['commissionState'] = that.commission_list;
						}else
						{
								json['isSettle'] = true;
						}
						$.get(url + "commissionOrder/count", json, function(result) {
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
						});
						json['pageNum'] = that.pageNum;
						json['pageSize'] = that.pageSize;
						$.get(url + "commissionOrder/list", json, function(result) {							
							//that.pageNum = 0;
							result.data = return_result(result);
							that.subject = result.data;
							that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
							//console.log(that.subject);
						});
					},
					getSearch: function() {
						var that = this;
						that.pageNum = 0;
						that.pnumber = null;
						that.getDatalist();
					},
					getDatalist: function() {
						var that = this;
						var json = {};
						show_loading();
						if (that.id != '') json['id'] = that.id
						if (that.name != '') json['name'] = that.name;
						if (that.phone != '') json['phone'] = that.phone;
						if (that.wechatUsername != '') json['wechatUsername'] = that.wechatUsername;
						if (that.adviserId != '0')
						{
								json['adviserId'] = that.adviserId;
								//v.adviser_id = that.adviserId;
						}
						if (that.schoolId != '0')
						{
								json['schoolId'] = that.schoolId;
								v.schoolId = that.schoolId;
						}
						if (that.isSettle != '')
						{
								json['isSettle'] = that.isSettle;
								v.isSettle = that.isSettle;
						}
						if (that.type != '') json['type'] = that.type;
						if (that.commission_list != 'TQKY')
						{
								json['commissionState'] = that.commission_list;
						}else
						{
								if (that.isSettle == '') json['isSettle'] = true;
						}
						if (that.startKjApprovalDate != '') json['startKjApprovalDate'] = that.startKjApprovalDate;
						if (that.endKjApprovalDate != '') json['endKjApprovalDate'] = that.endKjApprovalDate;
						if (that.ap_list != 'GW' && that.regionId != '') json['regionId'] = that.regionId;
						
						$.get(url + "commissionOrder/count", json, function(result) {
							that.count = result.data;
							that.allPage = Math.ceil(result.data / that.pageSize);
						});
						json['pageNum'] = 0;
						json['pageSize'] = that.pageSize;
						$.get(url + "commissionOrder/list", json, function(result) {
							that.pageNum = 0;
							result.data = return_result(result);
							that.subject = result.data;
							that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
							$('#loading_id').modal('hide');
						});
					},					
					getExport: function() {
						var that = this;
						var json = {};						
						var down_url = url + "commissionOrder/down?";
						show_loading();
						if (typeof(that.id) != "undefined")
						{
								down_url += "id="+that.id;
						}else
						{
								down_url += "id=";
						}
						if (typeof(that.name) != "undefined")
						{
								down_url += "&name="+that.name;
						}else
						{
								down_url += "&name=";
						}
						if (typeof(that.phone) != "undefined")
						{
								down_url += "&phone="+that.phone;
						}else
						{
								down_url += "&phone=";
						}
						if (typeof(that.wechatUsername) != "undefined")
						{
								down_url += "&wechatUsername="+that.wechatUsername;
						}else
						{
								down_url += "&wechatUsername=";
						}
						if (typeof(that.adviserId) != "undefined")
						{
								down_url += "&adviserId="+that.adviserId;
						}else
						{
								down_url += "&adviserId=";
						}
						if (that.isSettle != '')
						{
								down_url += "&isSettle="+that.isSettle;							
						}									
						if (typeof(that.schoolId) != "undefined")
						{
								down_url += "&schoolId="+that.schoolId;
						}else
						{
								down_url += "&schoolId=";
						}
						if (typeof(that.startKjApprovalDate) != "undefined")
						{
								down_url += "&startKjApprovalDate="+that.startKjApprovalDate;
						}else
						{
								down_url += "&startKjApprovalDate=";
						}
						if (typeof(that.endKjApprovalDate) != "undefined")
						{
								down_url += "&endKjApprovalDate="+that.endKjApprovalDate;
						}else
						{
								down_url += "&endKjApprovalDate=";
						}						
						if (that.commission_list != 'TQKY')
						{
								down_url += "&commissionState="+that.commission_list;
						}else
						{
								down_url += "&commissionState="+that.commission_state;
								if (that.isSettle == '') down_url += "&isSettle=true";
						}
						if (that.ap_list != 'GW' && typeof(that.regionId) != "undefined")
						{
								down_url += "&regionId="+that.regionId;
						}else
						{
								down_url += "&regionId=";
						}
						console.log(down_url);
						var a = document.createElement('a');
						a.download = 'commission_all_data.xls';
						a.href = down_url;
						$("body").append(a);
						a.click();
						$(a).remove();
						setTimeout(function(){$('#loading_id').modal('hide');}, 3000);
					},
					getTime: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						if (y == '1970') return '';
						var date2 = d+"/"+m+"/"+y;
						return date2;
					},
					getTime1: function(d) {
						var date1 = new Date(d);
						var y = date1.getFullYear();
						var m = this.addZero(date1.getMonth() + 1);
						var d = this.addZero(date1.getDate());
						var h = this.addZero(date1.getHours());
						var m2 = this.addZero(date1.getMinutes());
						var s = this.addZero(date1.getSeconds());
						//var date2 = y + "-" + m + "-" + d;
						var date2 = d+"/"+m+"/"+y+' '+h+':'+m2+':'+s;
						return date2;
					},
					addZero: function(obj) {
						if(obj < 10) {
							obj = '0' + obj;
						};
						return obj;
					},
					firstPage: function() {
						var that = this;
						var json = {};
						if (that.name != '') json['name'] = that.name;
						if (that.phone != '') json['phone'] = that.phone;
						if (that.wechatUsername != '') json['wechatUsername'] = that.wechatUsername;
						if (that.adviserId != '0')
						{
								json['adviserId'] = that.adviserId;
								v.adviser_id = that.adviserId;
						}
						if (that.schoolId != '0')
						{
								json['schoolId'] = that.schoolId;
								v.schoolId = that.schoolId;
						}
						if (that.isSettle != '')
						{
								json['isSettle'] = that.isSettle;
								v.isSettle = that.isSettle;
						}
						if (that.type != '') json['type'] = that.type;
						if (that.commission_list != 'TQKY')
						{
								json['commissionState'] = that.commission_list;
						}else
						{
								if (that.isSettle == '') json['isSettle'] = true;
						}
						if (that.regionId != '') json['regionId'] = that.regionId;
						if (that.startKjApprovalDate != '') json['startKjApprovalDate'] = that.startKjApprovalDate;
						if (that.endKjApprovalDate != '') json['endKjApprovalDate'] = that.endKjApprovalDate;
						
						json['pageNum'] = 0;
						json['pageSize'] = that.pageSize;
						if(that.pageNum > 0) {
							$.get(url + "commissionOrder/list", json, function(result) {
								console.log(result)
								that.pageNum = 0;
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
							});
						}
					},
					prevPage: function() {
						var that = this;
						if(that.pageNum > 0) {
							that.pageNum--;
							var json = {};
							if (that.name != '') json['name'] = that.name;
							if (that.phone != '') json['phone'] = that.phone;
							if (that.wechatUsername != '') json['wechatUsername'] = that.wechatUsername;
							if (that.adviserId != '0')
							{
									json['adviserId'] = that.adviserId;
									v.adviser_id = that.adviserId;
							}
							if (that.schoolId != '0')
							{
									json['schoolId'] = that.schoolId;
									v.schoolId = that.schoolId;
							}
							if (that.isSettle != '')
							{
									json['isSettle'] = that.isSettle;
									v.isSettle = that.isSettle;
							}
							if (that.type != '') json['type'] = that.type;
							if (that.commission_list != 'TQKY')
							{
									json['commissionState'] = that.commission_list;
							}else
							{
									if (that.isSettle == '') json['isSettle'] = true;
							}
							if (that.regionId != '') json['regionId'] = that.regionId;
							if (that.startKjApprovalDate != '') json['startKjApprovalDate'] = that.startKjApprovalDate;
							if (that.endKjApprovalDate != '') json['endKjApprovalDate'] = that.endKjApprovalDate;
						
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;
							$.get(url + "commissionOrder/list", json, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
							});
						}
					},
					nextPage: function() {
						var that = this;
						if(that.pageNum < that.allPage - 1) {
							that.pageNum++;
							var json = {};
							if (that.name != '') json['name'] = that.name;
							if (that.phone != '') json['phone'] = that.phone;
							if (that.wechatUsername != '') json['wechatUsername'] = that.wechatUsername;
							if (that.adviserId != '0')
							{
									json['adviserId'] = that.adviserId;
									v.adviser_id = that.adviserId;
							}
							if (that.schoolId != '0')
							{
									json['schoolId'] = that.schoolId;
									v.schoolId = that.schoolId;
							}
							if (that.isSettle != '')
							{
									json['isSettle'] = that.isSettle;
									v.isSettle = that.isSettle;
							}
							if (that.type != '') json['type'] = that.type;
							if (that.commission_list != 'TQKY')
							{
									json['commissionState'] = that.commission_list;
							}else
							{
									if (that.isSettle == '') json['isSettle'] = true;
							}
							if (that.regionId != '') json['regionId'] = that.regionId;
							if (that.startKjApprovalDate != '') json['startKjApprovalDate'] = that.startKjApprovalDate;
							if (that.endKjApprovalDate != '') json['endKjApprovalDate'] = that.endKjApprovalDate;
							
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;
							$.get(url + "commissionOrder/list", json, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
							});
						}
					},
					lastPage: function() {
						var that = this;
						if(that.pageNum < that.allPage - 1) {
							var json = {};
							if (that.name != '') json['name'] = that.name;
							if (that.phone != '') json['phone'] = that.phone;
							if (that.wechatUsername != '') json['wechatUsername'] = that.wechatUsername;
							if (that.adviserId != '0')
							{
									json['adviserId'] = that.adviserId;
									v.adviser_id = that.adviserId;
							}
							if (that.schoolId != '0')
							{
									json['schoolId'] = that.schoolId;
									v.schoolId = that.schoolId;
							}
							if (that.isSettle != '')
							{
									json['isSettle'] = that.isSettle;
									v.isSettle = that.isSettle;
							}
							if (that.type != '') json['type'] = that.type;
							if (that.commission_list != 'TQKY')
							{
									json['commissionState'] = that.commission_list;
							}else
							{
									if (that.isSettle == '') json['isSettle'] = true;
							}
							if (that.regionId != '') json['regionId'] = that.regionId;
							if (that.startKjApprovalDate != '') json['startKjApprovalDate'] = that.startKjApprovalDate;
							if (that.endKjApprovalDate != '') json['endKjApprovalDate'] = that.endKjApprovalDate;
							
							json['pageNum'] = that.allPage - 1;
							json['pageSize'] = that.pageSize;
							$.get(url + "commissionOrder/list", json, function(result) {
								console.log(result)
								that.pageNum = that.allPage - 1;
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
							});
						}
					},
					gotoPage: function() {
						var that = this;
						var json = {};
						if (that.name != '') json['name'] = that.name;
						if (that.phone != '') json['phone'] = that.phone;
						if (that.wechatUsername != '') json['wechatUsername'] = that.wechatUsername;
						if (that.adviserId != '0')
						{
								json['adviserId'] = that.adviserId;
								v.adviser_id = that.adviserId;
						}
						if (that.schoolId != '0')
						{
								json['schoolId'] = that.schoolId;
								v.schoolId = that.schoolId;
						}
						if (that.isSettle != '')
						{
								json['isSettle'] = that.isSettle;
								v.isSettle = that.isSettle;
						}
						if (that.type != '') json['type'] = that.type;
						if (that.commission_list != 'TQKY')
						{
								json['commissionState'] = that.commission_list;
						}else
						{
								if (that.isSettle == '') json['isSettle'] = true;
						}
						if (that.regionId != '') json['regionId'] = that.regionId;
						if (that.startKjApprovalDate != '') json['startKjApprovalDate'] = that.startKjApprovalDate;
						if (that.endKjApprovalDate != '') json['endKjApprovalDate'] = that.endKjApprovalDate;
						
						that.pageNum = parseInt(that.pnumber);
						if (that.pageNum > that.allPage)
						{
								that.pnumber = that.allPage;
								that.pageNum = that.allPage;
						}						
						if(that.pageNum <= that.allPage) {
							show_loading();
							that.pageNum = that.pageNum - 1;
							json['pageNum'] = that.pageNum;
							json['pageSize'] = that.pageSize;
							$.get(url + "commissionOrder/list", json, function(result) {
								console.log(result)
								result.data = return_result(result);
								that.subject = result.data;
								that.$nextTick(function(){ $('[data-original-title=""]').popover(); });
								$('#loading_id').modal('hide');
							});
						}
					},
					table_modify: function (index) {
						v.orderId = this.subject[index].id;						
						if (this.current_index != null)
						{
								this.subject[this.current_index] = this.current_row;
						}
						this.current_index = index;
						this.current_row = this.subject[index];
						var json = {};
						json['strOid'] = this.subject[index].id+'-'+this.subject[index].installmentNum;
						json['gmtCreate'] = this.subject[index].gmtCreate;
						json['kjApprovalDate'] = this.subject[index].kjApprovalDate;
						json['receiveDate'] = this.subject[index].receiveDate;
						json['userName'] = this.subject[index].userName;
						json['studentCode'] = this.subject[index].studentCode;
						json['receiveTypeName'] = this.subject[index].receiveTypeName;
						json['serviceName'] = this.subject[index].serviceName;
						json['strSettle'] = this.subject[index].strSettle;
						json['schoolName'] = this.subject[index].schoolName;
						json['schoolSubject'] = this.subject[index].schoolSubject;
						json['installmentDueDate'] = this.subject[index].installmentDueDate;
						json['receiveTypeName'] = this.subject[index].receiveTypeName;
						json['tuitionFee'] = this.subject[index].tuitionFee;
						json['perAmount'] = this.subject[index].perAmount;
						json['totalPerAmount'] = this.subject[index].totalPerAmount;
						json['totalAmount'] = this.subject[index].totalAmount;						
						json['amount'] = this.subject[index].amount;
						json['expectAmount'] = this.subject[index].expectAmount;
						if (this.subject[index].settle)
						{
								json['sureExpectAmount'] = '<input type="text" class="form-control small" style="width:120px;" id="t3a" value="'+this.subject[index].sureExpectAmount+'">';
						}else
						{
								json['sureExpectAmount'] = this.subject[index].sureExpectAmount;
						}
						json['gst'] = this.subject[index].gst;
						json['deductGst'] = this.subject[index].deductGst;
						json['schoolPaymentAmount'] = this.subject[index].schoolPaymentAmount;
						json['schoolPaymentDate'] = this.subject[index].schoolPaymentDate;
						json['invoiceNumber'] = this.subject[index].invoiceNumber;
						json['zyDate'] = this.subject[index].zyDate;
						json['subagencyName'] = this.subject[index].subagencyName;
						json['bankDate'] = this.subject[index].bankDate;
						json['bonus'] = '<input type="text" class="form-control small" style="width:120px;" id="t1" value="'+this.subject[index].bonus+'">';
						json['bonusDate'] = '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:120px;" id="t2" data-date-format="dd-mm-yyyy" value="'+this.subject[index].bonusDate+'">';
						json['adviserName'] = this.subject[index].adviserName;
						json['strState'] = this.subject[index].strState;
						json['type'] = 1;
						this.subject.splice(index,1, json);																					
					},					
					table_modify1: function (index) {
						v.orderId = this.subject[index].id;										
						if (this.current_index != null)
						{
								this.subject[this.current_index] = this.current_row;
						}
						this.current_index = index;
						this.current_row = this.subject[index];
						if (this.subject[index].invoiceNumber == null) this.subject[index].invoiceNumber = '';				
						this.subject.splice(index,1, {
							strOid: this.subject[index].id+'-'+this.subject[index].installmentNum,
							gmtCreate: this.subject[index].gmtCreate,
							kjApprovalDate: this.subject[index].kjApprovalDate,
							receiveDate: this.subject[index].receiveDate,
							userName: this.subject[index].userName,
							studentCode: this.subject[index].studentCode,							
							serviceName: this.subject[index].serviceName,
							strSettle: this.subject[index].strSettle,
							schoolName: this.subject[index].schoolName,
							schoolSubject: this.subject[index].schoolSubject,
							installmentDueDate: this.subject[index].installmentDueDate,
							receiveTypeName: this.subject[index].receiveTypeName,
							tuitionFee: this.subject[index].tuitionFee,
							perAmount: this.subject[index].perAmount,
							totalPerAmount: this.subject[index].totalPerAmount,
							totalAmount: this.subject[index].totalAmount,
							amount: this.subject[index].amount,
							expectAmount: this.subject[index].expectAmount,
							gst: this.subject[index].gst,
							deductGst: this.subject[index].deductGst,
							schoolPaymentAmount: '<input type="text" class="form-control small" style="width:120px;" id="d1" value="'+this.subject[index].schoolPaymentAmount+'">',
							schoolPaymentDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:120px;" id="d2" data-date-format="dd-mm-yyyy" value="'+this.subject[index].schoolPaymentDate+'">',
							invoiceNumber: '<input type="text" class="form-control small" style="width:120px;" id="d3" value="'+this.subject[index].invoiceNumber+'">',
							zyDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:120px;" id="d4" data-date-format="dd-mm-yyyy" value="'+this.subject[index].zyDate+'">',
							subagencyName: this.subject[index].subagencyName,
							bankDate: this.subject[index].bankDate,
							bonus: this.subject[index].bonus,
							bonusDate: this.subject[index].bonusDate,
							adviserName: this.subject[index].adviserName,
							strState: this.subject[index].strState,
							type: 1,
						});															
					},									
					table_edit: function (index,field,byid) {
						if (field == 'sureExpectAmount'  && !this.subject[index].settle) return;						
						if (this.current_index != null)
						{
								this.subject[this.current_index] = this.current_row;
						}						
						v.update_field = field;
						v.update_byid = byid;
						this.current_index = index;
						this.current_row = this.subject[index];
						v.orderId = this.subject[index].id;
						var json = {};
						json['strOid'] = this.subject[index].id+'-'+this.subject[index].installmentNum;
						json['gmtCreate'] = this.subject[index].gmtCreate;
						json['kjApprovalDate'] = this.subject[index].kjApprovalDate;						
						json['receiveDate'] = this.subject[index].receiveDate;
						json['userName'] = this.subject[index].userName;
						json['studentCode'] = this.subject[index].studentCode;
						json['receiveTypeName'] = this.subject[index].receiveTypeName;
						json['serviceName'] = this.subject[index].serviceName;
						json['strSettle'] = this.subject[index].strSettle;
						json['schoolName'] = this.subject[index].schoolName;
						json['schoolSubject'] = this.subject[index].schoolSubject;
						json['installmentDueDate'] = this.subject[index].installmentDueDate;
						json['receiveTypeName'] = this.subject[index].receiveTypeName;
						json['tuitionFee'] = this.subject[index].tuitionFee;
						json['perAmount'] = this.subject[index].perAmount;
						json['totalPerAmount'] = this.subject[index].totalPerAmount;
						json['totalAmount'] = this.subject[index].totalAmount;						
						json['amount'] = this.subject[index].amount;
						json['expectAmount'] = this.subject[index].expectAmount;						
						if (field == 'sureExpectAmount')
						{
								json['sureExpectAmount'] = '<input type="text" class="form-control small" style="width:120px;" id="'+byid+'" value="'+this.subject[index].sureExpectAmount+'">';
						}else
						{
								json['sureExpectAmount'] = this.subject[index].sureExpectAmount;
						}
						if (field == 'bankCheck')
						{
								json['bankCheck'] = '<input type="text" class="form-control small" style="width:120px;" id="'+byid+'" value="'+(this.subject[index].bankCheck  == null ?  '':this.subject[index].bankCheck)+'">';
						}else
						{								
								json['bankCheck'] = (this.subject[index].bankCheck  == null ?  '':this.subject[index].bankCheck);
						}
						if (field == 'isChecked')
						{
								json['isChecked'] = '<select class="form-control" style="width:180px;" id="'+byid+'"></select>';
						}else
						{
								json['isChecked'] = (!this.subject[index].checked ?  '':this.subject[index].checked);
						}
						if (field == 'kjApprovalDate')
						{
								json['kjApprovalDate'] = '<input type="text" class="form-control small default-date-picker" style="width:170px;" id="'+byid+'" value="'+(this.subject[index].kjApprovalDate  == null ?  '':this.subject[index].kjApprovalDate)+'">';
						}else
						{								
								json['kjApprovalDate'] = (this.subject[index].kjApprovalDate  == null ?  '':this.subject[index].kjApprovalDate);
						}
						json['gst'] = this.subject[index].gst;
						json['deductGst'] = this.subject[index].deductGst;
						json['schoolPaymentAmount'] = this.subject[index].schoolPaymentAmount;
						json['schoolPaymentDate'] = this.subject[index].schoolPaymentDate;
						json['invoiceNumber'] = this.subject[index].invoiceNumber;
						json['zyDate'] = this.subject[index].zyDate;
						json['subagencyName'] = this.subject[index].subagencyName;
						json['bankDate'] = this.subject[index].bankDate;
						json['bonus'] = this.subject[index].bonus;
						json['bonusDate'] = this.subject[index].bonusDate;
						json['adviserName'] = this.subject[index].adviserName;
						json['strState'] = this.subject[index].strState;						
						json['type'] = 0;
						this.subject.splice(index,1, json);															
					},
					multiple_edit: function () {						
						if (!this.is_multiple)
						{
								$("#show_multiple").show();
								for(var index=0;index < this.subject.length;index++)
								{
										if (this.subject[index].invoiceNumber == null) this.subject[index].invoiceNumber = '';	
										this.subject_tmp[index] = this.subject[index];
										this.subject.splice(index,1, {
										Oid: this.subject[index].id,
										strOid: this.subject[index].id+'-'+this.subject[index].installmentNum,
										gmtCreate: this.subject[index].gmtCreate,
										kjApprovalDate: this.subject[index].kjApprovalDate,
										receiveDate: this.subject[index].receiveDate,
										userName: this.subject[index].userName,
										studentCode: this.subject[index].studentCode,							
										serviceName: this.subject[index].serviceName,
										strSettle: this.subject[index].strSettle,
										schoolName: this.subject[index].schoolName,
										schoolSubject: this.subject[index].schoolSubject,
										installmentDueDate: this.subject[index].installmentDueDate,
										receiveTypeName: this.subject[index].receiveTypeName,
										tuitionFee: this.subject[index].tuitionFee,
										perAmount: this.subject[index].perAmount,
										totalPerAmount: this.subject[index].totalPerAmount,
										totalAmount: this.subject[index].totalAmount,
										amount: this.subject[index].amount,
										expectAmount: this.subject[index].expectAmount,
										gst: this.subject[index].gst,
										deductGst: this.subject[index].deductGst,
										schoolPaymentAmount: '<input type="text" class="form-control small" style="width:120px;" id="d1_'+this.subject[index].id+'" value="'+this.subject[index].schoolPaymentAmount+'">',
										schoolPaymentDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:120px;" id="d2_'+this.subject[index].id+'" data-date-format="dd-mm-yyyy" value="'+this.subject[index].schoolPaymentDate+'">',
										invoiceNumber: '<input type="text" class="form-control small" style="width:120px;" id="d3_'+this.subject[index].id+'" value="'+this.subject[index].invoiceNumber+'">',
										zyDate: '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:120px;" id="d4_'+this.subject[index].id+'" data-date-format="dd-mm-yyyy" value="'+this.subject[index].zyDate+'">',
										subagencyName: this.subject[index].subagencyName,
										bankDate: this.subject[index].bankDate,
										bonus: this.subject[index].bonus,
										bonusDate: this.subject[index].bonusDate,
										adviserName: this.subject[index].adviserName,
										strState: this.subject[index].strState,
										type: 1,
									});
								}
						}
						this.is_multiple = 1;
					},					
					multiple_save: function () {
						var f = '#list_ovst ';
						var json = {};
						var str_json = '';								
						for(var index=0;index < this.subject.length;index++)
						{
								var oid = parseInt(this.subject[index].Oid);
								json['id'] = oid;
								json['schoolPaymentAmount'] = $(f+'#d1_'+oid).val();
								var d2 = $(f+'#d2_'+oid).val();
	       				if (d2 != '')
		        		{
			          		var arr_d = d2.split("/");
			          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
			              var date = new Date(str_d);
			              json['schoolPaymentDate'] = date.getTime();
		          	}else
		          	{
	       						json['schoolPaymentDate'] = 0;      				
	       				}
	       				var d3 = $(f+'#d3_'+oid).val();
       					if (d3 != '') json['invoiceNumber'] = d3;
       					var d4 = $(f+'#d4_'+oid).val();
	       				if (d4 != '')
		        		{
			          		var arr_d = d4.split("/");
			          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
			              var date = new Date(str_d);
			              json['zyDate'] = date.getTime();
		          	}else
		          	{
	       						json['zyDate'] = 0;      				
	       				}
       					if (str_json == '')
       					{
       							str_json += JSON.stringify(json);
       					}else
       					{
       							str_json += ','+JSON.stringify(json);
       					}
						}						
						str_json = '['+str_json+']';
						$("#show_multiple #btn_multiple_save").attr("disabled","disabled");
						$("#show_multiple #show_info").show();
						var str_url = url + "commissionOrder/update";
						$.ajax({ 
		            type:"PUT", 
		            url: str_url, 
		            contentType:"application/json",      
		            dataType:"json",
		            data: str_json, 
		            success:function(data)
		            {
		            		if (data.code == 0)
						   			{
						   					$("#show_multiple #show_info").html('批量保存成功');
						   					setTimeout(function(){$("#show_multiple").hide();v.getDatalist();}, 1000);
						   					//setTimeout(function(){window.location.href = "mycommission-ovst-accounting.html?commission_state=DZY&list=DZY";}, 3000);
						   			}else
						   			{
						   					$("#show_multiple #btn_multiple_save").removeAttr("disabled");
						   					$("#show_multiple #show_info").html("接口报错："+data.message);
						   			}
		          	}
          	});					
						this.is_multiple = 0;
					},
					multiple_edit1: function () {						
						if (!this.is_multiple)
						{
								$("#show_multiple1").show();
								for(var index=0;index < this.subject.length;index++)
								{
										this.subject_tmp[index] = this.subject[index];
										if (this.subject[index].schoolPaymentAmount && this.subject[index].schoolPaymentDate)
										{
												var json = {};
												json['Oid'] = this.subject[index].id;
												json['strOid'] = this.subject[index].id+'-'+this.subject[index].installmentNum;
												json['gmtCreate'] = this.subject[index].gmtCreate;
												json['kjApprovalDate'] = this.subject[index].kjApprovalDate;
												json['receiveDate'] = this.subject[index].receiveDate;
												json['userName'] = this.subject[index].userName;
												json['studentCode'] = this.subject[index].studentCode;
												json['receiveTypeName'] = this.subject[index].receiveTypeName;
												json['serviceName'] = this.subject[index].serviceName;
												json['strSettle'] = this.subject[index].strSettle;
												json['schoolName'] = this.subject[index].schoolName;
												json['schoolSubject'] = this.subject[index].schoolSubject;
												json['installmentDueDate'] = this.subject[index].installmentDueDate;
												json['receiveTypeName'] = this.subject[index].receiveTypeName;
												json['tuitionFee'] = this.subject[index].tuitionFee;
												json['perAmount'] = this.subject[index].perAmount;
												json['totalPerAmount'] = this.subject[index].totalPerAmount;
												json['totalAmount'] = this.subject[index].totalAmount;						
												json['amount'] = this.subject[index].amount;
												json['expectAmount'] = this.subject[index].expectAmount;
												if (this.subject[index].settle)
												{
														json['sureExpectAmount'] = '<input type="text" class="form-control small" style="width:120px;" id="t3a_'+this.subject[index].id+'" value="'+this.subject[index].sureExpectAmount+'">';
												}else
												{
														json['sureExpectAmount'] = this.subject[index].sureExpectAmount;
												}
												json['gst'] = this.subject[index].gst;
												json['deductGst'] = this.subject[index].deductGst;
												json['schoolPaymentAmount'] = this.subject[index].schoolPaymentAmount;
												json['schoolPaymentDate'] = this.subject[index].schoolPaymentDate;
												json['invoiceNumber'] = this.subject[index].invoiceNumber;
												json['zyDate'] = this.subject[index].zyDate;
												json['subagencyName'] = this.subject[index].subagencyName;
												json['bankDate'] = this.subject[index].bankDate;									
												json['bonus'] = '<input type="text" class="form-control small" style="width:120px;" id="t1_'+this.subject[index].id+'" value="'+(this.subject[index].bonus ? this.subject[index].bonus:'')+'">';
												json['bonusDate'] = '<input type="text" autocomplete="off" class="form-control small default-date-picker" style="width:120px;" id="t2_'+this.subject[index].id+'" data-date-format="dd-mm-yyyy" value="'+this.subject[index].bonusDate+'">';
												json['adviserName'] = this.subject[index].adviserName;
												json['strState'] = this.subject[index].strState;
												json['type'] = 1;
												this.subject.splice(index,1, json);
										}										
								}
						}
						this.is_multiple = 1;
					},
					multiple_save1: function () {
						var f = '#list_ovst ';
						var json = {};
						var str_json = '';								
						for(var index=0;index < this.subject.length;index++)
						{								
								if (this.subject[index].schoolPaymentAmount && this.subject[index].schoolPaymentDate)
								{
										var oid = parseInt(this.subject[index].Oid);
										json['id'] = oid;
										var t3a = $(f+'#t3a_'+oid).val();
		       					if (t3a != '') json['sureExpectAmount'] = t3a;
		       					var t1 = $(f+'#t1_'+oid).val();
		       					json['bonus:'] = t1;
										var t2 = $(f+'#t2_'+oid).val();
			       				if (t2 != '')
				        		{
					          		var arr_d = t2.split("/");
					          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
					              var date = new Date(str_d);
					              json['bonusDate'] = date.getTime();
				          	}else
				          	{
			       						json['bonusDate'] = 0;      				
			       				}	       				       					
		       					if (str_json == '')
		       					{
		       							str_json += JSON.stringify(json);
		       					}else
		       					{
		       							str_json += ','+JSON.stringify(json);
		       					}
       					}
						}								
						str_json = '['+str_json+']';
						$("#show_multiple1 #btn_multiple_save").attr("disabled","disabled");
						$("#show_multiple1 #show_info").show();
						var str_url = url + "commissionOrder/kjUpdate";
						$.ajax({ 
		            type:"PUT", 
		            url: str_url, 
		            contentType:"application/json",      
		            dataType:"json",
		            data: str_json, 
		            success:function(data)
		            {
		            		if (data.code == 0)
						   			{
						   					$("#show_multiple1 #show_info").html('批量保存成功');
						   					setTimeout(function(){$("#show_multiple").hide();v.getDatalist();}, 1000);
						   					//setTimeout(function(){window.location.href = "mycommission-ovst-accounting.html?commission_state=DJY&list=DJY,DZY,YZY";}, 3000);
						   			}else
						   			{
						   					$("#show_multiple1 #btn_multiple_save").removeAttr("disabled");
						   					$("#show_multiple1 #show_info").html("接口报错："+data.message);
						   			}
		          	}
          	});					
						this.is_multiple = 0;
					},
					multiple_remove: function () {
						this.is_multiple = 0;					
						for(var index=0;index < this.subject.length;index++)
						{								
								this.subject.splice(index, 0);
								this.subject.splice(index,1,this.subject_tmp[index]);
						}
						$("#show_multiple").hide();
					},
					multiple_remove1: function () {
						this.is_multiple = 0;					
						for(var index=0;index < this.subject.length;index++)
						{								
								this.subject.splice(index, 0);
								this.subject.splice(index,1,this.subject_tmp[index]);
						}
						$("#show_multiple1").hide();
					},			
					table_remove: function (index) {
             this.subject.splice(index, 1);  
          }
				}		
			});
			
			function return_result(result)
			{
				v.total_amount = 0;
				v.total_expectamount = 0;
				v.total_sureexpectamount = 0;
				v.total_bonus = 0;
				for(var i = 0; i < result.data.length; i++) {
						var str_state = '';
						result.data[i].oid = result.data[i].id;
						result.data[i].strOid = '<a href="javascript:open_detail('+result.data[i].serviceOrderId+','+result.data[i].id+');" title="查看详细">'+result.data[i].id+'</a>-<span id="installmentNum'+result.data[i].id+'">'+result.data[i].installmentNum+'</span>';
						if (v.is_select == 'yes') result.data[i].strOid += '<br/><input type="checkbox" name="ids[]" value="'+result.data[i].id+'" />';
						result.data[i].gmtCreate = v.getTime(result.data[i].gmtCreate);
						result.data[i].birthday = v.getTime(result.data[i].birthday);
						result.data[i].startDate = v.getTime(result.data[i].startDate);
						result.data[i].kjApprovalDate = v.getTime1(result.data[i].kjApprovalDate);
						//result.data[i].finishDate = result.data[i].finishDate ? v.getTime(result.data[i].finishDate):'';
						result.data[i].receiveDate = result.data[i].receiveDate ? v.getTime(result.data[i].receiveDate):'';
						//是否已对账
						result.data[i].schoolPaid = false;
						result.data[i].strSchoolPaid = '否';
						if (result.data[i].schoolPaymentAmount && result.data[i].schoolPaymentDate)
						{
								result.data[i].schoolPaid = true;
								result.data[i].strSchoolPaid = '是';
						}						
						result.data[i].schoolPaymentAmount = result.data[i].schoolPaymentAmount ? result.data[i].schoolPaymentAmount:'';
						result.data[i].schoolPaymentDate = result.data[i].schoolPaymentDate ? v.getTime(result.data[i].schoolPaymentDate):'';
						result.data[i].subagencyName = (result.data[i].subagencyId ? result.data[i].subagency.name :'');
						result.data[i].bonusDate = result.data[i].bonusDate ? v.getTime(result.data[i].bonusDate):'';
						result.data[i].zyDate = result.data[i].zyDate ? v.getTime(result.data[i].zyDate):'';
						result.data[i].userName = result.data[i].user.name;
						if (result.data[i].sureExpectAmount == '0') result.data[i].sureExpectAmount = result.data[i].expectAmount;
						result.data[i].serviceName = '留学';
						if (result.data[i].settle)
						{
								result.data[i].strSettle = '是';
								result.data[i].schoolPaid = true;
								result.data[i].strSchoolPaid = '是';
						}else
						{
								result.data[i].strSettle = '否';
								if (v.commission_state != 'TQKY') result.data[i].sureExpectAmount = (result.data[i].schoolPaymentAmount ? result.data[i].schoolPaymentAmount:0);
						}
						result.data[i].schoolName = result.data[i].school.name;
						result.data[i].schoolSubject = result.data[i].school.subject;
						result.data[i].installmentDueDate = result.data[i].installmentDueDate ? v.getTime(result.data[i].installmentDueDate):'';
						result.data[i].receiveTypeName = result.data[i].receiveType.name;
						if (result.data[i].state == 'PENDING')
						{
								result.data[i].amount = 0.00;
								result.data[i].expectAmount = 0.00;
								result.data[i].sureExpectAmount = 0.00;
								result.data[i].bonus = 0.00;
						}
						v.total_amount += result.data[i].amount;
						v.total_expectamount += result.data[i].expectAmount;
						v.total_sureexpectamount += result.data[i].sureExpectAmount;
						v.total_bonus += result.data[i].bonus;					
						result.data[i].adviserName = result.data[i].adviser.name;
						result.data[i].strState = return_state(result.data[i].state);
						result.data[i].currentState = result.data[i].state;
						if (result.data[i].remarks) result.data[i].remarks = url_replace1(result.data[i].remarks);
						result.data[i].strRemarks = '<button data-original-title="" data-html="true" data-content="'+result.data[i].remarks+'" data-placement="bottom" data-trigger="onclick" class="btn btn-info btn-xs popovers">查看备注</button>';												
						var str_checked = '';
						if (result.data[i].bankCheck)
						{
								str_checked = result.data[i].checked;
								if (!result.data[i].checked) str_checked = '<span style="color:red;">'+result.data[i].checked+'</span>';
								result.data[i].isChecked = str_checked;
						}						
				};
				v.total_amount = v.total_amount.toFixed(2);
				v.total_expectamount = v.total_expectamount.toFixed(2);
				v.total_sureexpectamount = v.total_sureexpectamount.toFixed(2);
				v.total_bonus = v.total_bonus.toFixed(2);
				return result.data;
			}						
      
      function return_state(va)
			{
					var str_html = '';
					switch(va)
					{									
						case 'REVIEW':
									str_html = '待结佣';
						break;											
						case 'COMPLETE':
									str_html = '<label style="color:red;">已结佣</label>';
						break;																	
					}
					return str_html;
      }
      
      $('#list_ovst a.save').live('click', function (e) {
				e.preventDefault();
				table_addsave();
			});
			
			$('#list_ovst a.save1').live('click', function (e) {
				e.preventDefault();
				table_addsave1();
			});
			
			$('#list_ovst a.save2').live('click', function (e) {
				e.preventDefault();
				table_addsave2();
			});
			
			$('#list_ovst a.cancel').live('click', function (e) {
				e.preventDefault();
				v.subject.splice(v.current_index, 0);
				v.subject.splice(v.current_index,1, v.current_row);
			});
			
			function table_addsave()
			{
					var f = '#list_ovst ';
					var check_result = 0;
					
					if ($(f+'#t1').val() != '' && $(f+'#t2').val() != '')
					{
							check_result = true;
					}else
					{
							$('#my_table #alert_error').css('marginLeft','40%');
			    		$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			        $("#my_table #error_info").html('提示：所有字段必须填写或选择！');
			    		return false;
					}
					if (check_result)
    			{    					
			    		var str_url = url + "commissionOrder/kjUpdate";
       				var json = {};
       				json['id'] = v.orderId;
       				json['bonus'] = $(f+'#t1').val();
       				var t2 = $(f+'#t2').val();
       				if (t2 != '')
	        		{
		          		var arr_d = t2.split("/");
		          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
		              var date = new Date(str_d);
		              json['bonusDate'] = date.getTime();
	          	}else
	          	{
       						json['bonusDate'] = 0;      				
       				}
       				var t3a = $(f+'#t3a').val();
       				if (t3a != '') json['sureExpectAmount'] = t3a;
       				show_loading();
       				$.post(str_url, json,
					   	function(data){
					   			$('#loading_id').modal('hide');
					   			if (data.code == 0)
					   			{
					   					$('#my_table #alert_success').css('marginLeft','40%');
					   					$('#my_table #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					v.table_remove();
					   					//重新载入数据源
					   					setTimeout(function(){v.getDatalist();$('.modal-backdrop').remove();}, 1000);
					   			}else
					   			{
					   					$('#my_table #alert_error').css('marginLeft','40%');
					   					$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#my_table #error_info").html(data.message);
				        			return false;
					   			}
					   	});
    			}
			}
			
			function table_addsave1()
			{
					var f = '#list_ovst ';
					var check_result = 0;
					
					//if ($(f+'#d1').val() != '' && $(f+'#d2').val() != '' && $(f+'#d3').val() != '')
					if (f != '')
					{
							check_result = true;
					}else
					{
							$('#my_table #alert_error').css('marginLeft','40%');
			    		$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			        $("#my_table #error_info").html('提示：所有字段必须填写或选择！');
			    		return false;
					}
					if (check_result)
    			{    					
			    		var str_url = url + "commissionOrder/kjUpdate";
			    		if ($(f+'#d1').val() == '' || $(f+'#d2').val() == '') str_url = url + "commissionOrder/update";
       				var json = {};
       				json['id'] = v.orderId;
       				json['schoolPaymentAmount'] = $(f+'#d1').val();
       				var d2 = 0;
       				if ($(f+'#d2').val())
       				{       						
       						var str_d2 = $(f+'#d2').val();
       						var arr_d = str_d2.split("/");
		          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
		              var date = new Date(str_d);
		              d2 = date.getTime();
       				}
       				json['schoolPaymentDate'] = d2;
       				json['invoiceNumber'] = $(f+'#d3').val();
       				var d4 = 0;
       				if ($(f+'#d4').val())
       				{
       						var str_d4 = $(f+'#d4').val();
       						var arr_d = str_d4.split("/");
		          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
		              var date = new Date(str_d);
		              d4= date.getTime();
       				}
       				json['zyDate'] = d4;
       				show_loading();
       				$.post(str_url, json,
					   	function(data){
					   			$('#loading_id').modal('hide');
					   			if (data.code == 0)
					   			{
					   					$('#my_table #alert_success').css('marginLeft','40%');
					   					$('#my_table #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					v.table_remove();
					   					//重新载入数据源
					   					setTimeout(function(){v.getDatalist();$('.modal-backdrop').remove();}, 1000);
					   			}else
					   			{
					   					$('#my_table #alert_error').css('marginLeft','40%');
					   					$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#my_table #error_info").html(data.message);
				        			return false;
					   			}
					   	});
    			}
			}
			
			function table_addsave2()
			{
					var f = '#list_ovst ';
					var check_result = 0;
					var str_val = $(f+'#'+v.update_byid).val();
					var field = v.update_field;
					
					if (str_val != '')
					{														
							check_result = true;							
					}else
					{
							$('#my_table #alert_error').css('marginLeft','40%');
			    		$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			        $("#my_table #error_info").html('提示：字段必须填写或选择！');
			    		return false;
					}
					if (check_result)
    			{    					
			    		var str_url = url + "commissionOrder/update";
       				var json = {};
       				json['id'] = v.orderId;
       				if (field == 'kjApprovalDate')
       				{
       						str_url = url + "commissionOrder/updateKjApprovalDate";
       						var arr_d1 = str_val.split(" ");
       						if (arr_d1.length == 2)
       						{
		       						var arr_d = arr_d1[0].split("/");
				          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
				          		str_d += ' '+arr_d1[1];     		
				              var date = new Date(str_d);
		       						json[v.update_field] = date.getTime();//转时间戳
       						}else
       						{
       								var arr_d = arr_d1[0].split("/");
				          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
				          		str_d += ' 09:00:00';     		
				              var date = new Date(str_d);
				              json[v.update_field] = date.getTime();//转时间戳
       								//alert('时间格式不正确！请核实后再提交。');
       								//return false;
       						}
       				}else
       				{       				      				
       						json[v.update_field] = str_val;
       				}       				
       				$.post(str_url, json,
					   	function(data){
					   			if (data.code == 0)
					   			{
					   					$('#my_table #alert_success').css('marginLeft','40%');
					   					$('#my_table #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
					   					if (field == 'sureExpectAmount') v.current_row.sureExpectAmount = str_val;					   					
					   					if (field == 'bankCheck') v.current_row.bankCheck = str_val;					   					
					   					if (field == 'isChecked') v.current_row.checked = str_val;
					   					if (field == 'kjApprovalDate') v.current_row.kjApprovalDate = str_val;
					   					v.subject.splice(v.current_index, 0);
											v.subject.splice(v.current_index,1, v.current_row);
					   					//重新载入数据源
					   					setTimeout(function(){v.getDatalist();$('.modal-backdrop').remove();}, 1000);
					   			}else
					   			{
					   					$('#my_table #alert_error').css('marginLeft','40%');
					   					$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
			          			$("#my_table #error_info").html(data.message);
				        			return false;
					   			}
					   	});
    			}
			}
			
			v.$watch('subject', function(obj) {
					$('.default-date-picker').datepicker({   				
				        format: 'dd/mm/yyyy'
				  });
				  var checked_val = 'false';
				  if (this.current_row.id)
				  {
				  		$("#id").val(this.current_row.id);
				  		checked_val = this.current_row.checked;
				  }				  
			    //绑定顾问
				  var obj_adviserId = $("#adviserId");
				  $("#adviserId").empty();
	        obj_adviserId.append("<option value='0'>全部</option>");
			    $.ajax({
	          url: url + 'adviser/list?pageNum=0&pageSize=100000',
	          type: 'GET',
	          async: false,
	          dataType: 'json'
	        }).done(function(response) {
	        	//author:bischina
	        	response = response.data;
	        	for (var item in response)
	        	{
	        			obj_adviserId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
	        	}
	        	obj_adviserId.val(v.adviser_id);	
	        });
	        //绑定学校信息
			    var school_name = $("#schoolId");
			    $("#schoolId").empty();
			    school_name.append("<option value='0'>全部</option>");
			    $.ajax({
			      url: url + 'school/listSchool?name=',
			      type: 'GET',
			      async: false,
			      dataType: 'json'
			    }).done(function(response) {
			    	response = response.data;	        	    	
			    	for (var item in response)
			    	{
			    			school_name.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
			    	}	
			    	school_name.val(v.schoolId);
			    });
			    //绑定提前扣佣下拉
			   	var obj_isSettle = $("#isSettle");
			   	$("#isSettle").empty();
			   	obj_isSettle.append("<option value=''>全部</option>");
			   	obj_isSettle.append("<option value='true'>是</option>");
			   	obj_isSettle.append("<option value='false'>否</option>");
			   	obj_isSettle.val(v.isSettle);
			   	//是否自动对账完成
			   	var obj_checked = $("#t3");
	        $("#t3").empty();
			    obj_checked.append('<option value="true">True</option>');
			    obj_checked.append('<option value="false">False</option>');   
			    obj_checked.val(checked_val.toString());
			    //绑定区域列表
			    var obj_regionId = $("#regionId");
			    $("#regionId").empty();
			    obj_regionId.append("<option value='0'>请选择</option>");
			    $.ajax({
	          url: url + 'region/list_all',
	          type: 'GET',
	          dataType: 'json'
	        }).done(function(response) {
	        	var region_data = response.data;
	        	for (var item in region_data)
	        	{
	        			obj_regionId.append("<option value='"+region_data[item].id+"'>"+region_data[item].name+"</option>");
	        			var region_sub = region_data[item].regionList;
	        			for (var itemsub in region_sub)
	        			{
	        					obj_regionId.append("<option value='"+region_sub[itemsub].id+"'>---"+region_sub[itemsub].name+"</option>");
	        			}
	        	}
	        	obj_regionId.val(v.regionId);
	        });	        
			});
			
			function gotoUrl(va)
			{
					if (va == 'VISA')
					{
							window.location.href = "mycommission-accounting.html?commission_state="+v.commission_state;
					}else
					{
							window.location.href = "mycommission-ovst-accounting.html?commission_state="+v.commission_state;
					}
			}
			
			function open_detail(serviceId,orderId)
      {
      		show_commission_detail(serviceId,orderId);
      }
      
      function show_confirmbox(id,va,par)
      {
      		v.orderId = id;
      		v.set_state = va;
      		v.set_type = par; 
      		$('#showconfirmbox_id #refuse_remarks').hide();
      		if (v.ap_list == 'KJ' && va == 'WAIT' && par == '0') $('#showconfirmbox_id #refuse_remarks').show();     		
      		$('#showconfirmbox_id').modal('show');
      }
      
      function update_state()
      {
      		if (v.set_type == '0')
      		{
      				if ($('#showconfirmbox_id #refuseRemarks').val() == '')
      				{
      						$('#showconfirmbox_id #show_error_message').html('提示：必须填写驳回原因！');
      						return false;
      				}
      		}
      		flowstep(v.set_state,v.set_type);
      		$('#showconfirmbox_id').modal('hide');
      }
      
      function flowstep(va,par)
      {
      		var str_url = url + "commissionOrder/approval";
      		if (par == '0' || va == 'CLOSE') str_url = url + "commissionOrder/refuse";
      		
      		var json = {};
      		var refuseReason = '';
      		if (v.ap_list == 'KJ' && va == 'WAIT' && par == '0')
          {
          		if ($('#showconfirmbox_id #refuseRemarks').val() != '') refuseReason = $('#showconfirmbox_id #refuseRemarks').val();
          		json['refuseReason'] = refuseReason;
          }
      		show_loading();
      		json['id'] = v.orderId;
          json['state'] = va;          
          $.post(str_url, json,
			   	function(data){
			   			$('#loading_id').modal('hide');
			   			if (data.code == 0)
			   			{			   					
			   					$('#my_table #alert_success').css('marginLeft','40%');
			   					$('#my_table #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
			   					//重新载入数据源
					   			setTimeout(function(){v.getDatalist();$('.modal-backdrop').remove();}, 1000);
			   			}else
			   			{
			   					$('#my_table #alert_error').css('marginLeft','40%');
			   					$('#my_table #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
	          			$("#my_table #error_info").html(data.message);
		        			return false;
			   			}
			   	});      		
      }
      
      function getRequest(par)
			{
					var str_value = '';
			    var url = decodeURI(location.search);
			    var theRequest = new Object();
			    if (url.indexOf('?') != -1) {
			        url = url.substr(1);
			    }
			    if (url) {
			        var strs = url.split('&');
			        for (var i = 0; i < strs.length; i++) {
			            var srtArry = strs[i].split('=');
			            var y = srtArry.shift();
			            theRequest[y] = unescape(srtArry.join('='));
			        }
			    }
			    str_value = theRequest[par];
			    $("#commission_state_"+str_value).addClass("active");
			    return str_value;
			}
			
			function uploadFile()
			{
					$('#upload_id').modal('show');
					$('#upload_id #f2').val('');
					$('#upload_id #show_message').html('');
			}
			
			$('#upload_id #btnUpload').live('click', function (e) {
					var formData = new FormData();					
					formData.append("file",$("#f2")[0].files[0]);
					$('#upload_id #show_message').html('');
					show_loading();
					
					$.ajax({
			        url: url + 'commissionOrder/upload',
			        dataType:'json',
			        type:'POST',
			        async: false,
			        data: formData,
			        processData : false, //使数据不做处理
			        contentType : false,
			        success: function(data){
			        		$('#loading_id').modal('hide');			        		
			            if (data.code == '0')
			            {			            		
			            		if (data.message == '')
			            		{
			            				$('#upload_id #show_message').css("color","#78CD51");
			            				$('#upload_id #show_message').html('上传数据成功，请核对数据是否一致。');
			            		}else
			            		{
			            				$('#upload_id #show_message').css("color","red");
			            				$('#upload_id #show_message').html(data.message);
			            		}
			            }else
			            {
			            		$('#upload_id #show_message').html(data.message);
			            }	
			        },
			        error:function(response){
			            console.log(response);
			        }
			    });
			});
      
      function show_knowledge_detail(id,parentId)
      {
      		sessionStorage.setItem("id", id);
      		sessionStorage.setItem("menu_parentid", parentId);
					window.location.href = "knowledge.html"; 
      }
      
      function url_replace(str)
			{
					var reg = /((http|ftp|https):\/\/)?[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/g;
					str=str.replace(reg,function(a){
					    if(!a.indexOf('http'))
					    {
					    	return '<a href="'+a+'" target="_blank">'+a+'</a>';
					    }else
					    {
					    	return '<a href="http://'+a+'" target="_blank">'+a+'</a>';
					    }
					});
					return str;
			}
			
			function url_replace1(str)
			{
					var reg = /((http|ftp|https):\/\/)?[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/g;
					str=str.replace(reg,function(a){
					    if(!a.indexOf('http'))
					    {
					    	return "<a href=\'"+a+"\' target=\'_blank\'>"+a+"</a>";
					    }else
					    {
					    	return "<a href=\'http://"+a+"\' target=\'_blank\'>"+a+"</a>";
					    }
					});
					return str;
			}
			
			function  formatDate(now)
			{
			    var   now= new Date(now);     
			    var   year=now.getFullYear();     
			    var   month=now.getMonth()+1;     
			    var   date=now.getDate();     
			    var   hour=now.getHours();
			    var   minute=now.getMinutes();     
			    var   second=now.getSeconds();
			    return fixZero(date,2)+"/"+fixZero(month,2)+"/"+year;
			}  
			
			function fixZero(num,length)
			{     
			    var str=""+num;
			    var len=str.length;     var s="";
			    for(var i=length;i-->len;)
			    {         
			        s+="0";
			    }
			    return s+str;
			}
			
			function show_loading()
			{
					$('#loading_id').on('show.bs.modal', function(){
	          var $this = $(this);
	          var $modal_dialog = $this.find('.modal-dialog');
	          $this.css('display', 'block');
	          $modal_dialog.css({'margin-top': Math.max(0, ($(window).height() - $modal_dialog.height()) / 2) });
	        });
					$('#loading_id').modal('show');
			}
			
			$("#selectAll").click(function () {
			  $("#list_ovst :checkbox").prop("checked", true); 
			});
			
			$("#unSelect").click(function () {
			  $("#list_ovst :checkbox").prop("checked", false); 
			});
			
			$("#reverse").click(function () { 
			  $("#list_ovst :checkbox").each(function () { 
			    $(this).prop("checked", !$(this).prop("checked")); 
			  });
			});
			
			function multiple_import()
			{
					$('#showconfirmbox_invoice_id').on('show.bs.modal', function(){
	          var $this = $(this);
	          var $modal_dialog = $this.find('.modal-dialog');
	          $this.css('display', 'block');
	          $modal_dialog.css({'margin-top': Math.max(0, ($(window).height() - $modal_dialog.height()) / 2) });
	        });
					$('#showconfirmbox_invoice_id').modal('show')
			}
			
			function updateToInvoice()
			{
					var ids_value = [];
					var chk_value = [];
					var str = '';
					$("#list_ovst :checked").each(function () {
						str = $(this).val()+','+$("#list_ovst #userName"+$(this).val()).html()+','+$("#list_ovst #dob"+$(this).val()).html()+','+$("#list_ovst #studentCode"+$(this).val()).html()+','+$("#list_ovst #schoolSubject"+$(this).val()).html()+','+$("#list_ovst #startDate"+$(this).val()).html()+','+$("#list_ovst #installmentNum"+$(this).val()).html()+','+$("#list_ovst #tuitionFee"+$(this).val()).html()+','+$("#list_ovst #expectAmount"+$(this).val()).html()+','+$("#list_ovst #amount"+$(this).val()).html();
						//str = removeHTMLTag(str);
				    chk_value.push(str);
				    ids_value.push($(this).val());
				  });
				  if (chk_value.length)
				  {
				  		var current_tab = $("#current_tab",window.opener.document).val();
				  		if (current_tab == 'normal')
				  		{
				  				$("#ids_normal",window.opener.document).val(ids_value.join(','));
				  		}else
				  		{
				  				$("#ids_markteting",window.opener.document).val(ids_value.join(','));
				  		}
				  		window.opener.createOvstTable(chk_value.length,chk_value.join('#'));
				  		self.close();
				  }else
				  {
				  		$('#showconfirmbox_invoice_id #alert_error').css('marginTop','10%');
		   				$('#showconfirmbox_invoice_id #alert_error').css('marginLeft','30%');
				  		$('#showconfirmbox_invoice_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
        			$("#showconfirmbox_invoice_id #error_info").html('请至少勾选一个订单！');
        			return false;
				  }
			}
			
			function removeHTMLTag(str)
			{
					str = str.replace('<br>','-');
			    str = str.replace(/<\/?[^>]*>/g, ''); //去除HTML tag
			    str = str.replace(/ /ig, ''); //去掉 
			    return str;
			}
			
	    jQuery(document).ready(function() {
	    });
		</script>
	</body>

</html>